<!DOCTYPE html>
<!-- æœ€å„ªå…ˆTypeSquareå®Œå…¨é®æ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆDOCTYPEç›´å¾Œï¼‰ -->
<script>
(function() {
  'use strict';
  
  // å³åº§ã«TypeSquareé–¢é€£ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ç„¡åŠ¹åŒ–
  const tsVariables = ['ts', 'TypeSquare', 'Typekit', 'WebFont', 'Ts', 'TS', 'typesquare'];
  tsVariables.forEach(varName => {
    try {
      Object.defineProperty(window, varName, {
        get: function() { return null; },
        set: function() { return false; },
        configurable: false,
        enumerable: false
      });
    } catch(e) {}
  });
  
  // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’å³åº§ã«æŠ‘åˆ¶
  const originalConsoleError = console.error;
  const originalConsoleWarn = console.warn;
  
  console.error = function(...args) {
    const message = args.join(' ');
    if (message.includes('typesquare') || message.includes('ERR_BLOCKED_BY_CLIENT') || message.includes('Failed to load resource') || message.includes('net::ERR_') || message.includes('entry.')) {
      return; // å®Œå…¨ã«ç„¡è¦–
    }
    return originalConsoleError.apply(console, args);
  };
  
  console.warn = function(...args) {
    const message = args.join(' ');
    if (message.includes('typesquare') || message.includes('ERR_BLOCKED_BY_CLIENT')) {
      return; // å®Œå…¨ã«ç„¡è¦–
    }
    return originalConsoleWarn.apply(console, args);
  };
  
  // ã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’å³åº§ã«æŠ‘åˆ¶
  window.addEventListener('error', function(e) {
    if (e.filename && (e.filename.includes('typesquare') || e.filename.includes('ts?') || e.filename.includes('entry.') || e.filename.includes('l.typesquare.com'))) {
      e.stopImmediatePropagation();
      e.preventDefault();
      return false;
    }
    if (e.message && (e.message.includes('typesquare') || e.message.includes('ERR_BLOCKED_BY_CLIENT') || e.message.includes('Failed to load resource') || e.message.includes('net::ERR_'))) {
      e.stopImmediatePropagation();
      e.preventDefault();
      return false;
    }
  }, true);
  
  // Promise rejectionã‚‚å³åº§ã«æŠ‘åˆ¶
  window.addEventListener('unhandledrejection', function(e) {
    if (e.reason && (e.reason.toString().includes('typesquare') || e.reason.toString().includes('ERR_BLOCKED_BY_CLIENT') || e.reason.toString().includes('Failed to fetch'))) {
      e.stopImmediatePropagation();
      e.preventDefault();
      return false;
    }
  }, true);
  
  // fetchã¨XMLHttpRequestã‚’å³åº§ã«ãƒ•ãƒƒã‚¯
  if (window.fetch) {
    const originalFetch = window.fetch;
    window.fetch = function(url, options) {
      if (typeof url === 'string' && (url.includes('typesquare') || url.includes('l.typesquare.com') || url.includes('ts?condition=') || url.includes('entry.'))) {
        return Promise.reject(new Error('TypeSquare request blocked'));
      }
      return originalFetch.apply(this, arguments);
    };
  }
  
  if (XMLHttpRequest.prototype.open) {
    const originalXHROpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url) {
      if (typeof url === 'string' && (url.includes('typesquare') || url.includes('l.typesquare.com') || url.includes('ts?condition=') || url.includes('entry.'))) {
        return;
      }
      return originalXHROpen.apply(this, arguments);
    };
  }
  
  console.log('ğŸ›¡ï¸ æœ€å¼·TypeSquareé®æ–­ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†ï¼ˆDOCTYPEç›´å¾Œï¼‰');
})();
</script>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  
  <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã¯ _headers ã§çµ±ä¸€ç®¡ç†ï¼ˆStudioåŸ‹ã‚è¾¼ã¿è¨±å¯ï¼‰ -->
  
  <!-- æœ€å„ªå…ˆTypeSquareå®Œå…¨é®æ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script>
    (function() {
      'use strict';
      
      // ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã¯éå‰°ã‚®ãƒŸãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–
      if (location.protocol === 'file:') { return; }
      
      console.log('ğŸ›¡ï¸ TypeSquareé®æ–­ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ï¼ˆGeneratorç‰ˆï¼‰');
      
      // TypeSquareã‚¨ãƒ©ãƒ¼æ¤œå‡ºã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
      let typeSquareErrorCount = 0;
      
      // ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ã‚’ç„¡æ¡ä»¶ã§æŠ‘åˆ¶
      window.addEventListener('error', function(e) {
        if (e.filename && (e.filename.includes('typesquare') || e.filename.includes('ts?') || e.filename.includes('entry.') || e.filename.includes('l.typesquare.com'))) {
          typeSquareErrorCount++;
          console.warn('ğŸš« TypeSquareã‚¨ãƒ©ãƒ¼ã‚’ç„¡åŠ¹åŒ–:', e.message, '(ã‚«ã‚¦ãƒ³ãƒˆ:', typeSquareErrorCount, ')');
          e.stopImmediatePropagation();
          e.preventDefault();
          return false;
        }
        if (e.message && (e.message.includes('typesquare') || e.message.includes('ERR_BLOCKED_BY_CLIENT') || e.message.includes('Failed to load resource') || e.message.includes('net::ERR_'))) {
          typeSquareErrorCount++;
          console.warn('ğŸš« TypeSquareã‚¨ãƒ©ãƒ¼ã‚’ç„¡åŠ¹åŒ–:', e.message, '(ã‚«ã‚¦ãƒ³ãƒˆ:', typeSquareErrorCount, ')');
          e.stopImmediatePropagation();
          e.preventDefault();
          return false;
        }
      }, true);
      
      window.addEventListener('unhandledrejection', function(e) {
        if (e.reason && (e.reason.toString().includes('typesquare') || e.reason.toString().includes('ERR_BLOCKED_BY_CLIENT') || e.reason.toString().includes('Failed to fetch'))) {
          typeSquareErrorCount++;
          console.warn('ğŸš« TypeSquare Promise rejection ã‚’ç„¡åŠ¹åŒ– (ã‚«ã‚¦ãƒ³ãƒˆ:', typeSquareErrorCount, ')');
          e.stopImmediatePropagation();
          e.preventDefault();
          return false;
        }
      }, true);
      
      // TypeSquareé–¢é€£ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’å³åº§ã«ç„¡åŠ¹åŒ–
      const tsVariables = ['ts', 'TypeSquare', 'Typekit', 'WebFont', 'Ts', 'TS'];
      tsVariables.forEach(varName => {
        Object.defineProperty(window, varName, {
          get: function() { return null; },
          set: function() { console.warn('ğŸš« TypeSquareå¤‰æ•°è¨­å®šã‚’é˜»æ­¢:', varName); },
          configurable: false,
          enumerable: false
        });
      });
      
      // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã‚‚æŠ‘åˆ¶
      const originalConsoleError = console.error;
      console.error = function(...args) {
        const message = args.join(' ');
        if (message.includes('typesquare') || message.includes('ERR_BLOCKED_BY_CLIENT') || message.includes('Failed to load resource') || message.includes('net::ERR_')) {
          console.warn('ğŸ”‡ TypeSquareã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’æŠ‘åˆ¶:', message);
          return;
        }
        return originalConsoleError.apply(console, args);
      };
      
      // fetchã¨XMLHttpRequestã‚’ãƒ•ãƒƒã‚¯ã—ã¦TypeSquareãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯
      const originalFetch = window.fetch;
      if (originalFetch) {
        window.fetch = function(url, options) {
          if (typeof url === 'string' && (url.includes('typesquare') || url.includes('l.typesquare.com') || url.includes('ts?condition='))) {
            console.log('ğŸš« TypeSquare fetchãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯:', url);
            return Promise.reject(new Error('TypeSquare request blocked'));
          }
          return originalFetch.apply(this, arguments);
        };
      }
      
      const originalXHROpen = XMLHttpRequest.prototype.open;
      XMLHttpRequest.prototype.open = function(method, url) {
        if (typeof url === 'string' && (url.includes('typesquare') || url.includes('l.typesquare.com') || url.includes('ts?condition='))) {
          console.log('ğŸš« TypeSquare XHRãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯:', url);
          return;
        }
        return originalXHROpen.apply(this, arguments);
      };
      
      // MutationObserverã§TypeSquareã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‹•çš„è¿½åŠ ã‚’ç›£è¦–ãƒ»ãƒ–ãƒ­ãƒƒã‚¯
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          mutation.addedNodes.forEach(function(node) {
            if (node.nodeType === 1) { // Element node
              // TypeSquareé–¢é€£ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„ãƒªãƒ³ã‚¯ã‚’å³åº§ã«å‰Šé™¤
              if (node.src && (node.src.includes('typesquare') || node.src.includes('entry.') || node.src.includes('l.typesquare.com'))) {
                node.remove();
                console.log('ğŸš« TypeSquareã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‰Šé™¤:', node.src);
              }
              if (node.href && node.href.includes('typesquare')) {
                node.remove();
                console.log('ğŸš« TypeSquareãƒªãƒ³ã‚¯ã‚’å‰Šé™¤:', node.href);
              }
              // å­è¦ç´ ã‚‚ãƒã‚§ãƒƒã‚¯
              const typeSquareElements = node.querySelectorAll && node.querySelectorAll('[src*="typesquare"], [href*="typesquare"], [src*="entry."], [src*="l.typesquare.com"]');
              if (typeSquareElements) {
                typeSquareElements.forEach(el => {
                  el.remove();
                  console.log('ğŸš« TypeSquareå­è¦ç´ ã‚’å‰Šé™¤');
                });
              }
            }
          });
        });
      });
      
      // DOMå…¨ä½“ã‚’ç›£è¦–é–‹å§‹
      observer.observe(document, {
        childList: true,
        subtree: true
      });
      
      console.log('âœ… TypeSquareé®æ–­ã‚·ã‚¹ãƒ†ãƒ å®Œäº†ï¼ˆGeneratorç‰ˆï¼‰');
    })();
  </script>
  
  <title>æ”¾èª²å¾Œã‚¯ãƒ­ãƒ‹ã‚¯ãƒ« å­¦ç”Ÿè¨¼ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <meta property="og:title" content="æ”¾èª²å¾Œã‚¯ãƒ­ãƒ‹ã‚¯ãƒ« å­¦ç”Ÿè¨¼ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼">
  <meta property="og:description" content="ã‚ãªãŸã ã‘ã®å­¦ç”Ÿè¨¼ã‚’ä½œæˆã—ã‚ˆã†ï¼">
  <meta property="og:image" content="https://res.cloudinary.com/di5xqlddy/image/upload/f_auto,q_auto,w_1200,h_630,c_fill,fl_force_strip/v1/student-id-generator/preview.png">
  <meta property="og:url" content="https://student-id-generator.pages.dev/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://res.cloudinary.com/di5xqlddy/image/upload/f_auto,q_auto,w_1200,h_630,c_fill,fl_force_strip/v1/student-id-generator/preview.png">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">

  <link id="generator-style" rel="stylesheet">
  <script>
    (function(){
      const ORIGIN = window.APP_ORIGIN || (location.hostname === 'localhost' || location.hostname === '127.0.0.1' 
        ? location.origin 
        : 'https://student-id-generator.pages.dev');
      
      // ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç›´æ¥é–‹ãå ´åˆã¯ç›¸å¯¾ãƒ‘ã‚¹ã‚’ä½¿ç”¨
      if (location.protocol === 'file:') {
        document.getElementById('generator-style').href = 'assets/css/style.css';
      } else {
        document.getElementById('generator-style').href = ORIGIN + '/assets/css/style.css';
      }
    })();
  </script>
  <!-- <script src="assets/js/domain-masking.js"></script> -->
  <style>
    /* TypeSquareã¨Studioç’°å¢ƒã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Œå…¨ç„¡åŠ¹åŒ– */
    link[href*="typesquare"], 
    script[src*="typesquare"],
    script[src*="entry."],
    script[src*="l.typesquare.com"],
    iframe[src*="typesquare"],
    *[data-typesquare],
    *[class*="typesquare"],
    *[id*="typesquare"] {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      pointer-events: none !important;
      position: absolute !important;
      left: -9999px !important;
      top: -9999px !important;
      width: 0 !important;
      height: 0 !important;
    }
    
    /* é€²æ—ãƒãƒ¼ã¨ã‚«ãƒ¼ãƒ‰é«˜ã•èª¿æ•´ï¼ˆè¨ºæ–­çµæœãƒšãƒ¼ã‚¸ã¨å®Œå…¨ã«åŒã˜ï¼‰ */
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      margin-bottom: 2rem;
      overflow: hidden;
      margin-top: 2rem;  /* è¨ºæ–­çµæœãƒšãƒ¼ã‚¸ã¨åŒã˜ä¸Šä½™ç™½ */
    }

    .progress-fill {
      height: 100%;
      background: #B997D6;
      border-radius: 4px;
      transition: width 0.6s cubic-bezier(0.25, 1, 0.5, 1);
      width: 0%;
    }

    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .generator-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    /* ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šãƒ»ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã¯ç¸¦ä¸¦ã³ï¼‰ */
    .cards-grid {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      align-items: stretch;
      width: 100%;
      max-width: none;
      min-height: 500px;
      position: relative;
      overflow: visible;
      float: none;
      clear: both;
    }
    
    /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚µã‚¤ã‚ºã§ã®ã¿ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    @media (min-width: 769px) {
      .cards-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
      }
    }
    
    /* ã‚«ãƒ¼ãƒ‰ã®å¼·åˆ¶æ¨ªä¸¦ã³ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚µã‚¤ã‚ºã®ã¿ï¼‰ */
    @media (min-width: 769px) {
      .cards-grid > * {
        display: block !important;
        float: none !important;
        clear: none !important;
        width: auto !important;
        max-width: none !important;
      }
      
      /* ãƒ•ã‚©ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ã®å¼·åˆ¶æ¨ªä¸¦ã³ */
      .form-card, .preview-card {
        display: block !important;
        float: none !important;
        clear: none !important;
        width: auto !important;
        max-width: none !important;
        position: relative !important;
      }
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ã®é«˜ã•èª¿æ•´ï¼ˆPCã‚µã‚¤ã‚ºã¯å…ƒã®è¨­å®šã€ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã¯æ‹¡ç¸®å¯èƒ½ï¼‰ */
    .form-card, .preview-card {
      background: rgba(255, 255, 255, 0.98);
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(185, 151, 214, 0.2);
      position: relative;
      overflow: hidden; /* PCã‚µã‚¤ã‚ºã§ã¯å…ƒã®è¨­å®šã«æˆ»ã™ */
      display: flex;
      flex-direction: column;
      width: 100%;
      box-sizing: border-box;
      min-height: 450px; /* PCã‚µã‚¤ã‚ºã§ã¯å…ƒã®é«˜ã•ã«æˆ»ã™ */
      height: 550px; /* PCã‚µã‚¤ã‚ºã§ã¯å…ƒã®é«˜ã•ã«æˆ»ã™ */
      max-height: 550px; /* PCã‚µã‚¤ã‚ºã§ã¯å…ƒã®é«˜ã•ã«æˆ»ã™ */
    }
    
    /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚µã‚¤ã‚ºã§ã®ã¿Flexboxãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    @media (min-width: 769px) {
      .form-card, .preview-card {
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
    }

    /* ã‚«ãƒ¼ãƒ‰ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°èª¿æ•´ï¼ˆPCã‚µã‚¤ã‚ºã¯å…ƒã®è¨­å®šï¼‰ */
    .form-card {
      padding: 1.5rem;
      min-height: 450px; /* PCã‚µã‚¤ã‚ºã§ã¯å…ƒã®é«˜ã•ã«æˆ»ã™ */
    }

    .preview-card {
      padding: 1.5rem;
      min-height: 450px; /* PCã‚µã‚¤ã‚ºã§ã¯å…ƒã®é«˜ã•ã«æˆ»ã™ */
    }

    /* ã‚«ãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ•ãƒƒã‚¿ãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ³èª¿æ•´ï¼ˆPCã‚µã‚¤ã‚ºã¯å…ƒã®è¨­å®šï¼‰ */
    .card-header {
      margin-bottom: 1rem;
      font-size: 1.4rem;
      font-weight: 700;
      color: #666;
      text-align: center;
      flex-shrink: 0;
    }

    .card-footer {
      margin-top: auto;
      padding-top: 1rem;
      display: flex;
      gap: 0.8rem;
      justify-content: center;
      flex-wrap: wrap;
      flex-shrink: 0;
    }
    
    /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚µã‚¤ã‚ºã§ã®ã¿Flexboxãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    @media (min-width: 769px) {
      .card-header {
        flex-shrink: 0;
      }
      
      .card-footer {
        margin-top: auto;
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
        flex-shrink: 0;
      }
    }

    /* ã‚«ãƒ¼ãƒ‰ãƒœãƒ‡ã‚£ã®èª¿æ•´ï¼ˆPCã‚µã‚¤ã‚ºã¯å…ƒã®è¨­å®šï¼‰ */
    .card-body {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚µã‚¤ã‚ºã§ã®ã¿Flexboxãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    @media (min-width: 769px) {
      .card-body {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ã®å†…å®¹èª¿æ•´ï¼ˆPCã‚µã‚¤ã‚ºã¯å…ƒã®è¨­å®šï¼‰ */
    .form-card h2 {
      margin-top: 0;
      margin-bottom: 1rem;
      flex-shrink: 0;
    }
    
    /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚µã‚¤ã‚ºã§ã®ã¿Flexboxãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    @media (min-width: 769px) {
      .form-card h2 {
        flex-shrink: 0;
      }
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒãƒ¼ã‚¸ãƒ³èª¿æ•´ï¼ˆPCã‚µã‚¤ã‚ºã¯å…ƒã®è¨­å®šï¼‰ */
    .form-group {
      margin-bottom: 1rem;
    }

    /* ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ã‚¸ãƒ³èª¿æ•´ï¼ˆPCã‚µã‚¤ã‚ºã¯å…ƒã®è¨­å®šï¼‰ */
    .card-footer button {
      margin: 0.4rem;
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 8px;
      background: #B997D6;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚µã‚¤ã‚ºã§ã®ã¿æ¨ªä¸¦ã³ãƒœã‚¿ãƒ³ */
    @media (min-width: 769px) {
      .card-footer button {
        margin: 0.5rem;
        width: auto;
      }
    }

    .card-footer button:hover {
      background: #A895D0;
      transform: translateY(-1px);
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #666;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 0.6rem;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #B997D6;
    }

    /* æ—¥ä»˜å…¥åŠ›ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã¯ç¸¦ä¸¦ã³å¯¾å¿œï¼‰ */
    .date-inputs {
      display: block;
      width: 100%;
      box-sizing: border-box;
    }
    
    .date-inputs .number-input {
      margin-bottom: 0.8rem;
      width: 100%;
    }
    
    /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚µã‚¤ã‚ºã§ã®ã¿ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    @media (min-width: 769px) {
      .date-inputs {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }
      
      .date-inputs .number-input {
        margin-bottom: 0;
      }
    }

    /* ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆPCã‚µã‚¤ã‚ºã¯å…ƒã®è¨­å®šï¼‰ */
    .file-input-label {
      display: block;
      padding: 1.5rem;
      border: 2px dashed #B997D6;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(185, 151, 214, 0.05);
    }

    .file-input-label:hover {
      background: rgba(185, 151, 214, 0.1);
      border-color: #A895D0;
    }

    .file-input-label input[type="file"] {
      display: none;
    }

    /* ã‚¹ãƒãƒ›ç”¨ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼ˆUXé‡è¦–ï¼‰ */
    @media (max-width: 768px) {
      /* å¼·åˆ¶çš„ã«é©ç”¨ã™ã‚‹ãŸã‚ã®æœ€å¼·ã‚»ãƒ¬ã‚¯ã‚¿ */
      html body .generator-container .cards-grid .form-card,
      html body .generator-container .cards-grid .preview-card {
        padding: 1rem !important;
        min-height: 600px !important;
        max-height: none !important;
        height: auto !important;
        overflow: visible !important;
        transform: none !important;
        transition: none !important;
        animation: none !important;
      }
      
      html body .generator-container .cards-grid .form-card {
        min-height: 800px !important;
      }
      
      html body .generator-container .cards-grid .preview-card {
        min-height: 600px !important;
      }
      
      html body .generator-container .cards-grid .form-card > *,
      html body .generator-container .cards-grid .preview-card > * {
        margin-bottom: 1rem !important;
      }
      /* ã‚³ãƒ³ãƒ†ãƒŠã®èª¿æ•´ */
      .generator-container {
        padding: 0 1rem !important;
        margin: 1rem auto !important;
      }
      
      /* é€²æ—ãƒãƒ¼ã®èª¿æ•´ */
      .progress-bar {
        margin: 1rem 0 1.5rem 0 !important;
        height: 6px !important;
      }
      
      /* ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ã‚’ç¸¦ä¸¦ã³ã«å¤‰æ›´ï¼ˆã‚¹ãƒãƒ›æœ€é©åŒ–ãƒ»æœ€å¼·åŒ–ç‰ˆï¼‰ */
      .cards-grid {
        display: flex !important;
        flex-direction: column !important;
        grid: none !important;
        grid-template-columns: none !important;
        grid-template-rows: none !important;
        gap: 1.5rem !important;
        min-height: auto !important;
        height: auto !important;
        width: 100% !important;
        max-width: 100% !important;
        position: relative !important;
        overflow: visible !important;
        float: none !important;
        clear: both !important;
      }
      
      /* ã‚¹ãƒãƒ›ã§ã¯æ¨ªä¸¦ã³ã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ–ï¼ˆé‡è¤‡è¨­å®šã§ç¢ºå®Ÿæ€§å‘ä¸Šï¼‰ */
      .cards-grid {
        grid: none !important;
        display: flex !important;
        flex-direction: column !important;
        grid-template-columns: none !important;
        grid-template-rows: none !important;
        grid-auto-flow: none !important;
        grid-auto-rows: none !important;
        grid-auto-columns: none !important;
      }
      
      /* ã‚«ãƒ¼ãƒ‰ã®èª¿æ•´ï¼ˆã‚¹ãƒãƒ›æœ€é©åŒ–ãƒ»ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆUIãƒ»é‡ãªã‚Šé˜²æ­¢ãƒ»ç¸¦å¹…æœ€é©åŒ–ãƒ»å…¨è¦ç´ åå®¹å¯¾å¿œãƒ»è¦ç´ åˆ‡ã‚Œå®Œå…¨é˜²æ­¢ãƒ»é«˜ã•æœ€é©åŒ–ãƒ»æ‹¡ç¸®å¯èƒ½ï¼‰ */
      body .generator-container .cards-grid .form-card,
      body .generator-container .cards-grid .preview-card,
      .form-card, .preview-card {
        padding: 1rem !important; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã•ã‚‰ã«ç¸®å° */
        height: auto !important;
        min-height: 600px !important; /* é«˜ã•ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        max-height: none !important;
        margin: 0 !important;
        border-radius: 16px !important;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1) !important;
        box-sizing: border-box !important;
        overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
        position: relative !important;
        z-index: 1 !important;
        display: flex !important;
        flex-direction: column !important;
        width: 100% !important;
        max-width: 100% !important;
        flex: none !important;
        order: 0 !important;
        /* è¦ç´ åˆ‡ã‚Œå®Œå…¨é˜²æ­¢ã®ãŸã‚ã®è¿½åŠ è¨­å®š */
        word-wrap: break-word !important;
        word-break: break-word !important;
        white-space: normal !important;
        text-overflow: clip !important;
        /* å…¨è¦ç´ åå®¹ã®ãŸã‚ã®è¿½åŠ è¨­å®š */
        flex-wrap: wrap !important;
        align-content: flex-start !important;
        justify-content: flex-start !important;
        /* ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã®ã¿æ‹¡ç¸®å¯èƒ½ */
        resize: vertical !important;
        overflow-y: auto !important;
        /* å¼·åˆ¶çš„ã«é©ç”¨ã™ã‚‹ãŸã‚ã®è¿½åŠ è¨­å®š */
        transform: none !important;
        transition: none !important;
        animation: none !important;
      }
      
      /* ã‚«ãƒ¼ãƒ‰é–“ã®é‡ãªã‚Šé˜²æ­¢ãƒ»å…¨è¦ç´ åå®¹å¯¾å¿œãƒ»è¦ç´ åˆ‡ã‚Œå®Œå…¨é˜²æ­¢ãƒ»é«˜ã•å¤§å¹…å¢—åŠ ãƒ»æ‹¡ç¸®å¯èƒ½ */
      body .generator-container .cards-grid .form-card,
      .form-card {
        z-index: 2 !important;
        margin-bottom: 1.5rem !important;
        min-height: 800px !important; /* ãƒ•ã‚©ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ã¯å…¨è¦ç´ ã‚’ç¢ºå®Ÿã«åå®¹ã™ã‚‹ãŸã‚ç¸¦å¹…ã‚’æœ€é©åŒ– */
        order: 1 !important;
        /* è¦ç´ åˆ‡ã‚Œå®Œå…¨é˜²æ­¢ã®ãŸã‚ã®è¿½åŠ è¨­å®š */
        word-wrap: break-word !important;
        word-break: break-word !important;
        white-space: normal !important;
        text-overflow: clip !important;
        /* å…¨è¦ç´ åå®¹ã®ãŸã‚ã®è¿½åŠ è¨­å®š */
        flex-wrap: wrap !important;
        align-content: flex-start !important;
        justify-content: flex-start !important;
        /* ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã®ã¿æ‹¡ç¸®å¯èƒ½ */
        resize: vertical !important;
        overflow-y: auto !important;
      }
      
      body .generator-container .cards-grid .preview-card,
      .preview-card {
        z-index: 1 !important;
        margin-top: 0 !important;
        min-height: 600px !important; /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚‚ç¸¦å¹…ã‚’æœ€é©åŒ– */
        order: 2 !important;
        /* è¦ç´ åˆ‡ã‚Œå®Œå…¨é˜²æ­¢ã®ãŸã‚ã®è¿½åŠ è¨­å®š */
        word-wrap: break-word !important;
        word-break: break-word !important;
        white-space: normal !important;
        text-overflow: clip !important;
        /* å…¨è¦ç´ åå®¹ã®ãŸã‚ã®è¿½åŠ è¨­å®š */
        flex-wrap: wrap !important;
        align-content: flex-start !important;
        justify-content: flex-start !important;
        /* ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã®ã¿æ‹¡ç¸®å¯èƒ½ */
        resize: vertical !important;
        overflow-y: auto !important;
        /* å¼·åˆ¶çš„ã«é©ç”¨ã™ã‚‹ãŸã‚ã®è¿½åŠ è¨­å®š */
        transform: none !important;
        transition: none !important;
        animation: none !important;
      }
      
      /* ã‚«ãƒ¼ãƒ‰å†…ã®è¦ç´ é–“éš”ã‚’èª¿æ•´ï¼ˆé‡ãªã‚Šé˜²æ­¢ãƒ»å…¨è¦ç´ åå®¹å¯¾å¿œãƒ»é–“éš”æœ€é©åŒ–ï¼‰ */
      body .generator-container .cards-grid .form-card > *,
      body .generator-container .cards-grid .preview-card > *,
      .form-card > *,
      .preview-card > * {
        margin-bottom: 1rem !important; /* è¦ç´ é–“éš”ã‚’ã•ã‚‰ã«æœ€é©åŒ–ã—ã¦å…¨è¦ç´ åå®¹ã‚’ç¢ºå®Ÿã« */
        position: relative !important;
        z-index: 1 !important;
        width: 100% !important;
        box-sizing: border-box !important;
        overflow: visible !important;
        max-height: none !important;
        height: auto !important;
      }
      
      .form-card > *:last-child,
      .preview-card > *:last-child {
        margin-bottom: 0 !important;
      }
      
      /* é‡ãªã‚Šé˜²æ­¢ã®ãŸã‚ã®æ˜ç¤ºçš„ãªé…ç½®ï¼ˆFlexboxæœ€é©åŒ–ãƒ»è¦ç´ åˆ‡ã‚Œé˜²æ­¢ï¼‰ */
      .form-card h2 {
        position: relative !important;
        z-index: 2 !important;
        margin-bottom: 0.8rem !important;
        flex-shrink: 0 !important;
        height: auto !important; /* é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
      }
      
      .form-card #studentForm {
        position: relative !important;
        z-index: 1 !important;
        margin-bottom: 0.8rem !important;
        flex: 1 !important;
        display: flex !important;
        flex-direction: column !important;
        justify-content: flex-start !important;
        gap: 0.8rem !important;
        height: auto !important; /* é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
        min-height: 0 !important; /* æœ€å°é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
      }
      
      .form-card #diagnosisButtons {
        position: relative !important;
        z-index: 1 !important;
        margin-top: 0.8rem !important; /* autoã‹ã‚‰å›ºå®šå€¤ã«å¤‰æ›´ */
        padding-top: 0.8rem !important;
        flex-shrink: 0 !important;
        height: auto !important; /* é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
      }
      
      .preview-card .card-header {
        position: relative !important;
        z-index: 2 !important;
        margin-bottom: 0.8rem !important;
        flex-shrink: 0 !important;
        height: auto !important; /* é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
      }
      
      .preview-card .card-body {
        position: relative !important;
        z-index: 1 !important;
        margin-bottom: 0.8rem !important;
        flex: 1 !important;
        display: flex !important;
        flex-direction: column !important;
        justify-content: flex-start !important; /* ä¸Šæƒãˆã«å¤‰æ›´ */
        align-items: center !important;
        min-height: 250px !important; /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ã®æœ€å°é«˜ã•ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        gap: 0.8rem !important; /* è¦ç´ é–“ã®é–“éš”ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        padding: 0.3rem 0 !important; /* ä¸Šä¸‹ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        height: auto !important; /* é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
      }
      
      .preview-card .card-footer {
        position: relative !important;
        z-index: 1 !important;
        margin-top: 0.8rem !important; /* autoã‹ã‚‰å›ºå®šå€¤ã«å¤‰æ›´ */
        padding-top: 0.8rem !important;
        flex-shrink: 0 !important;
        height: auto !important; /* é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
      }
      
      /* ãƒ•ã‚©ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ã®è¦–èªæ€§å‘ä¸Šãƒ»å…¨è¦ç´ åå®¹å¯¾å¿œ */
      .form-card {
        border-bottom: 3px solid #98d7a5 !important;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 246, 240, 0.95)) !important;
        position: relative !important;
        /* å…¨è¦ç´ åå®¹ã®ãŸã‚ã®è¿½åŠ è¨­å®š */
        min-height: 1400px !important;
        height: auto !important;
        max-height: none !important;
        overflow: visible !important;
        flex-wrap: wrap !important;
        align-content: flex-start !important;
        justify-content: flex-start !important;
      }
      
      /* ãƒ•ã‚©ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ã®æœ€é©åŒ–ï¼ˆPCã‚µã‚¤ã‚ºã¨çµ±ä¸€ãƒ»ãƒ¡ãƒªãƒãƒªä»˜ãï¼‰ */
      .form-card h2 {
        font-size: 1.7rem !important; /* ãƒ•ã‚©ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ«ã‚‚å¤§ãã */
        margin-bottom: 2rem !important;
        text-align: left !important;
        color: #333 !important; /* ã‚ˆã‚Šæ¿ƒã„è‰²ã§å¼·èª¿ */
        font-family: 'Noto Serif JP', serif !important;
        font-weight: 700 !important; /* ã‚ˆã‚Šå¤ªã */
        line-height: 1.2 !important;
      }
      
      /* ç”»åƒé¸æŠã‚¨ãƒªã‚¢ã®æœ€é©åŒ–ï¼ˆä½™è£•ã®ã‚ã‚‹UIãƒ»é‡ãªã‚Šé˜²æ­¢ãƒ»å…¨è¦ç´ åå®¹å¯¾å¿œï¼‰ */
      .file-input-label {
        padding: 1.5rem 1rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        border-radius: 12px !important;
        font-size: 1.1rem !important;
        min-height: 120px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚é«˜ã•ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        margin-bottom: 1rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ãƒãƒ¼ã‚¸ãƒ³ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        border: 2px dashed #B997D6 !important;
        background: rgba(185, 151, 214, 0.05) !important;
        transition: all 0.3s ease !important;
        cursor: pointer !important;
        text-align: center !important;
        line-height: 1.4 !important;
        position: relative !important;
        z-index: 1 !important;
      }
      
      .file-input-label:hover {
        background: rgba(185, 151, 214, 0.1) !important;
        border-color: #A895D0 !important;
        transform: translateY(-2px) !important;
      }
      
      /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®æœ€é©åŒ–ï¼ˆä½™è£•ã®ã‚ã‚‹UIãƒ»é‡ãªã‚Šé˜²æ­¢ãƒ»å…¨è¦ç´ åå®¹å¯¾å¿œãƒ»è¦ç´ åˆ‡ã‚Œé˜²æ­¢ï¼‰ */
      .form-group {
        margin-bottom: 1rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚é–“éš”ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        padding: 0 !important;
        position: relative !important;
        z-index: 1 !important;
        height: auto !important; /* é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
      }
      
      .form-group label {
        font-size: 1rem !important;
        margin-bottom: 0.6rem !important; /* ãƒ©ãƒ™ãƒ«ã¨å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é–“éš”ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        font-weight: 600 !important;
        color: #666 !important;
        display: block !important;
        line-height: 1.4 !important;
        position: relative !important;
        z-index: 1 !important;
        height: auto !important; /* é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
      }
      
      .form-group input,
      .form-group select {
        padding: 0.8rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        font-size: 16px !important; /* iOSã§ã‚ºãƒ¼ãƒ ã‚’é˜²ã */
        border-radius: 10px !important;
        border-width: 2px !important;
        width: 100% !important;
        box-sizing: border-box !important;
        margin: 0 !important;
        line-height: 1.4 !important;
        min-height: 44px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ã‚¿ãƒƒãƒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚µã‚¤ã‚ºã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        position: relative !important;
        z-index: 1 !important;
        height: auto !important; /* é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
      }
      
      /* æ—¥ä»˜å…¥åŠ›ã®æœ€é©åŒ–ï¼ˆä½™è£•ã®ã‚ã‚‹UIãƒ»å…¨è¦ç´ åå®¹å¯¾å¿œï¼‰ */
      .date-inputs {
        gap: 0.8rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚é–“éš”ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        margin-bottom: 0.8rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ãƒãƒ¼ã‚¸ãƒ³ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
      }
      
      .number-input select {
        padding: 0.8rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        font-size: 16px !important;
        min-height: 44px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚é«˜ã•ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        border-radius: 10px !important;
        border: 2px solid #e0e0e0 !important;
        background: white !important;
        cursor: pointer !important;
      }
      
      /* è¨ºæ–­ãƒœã‚¿ãƒ³ã®æœ€é©åŒ–ï¼ˆä½™è£•ã®ã‚ã‚‹UIãƒ»é‡ãªã‚Šé˜²æ­¢ãƒ»å…¨è¦ç´ åå®¹å¯¾å¿œï¼‰ */
      #diagnosisButtons {
        margin-top: 1rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ãƒãƒ¼ã‚¸ãƒ³ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        gap: 0.8rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚é–“éš”ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        display: flex !important;
        flex-direction: column !important;
        align-items: stretch !important;
        padding-top: 0.8rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        position: relative !important;
        z-index: 1 !important;
      }
      
      #diagnosisButtons button {
        padding: 0.8rem 1rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        font-size: 1rem !important;
        border-radius: 10px !important;
        min-height: 44px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚é«˜ã•ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        font-weight: 600 !important;
        border: none !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        position: relative !important;
        z-index: 1 !important;
      }
      
      #diagnosisButtons button:active {
        transform: scale(0.98) !important;
      }
      
      /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ã®æœ€é©åŒ–ï¼ˆPCã‚µã‚¤ã‚ºã¨çµ±ä¸€ãƒ»ä½™è£•ã®ã‚ã‚‹UIãƒ»ãƒ¡ãƒªãƒãƒªä»˜ãï¼‰ */
      .preview-card .card-header {
        font-size: 1.8rem !important; /* å­¦ç”Ÿè¨¼ã¯å¤§ãã */
        margin-bottom: 2rem !important;
        text-align: left !important;
        color: #333 !important; /* ã‚ˆã‚Šæ¿ƒã„è‰²ã§å¼·èª¿ */
        font-family: 'Noto Serif JP', serif !important;
        font-weight: 700 !important; /* ã‚ˆã‚Šå¤ªã */
        padding: 0 !important;
        line-height: 1.2 !important;
      }
      
      /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ã®è¦–èªæ€§å‘ä¸Šãƒ»å…¨è¦ç´ åå®¹å¯¾å¿œ */
      .preview-card {
        position: relative !important;
        margin-top: 1rem !important;
        border-top: 3px solid #B997D6 !important;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 246, 240, 0.95)) !important;
        /* å…¨è¦ç´ åå®¹ã®ãŸã‚ã®è¿½åŠ è¨­å®š */
        min-height: 1200px !important;
        height: auto !important;
        max-height: none !important;
        overflow: visible !important;
        flex-wrap: wrap !important;
        align-content: flex-start !important;
        justify-content: flex-start !important;
      }
      
      /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ã®èª¬æ˜æ–‡ã‚’å¼·èª¿ï¼ˆãƒ¡ãƒªãƒãƒªä»˜ããƒ»é‡ãªã‚Šé˜²æ­¢ãƒ»é…ç½®æœ€é©åŒ–ï¼‰ */
      .preview-card small {
        background: rgba(185, 151, 214, 0.1) !important;
        padding: 0.8rem !important;
        border-radius: 10px !important;
        border-left: 4px solid #B997D6 !important;
        margin: 0.3rem 0 !important; /* ä¸Šä¸‹ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        font-weight: 500 !important;
        line-height: 1.6 !important;
        font-size: 0.8rem !important; /* ç”»åƒä¿å­˜èª˜å°æ–‡ã¯å°ã•ã */
        color: #666 !important;
        position: relative !important;
        z-index: 2 !important; /* z-indexã‚’ä¸Šã’ã¦é‡ãªã‚Šã‚’é˜²æ­¢ */
        flex-shrink: 0 !important;
        width: 100% !important; /* å¹…ã‚’100%ã«è¨­å®š */
        box-sizing: border-box !important;
      }
      
      /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã®æœ€é©åŒ– */
      #cardCanvas {
        max-width: 100% !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
      }
      
      /* èª¬æ˜æ–‡ã®æœ€é©åŒ– */
      .preview-card small {
        font-size: 0.85rem !important;
        line-height: 1.5 !important;
        margin: 1rem 0 !important;
        padding: 0 0.5rem !important;
      }
      
      /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®æœ€é©åŒ–ï¼ˆä½™è£•ã®ã‚ã‚‹UIãƒ»é‡ãªã‚Šé˜²æ­¢ï¼‰ */
      .card-footer {
        flex-direction: column !important;
        align-items: stretch !important;
        gap: 0.8rem !important;
        margin-top: auto !important;
        padding-top: 0.8rem !important;
        border-top: 1px solid rgba(185, 151, 214, 0.2) !important;
        position: relative !important;
        z-index: 1 !important;
      }
      
      .card-footer button {
        width: 100% !important;
        padding: 0.8rem 1rem !important;
        font-size: 0.95rem !important; /* ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ã¯ä¸­ãã‚‰ã„ */
        border-radius: 12px !important;
        min-height: 44px !important; /* ã‚¿ãƒƒãƒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚µã‚¤ã‚ºã‚’ã•ã‚‰ã«æœ€é©åŒ– */
        font-weight: 600 !important;
        transition: all 0.3s ease !important;
        border: none !important;
        cursor: pointer !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
      }
      
      .card-footer button:active {
        transform: scale(0.96) !important;
        transition: transform 0.1s ease !important;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15) !important;
      }
      
      .card-footer button:hover {
        transform: translateY(-2px) !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
      }
      
      /* ãƒœã‚¿ãƒ³ã®è‰²åˆ†ã‘ã‚’æ˜ç¢ºåŒ– */
      #downloadBtn {
        background: linear-gradient(135deg, #4CAF50, #45a049) !important;
        color: white !important;
        border: none !important;
      }
      
      #twitterBtn {
        background: linear-gradient(135deg, #1DA1F2, #0d8bd9) !important;
        color: white !important;
        border: none !important;
      }
      
      #urlBtn {
        background: linear-gradient(135deg, #6c757d, #5a6268) !important;
        color: white !important;
        border: none !important;
      }
      
      /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ã®è¿½åŠ  */
      .scroll-guide {
        position: fixed !important;
        bottom: 20px !important;
        right: 20px !important;
        background: linear-gradient(135deg, rgba(185, 151, 214, 0.95), rgba(168, 149, 208, 0.9)) !important;
        color: white !important;
        padding: 0.8rem 1rem !important;
        border-radius: 25px !important;
        font-size: 0.9rem !important;
        font-weight: 600 !important;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25) !important;
        z-index: 1000 !important;
        animation: bounce 2s infinite !important;
        cursor: pointer !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
        backdrop-filter: blur(10px) !important;
        transition: all 0.3s ease !important;
      }
      
      .scroll-guide:hover {
        transform: translateY(-2px) !important;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3) !important;
        background: linear-gradient(135deg, rgba(185, 151, 214, 1), rgba(168, 149, 208, 1)) !important;
      }
      
      .scroll-guide::before {
        content: 'â†“' !important;
        font-size: 1.4rem !important;
        font-weight: bold !important;
        color: white !important;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
        /* çŸ¢å°ã‚¢ã‚¤ã‚³ãƒ³ã®ä»£æ›¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰ */
        /* content: 'â–¼' !important; */ /* é»’ã„ä¸‹å‘ãä¸‰è§’å½¢ */
        /* content: 'âŒ„' !important; */ /* ä¸‹å‘ãçŸ¢å°ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰ */
        /* content: 'âŒƒ' !important; */ /* ä¸Šå‘ãçŸ¢å°ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰ */
        /* content: 'â—„' !important; */ /* å·¦å‘ãçŸ¢å° */
        /* content: 'â–º' !important; */ /* å³å‘ãçŸ¢å° */
      }
      
      @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-10px);
        }
        60% {
          transform: translateY(-5px);
        }
      }
      
      /* ãƒ•ãƒƒã‚¿ãƒ¼ã®æœ€é©åŒ– */
      footer {
        margin-top: 2rem !important;
        padding: 1rem !important;
      }
      
      footer a {
        font-size: 0.9rem !important;
        padding: 0.5rem 1rem !important;
        border-radius: 6px !important;
        background: rgba(255, 255, 255, 0.1) !important;
        display: inline-block !important;
        margin: 0.3rem !important;
      }
    }
    
    /* è¶…å°å‹ã‚¹ãƒãƒ›å¯¾å¿œï¼ˆé‡ãªã‚Šé˜²æ­¢ãƒ»ç¸¦å¹…æœ€é©åŒ–ãƒ»å…¨è¦ç´ åå®¹å¯¾å¿œãƒ»é«˜ã•æœ€é©åŒ–ï¼‰ */
    @media (max-width: 375px) {
      .generator-container {
        padding: 0 0.8rem !important;
      }
      
      .form-card, .preview-card {
        padding: 1rem !important;
        min-height: 700px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ç¸¦å¹…ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
      }
      
      .form-card {
        min-height: 800px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ç¸¦å¹…ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
      }
      
      .preview-card {
        min-height: 600px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ç¸¦å¹…ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
      }
      
      .file-input-label {
        padding: 2rem 1rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ‹¡å¤§ */
        min-height: 140px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚é«˜ã•ã‚’æ‹¡å¤§ */
      }
      
      .form-group {
        margin-bottom: 2rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚é–“éš”ã‚’æ‹¡å¤§ */
      }
      
      .form-group input,
      .form-group select {
        padding: 1rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ‹¡å¤§ */
        min-height: 48px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚é«˜ã•ã‚’æ‹¡å¤§ */
      }
      
      .card-footer button {
        padding: 1rem 1.2rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ‹¡å¤§ */
        min-height: 52px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚é«˜ã•ã‚’æ‹¡å¤§ */
      }
    }
    
    /* æ¨ªå‘ãã‚¹ãƒãƒ›å¯¾å¿œï¼ˆç¸¦ä¸¦ã³ç¶­æŒãƒ»é‡ãªã‚Šé˜²æ­¢ãƒ»ç¸¦å¹…æœ€é©åŒ–ãƒ»å…¨è¦ç´ åå®¹å¯¾å¿œãƒ»é«˜ã•æœ€é©åŒ–ï¼‰ */
    @media (max-width: 768px) and (orientation: landscape) {
      .generator-container {
        padding: 0 1.5rem !important;
        margin: 0.5rem auto !important;
      }
      
      /* æ¨ªå‘ãã§ã‚‚ç¸¦ä¸¦ã³ã‚’ç¶­æŒ */
      .cards-grid {
        display: flex !important;
        flex-direction: column !important;
        gap: 1rem !important;
        grid: none !important;
      }
      
      .form-card, .preview-card {
        padding: 1rem !important;
        min-height: 600px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ç¸¦å¹…ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
      }
      
      .form-card {
        min-height: 700px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ç¸¦å¹…ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
      }
      
      .preview-card {
        min-height: 500px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚ç¸¦å¹…ã‚’ã•ã‚‰ã«æœ€é©åŒ– */
      }
      
      .file-input-label {
        min-height: 150px !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚é«˜ã•ã‚’æ‹¡å¤§ */
        padding: 1.5rem !important;
      }
      
      .form-group {
        margin-bottom: 2rem !important; /* å…¨è¦ç´ åå®¹ã®ãŸã‚é–“éš”ã‚’æ‹¡å¤§ */
      }
      
      .card-footer {
        flex-direction: row !important;
        gap: 0.6rem !important;
      }
      
      .card-footer button {
        flex: 1 !important;
        min-width: 0 !important;
        padding: 0.8rem 1rem !important;
        min-height: 48px !important;
      }
      
      /* æ¨ªå‘ãæ™‚ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ä½ç½®èª¿æ•´ */
      .scroll-guide {
        bottom: 15px !important;
        right: 15px !important;
        padding: 0.6rem 0.8rem !important;
        font-size: 0.8rem !important;
        /* æ¨ªå‘ãæ™‚ã¯çŸ¢å°ã‚¢ã‚¤ã‚³ãƒ³ã‚‚å°‘ã—å°ã•ã */
      }
      
      .scroll-guide::before {
        font-size: 1.2rem !important;
      }
    }

    /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—è¡¨ç¤ºã®å¼·åˆ¶æ¨ªä¸¦ã³ï¼ˆé‡è¦ãƒ»ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã¯ç„¡åŠ¹åŒ–ï¼‰ */
    @media (min-width: 769px) {
      .cards-grid {
        display: grid !important;
        grid-template-columns: 1fr 1fr !important;
        gap: 2rem !important;
        width: 100% !important;
        max-width: none !important;
        position: relative !important;
        overflow: visible !important;
        float: none !important;
        clear: both !important;
      }
      
      .generator-container {
        max-width: 1200px !important;
        margin: 0 auto !important;
        padding: 0 1rem !important;
      }
      
      .form-card, .preview-card {
        min-height: 500px !important;
        width: auto !important;
        flex: 1 !important;
        float: none !important;
        clear: none !important;
        max-width: none !important;
        position: relative !important;
        overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
        max-height: none !important; /* é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        display: flex !important; /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã¯Flexboxè¡¨ç¤º */
        flex-direction: column !important;
      }
    }
    
    /* é‡è¤‡ã™ã‚‹ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒªã‚’å‰Šé™¤ï¼ˆçµ±åˆç‰ˆã«çµ±åˆæ¸ˆã¿ï¼‰ */

    /* é‡è¤‡ã™ã‚‹ã‚¿ãƒƒãƒæ“ä½œæœ€é©åŒ–ã‚’å‰Šé™¤ï¼ˆçµ±åˆç‰ˆã«çµ±åˆæ¸ˆã¿ï¼‰ */
    
    /* ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      z-index: 10000;
      font-size: 14px;
      transition: opacity 0.3s ease;
    }

    .toast.show {
      opacity: 1;
    }

    .toast.hide {
      opacity: 0;
    }

    /* ãƒ‡ãƒãƒƒã‚°ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ã¯å‰Šé™¤æ¸ˆã¿ï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå•é¡Œè§£æ±ºå®Œäº†ï¼‰ */
    
    /* æ ¹æœ¬åŸå› ä¿®æ­£ï¼šstyle.cssã®mainè¦ç´ ã‚°ãƒªãƒƒãƒ‰è¨­å®šã‚’ç„¡åŠ¹åŒ– */
    .generator-container {
      display: block !important;
      grid-template-columns: none !important;
      gap: 0 !important;
    }
    
    /* ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã®å¼·åˆ¶é©ç”¨ï¼ˆæœ€å¼·ç‰ˆï¼‰ */
    @media (max-width: 768px) {
      /* ã‚«ãƒ¼ãƒ‰ã®é«˜ã•ã‚’å¼·åˆ¶çš„ã«è¨­å®š */
      .generator-container .cards-grid .form-card {
        min-height: 800px !important;
        max-height: none !important;
        height: auto !important;
        padding: 1rem !important;
        overflow: visible !important;
      }
      
      .generator-container .cards-grid .preview-card {
        min-height: 600px !important;
        max-height: none !important;
        height: auto !important;
        padding: 1rem !important;
        overflow: visible !important;
      }
      
      /* ã‚«ãƒ¼ãƒ‰å†…ã®è¦ç´ é–“éš”ã‚’å¼·åˆ¶çš„ã«è¨­å®š */
      .generator-container .cards-grid .form-card > *,
      .generator-container .cards-grid .preview-card > * {
        margin-bottom: 1rem !important;
      }
      
      /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®é–“éš”ã‚’å¼·åˆ¶çš„ã«è¨­å®š */
      .generator-container .cards-grid .form-card .form-group {
        margin-bottom: 1rem !important;
      }
      
      /* ç”»åƒé¸æŠã‚¨ãƒªã‚¢ã‚’å¼·åˆ¶çš„ã«è¨­å®š */
      .generator-container .cards-grid .form-card .file-input-label {
        padding: 1.5rem 1rem !important;
        min-height: 120px !important;
        margin-bottom: 1rem !important;
      }
      
      /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤ºï¼ˆã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã®ã¿ï¼‰ */
      .scroll-guide {
        display: flex !important;
      }
    }
    
    /* PCã‚µã‚¤ã‚ºã§ã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ã‚’å®Œå…¨ã«éè¡¨ç¤º */
    @media (min-width: 769px) {
      .scroll-guide {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        pointer-events: none !important;
        position: absolute !important;
        left: -9999px !important;
        top: -9999px !important;
      }
    }
    
    /* style.cssã®mainè¦ç´ ã‚°ãƒªãƒƒãƒ‰è¨­å®šã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ– */
    main.generator-container {
      display: block !important;
      grid-template-columns: none !important;
      gap: 0 !important;
      max-width: 1200px !important;
      margin: 0 auto !important;
      padding: 0 1rem !important;
    }
    
    /* ã™ã¹ã¦ã®mainè¦ç´ ã®ã‚°ãƒªãƒƒãƒ‰è¨­å®šã‚’ç„¡åŠ¹åŒ–ï¼ˆç¢ºå®Ÿæ€§ã®ãŸã‚ï¼‰ */
    main {
      display: block !important;
      grid-template-columns: none !important;
      gap: 0 !important;
    }
    
    /* style.cssã®mainè¦ç´ ã‚°ãƒªãƒƒãƒ‰è¨­å®šã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ– */
    main.generator-container {
      display: block !important;
      grid-template-columns: none !important;
      gap: 0 !important;
      max-width: 1200px !important;
      margin: 0 auto !important;
      padding: 0 1rem !important;
    }
    
    /* ã‚ˆã‚Šå…·ä½“çš„ãªã‚»ãƒ¬ã‚¯ã‚¿ã§ç„¡åŠ¹åŒ– */
    body > main.generator-container {
      display: block !important;
      grid-template-columns: none !important;
      gap: 0 !important;
    }
    
    /* ã™ã¹ã¦ã®mainè¦ç´ ã®ã‚°ãƒªãƒƒãƒ‰è¨­å®šã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ– */
    main, main.generator-container, body > main {
      display: block !important;
      grid-template-columns: none !important;
      gap: 0 !important;
      grid-template-rows: none !important;
      grid-auto-flow: none !important;
      align-items: stretch !important;
      justify-items: stretch !important;
    }
    
    /* ã‚ˆã‚Šå¼·åŠ›ãªç„¡åŠ¹åŒ– */
    *[class*="generator"] {
      display: block !important;
      grid-template-columns: none !important;
      gap: 0 !important;
    }
    
    /* style.cssã®ã™ã¹ã¦ã®ã‚°ãƒªãƒƒãƒ‰è¨­å®šã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ– */
    main, main.generator-container, body > main,
    main[style*="grid"], main[class*="generator"] {
      display: block !important;
      grid-template-columns: none !important;
      grid-template-rows: none !important;
      gap: 0 !important;
      grid-auto-flow: none !important;
      align-items: stretch !important;
      justify-items: stretch !important;
      grid-template-areas: none !important;
      grid-area: auto !important;
    }
    
    /* ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒªå†…ã®ã‚°ãƒªãƒƒãƒ‰è¨­å®šã‚‚ç„¡åŠ¹åŒ– */
    @media (max-width: 768px) {
      main, main.generator-container, body > main {
        display: block !important;
        grid-template-columns: none !important;
        grid-template-rows: none !important;
        gap: 0 !important;
        grid-auto-flow: none !important;
        align-items: stretch !important;
        justify-items: stretch !important;
      }
    }
    
    /* ã‚ˆã‚Šå…·ä½“çš„ãªã‚»ãƒ¬ã‚¯ã‚¿ã§ç„¡åŠ¹åŒ– */
    body > main.generator-container,
    html body main.generator-container,
    .generator-container {
      display: block !important;
      grid-template-columns: none !important;
      grid-template-rows: none !important;
      gap: 0 !important;
      grid-auto-flow: none !important;
      align-items: stretch !important;
      justify-items: stretch !important;
      grid-template-areas: none !important;
      grid-area: auto !important;
    }
    
    /* cards-gridã®ã‚°ãƒªãƒƒãƒ‰è¨­å®šã‚’ç¢ºå®Ÿã«æœ‰åŠ¹åŒ–ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚µã‚¤ã‚ºã®ã¿ï¼‰ */
    @media (min-width: 769px) {
      .cards-grid {
        display: grid !important;
        grid-template-columns: 1fr 1fr !important;
        grid-template-rows: 1fr !important;
        gap: 2rem !important;
        width: 100% !important;
        max-width: none !important;
        min-height: 550px !important;
        height: 550px !important;
        align-items: stretch !important;
        justify-items: stretch !important;
        position: relative !important;
        overflow: visible !important;
        float: none !important;
        clear: both !important;
        box-sizing: border-box !important;
        margin: 0 !important;
        padding: 0 !important;
        grid-auto-flow: row !important;
        grid-auto-rows: 1fr !important;
      }
    }
    
    /* ãƒ•ã‚©ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ã®é«˜ã•çµ±ä¸€ï¼ˆPCã‚µã‚¤ã‚ºã®ã¿ãƒ»ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã¯ç„¡åŠ¹åŒ–ï¼‰ */
    @media (min-width: 769px) {
      .form-card, .preview-card {
        height: 550px !important;
        min-height: 550px !important;
        max-height: 550px !important;
        display: flex !important;
        flex-direction: column !important;
        justify-content: flex-start !important;
        align-items: stretch !important;
        box-sizing: border-box !important;
        overflow: hidden !important;
        position: relative !important;
        top: 0 !important;
        margin-top: 0 !important;
        padding-top: 1.5rem !important;
      }
    }
    
          /* ã‚«ãƒ¼ãƒ‰å†…ã®è¦ç´ ã‚’å¼·åˆ¶çš„ã«é…ç½®ï¼ˆPCã‚µã‚¤ã‚ºã®ã¿ãƒ»ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã¯ç„¡åŠ¹åŒ–ï¼‰ */
      @media (min-width: 769px) {
        .form-card > *, .preview-card > * {
          box-sizing: border-box !important;
          margin: 0 !important;
          height: auto !important; /* é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
          overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
          max-height: none !important; /* æœ€å¤§é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        }
        
        /* ã‚«ãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼ã®èª¿æ•´ï¼ˆé«˜ã•çµ±ä¸€ãƒ»è¦ç´ åˆ‡ã‚Œé˜²æ­¢ï¼‰ */
        .form-card h2, .preview-card .card-header {
          margin-top: 0 !important;
          margin-bottom: 1rem !important;
          flex-shrink: 0 !important;
          height: auto !important;
          line-height: 1.2 !important;
          padding: 0 !important;
          overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
          max-height: none !important; /* æœ€å¤§é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        }
        
        /* ã‚«ãƒ¼ãƒ‰ãƒœãƒ‡ã‚£ã®èª¿æ•´ï¼ˆé«˜ã•çµ±ä¸€ãƒ»è¦ç´ åˆ‡ã‚Œé˜²æ­¢ï¼‰ */
        .form-card #studentForm, .preview-card .card-body {
          flex: 1 !important;
          display: flex !important;
          flex-direction: column !important;
          justify-content: flex-start !important;
          align-items: stretch !important;
          min-height: 0 !important;
          height: auto !important;
          margin: 0 !important;
          padding: 0 !important;
          overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
          max-height: none !important; /* æœ€å¤§é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        }
        
        /* ã‚«ãƒ¼ãƒ‰ãƒ•ãƒƒã‚¿ãƒ¼ã®èª¿æ•´ï¼ˆé«˜ã•çµ±ä¸€ãƒ»è¦ç´ åˆ‡ã‚Œé˜²æ­¢ï¼‰ */
        .form-card #diagnosisButtons, .preview-card .card-footer {
          margin-top: 1.5rem !important; /* autoã‹ã‚‰å›ºå®šå€¤ã«å¤‰æ›´ */
          padding-top: 1rem !important;
          flex-shrink: 0 !important;
          height: auto !important;
          position: relative !important;
          bottom: 0 !important;
          overflow: visible !important; /* è¦ç´ ã®åˆ‡ã‚Œã‚’é˜²ã */
          max-height: none !important; /* æœ€å¤§é«˜ã•åˆ¶é™ã‚’è§£é™¤ */
        }
      }
    
    /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ã®å†…å®¹ã‚’ä¸­å¤®ã«é…ç½®ï¼ˆPCã‚µã‚¤ã‚ºã®ã¿ãƒ»ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã¯ç„¡åŠ¹åŒ–ï¼‰ */
    @media (min-width: 769px) {
      .preview-card .card-body {
        align-items: center !important;
        justify-content: center !important;
        flex: 1 !important;
      }
      
      /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã®ã‚µã‚¤ã‚ºèª¿æ•´ */
      #cardCanvas {
        max-width: 100% !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
      }
      
      /* èª¬æ˜æ–‡ã®é…ç½®èª¿æ•´ */
      .preview-card small {
        margin-top: 1rem !important;
        text-align: center !important;
        line-height: 1.4 !important;
        flex-shrink: 0 !important;
      }
      
      /* ã‚«ãƒ¼ãƒ‰å†…ã®è¦ç´ ã‚’å¼·åˆ¶çš„ã«é…ç½® */
      .form-card > *, .preview-card > * {
        box-sizing: border-box !important;
      }
      
      /* ã‚«ãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼ã®èª¿æ•´ */
      .form-card h2, .preview-card .card-header {
        margin-top: 0 !important;
        margin-bottom: 1rem !important;
        flex-shrink: 0 !important;
      }
      
      /* ã‚«ãƒ¼ãƒ‰ãƒœãƒ‡ã‚£ã®èª¿æ•´ */
      .form-card #studentForm, .preview-card .card-body {
        flex: 1 !important;
        display: flex !important;
        flex-direction: column !important;
        justify-content: flex-start !important;
      }
      
      /* ã‚«ãƒ¼ãƒ‰ãƒ•ãƒƒã‚¿ãƒ¼ã®èª¿æ•´ */
      .form-card #diagnosisButtons, .preview-card .card-footer {
        margin-top: auto !important;
        padding-top: 1rem !important;
        flex-shrink: 0 !important;
      }
      
      /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ã®å†…å®¹ã‚’ä¸­å¤®ã«é…ç½® */
      .preview-card .card-body {
        align-items: center !important;
        justify-content: center !important;
      }
      
      /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã®ã‚µã‚¤ã‚ºèª¿æ•´ */
      #cardCanvas {
        max-width: 100% !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
      }
      
      /* èª¬æ˜æ–‡ã®é…ç½®èª¿æ•´ */
      .preview-card small {
        margin-top: 1rem !important;
        text-align: center !important;
        line-height: 1.4 !important;
      }
    }
  </style>
  <script>
    // ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯é«˜åº¦å¯¾ç­–ã‚’OFFï¼ˆç”»åƒä¿å­˜ãƒ»Canvasæ“ä½œã®ãŸã‚ï¼‰
    window.AdvancedSecurityConfig = { preventSideChannelAttacks: false };
  </script>
  <!-- ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ãƒ¼ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ããƒ»è‡ªå‰ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºå®šï¼‰ -->
  <script>
    (function () {
      // ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã‚’è‡ªå‹•åˆ¤å®š
      const MY_ORIGIN = location.hostname === 'localhost' || location.hostname === '127.0.0.1' 
        ? location.origin 
        : 'https://student-id-generator.pages.dev';

      // åŸ‹ã‚è¾¼ã¿å…ˆ(preview.studio.siteç­‰)ã§ã¯å¸¸ã«è‡ªåˆ†ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰èª­ã¿è¾¼ã‚€
      window.APP_ORIGIN = MY_ORIGIN;
      
      // app.jsèª­ã¿è¾¼ã¿ãƒ•ãƒ©ã‚°ï¼ˆé‡è¤‡é˜²æ­¢ç”¨ï¼‰
      if (typeof window.APP_JS_LOADED === 'undefined') {
        window.APP_JS_LOADED = false;
      }

      function loadWithFallback(primary, fallback) {
        const s = document.createElement('script');
        s.defer = true;
        s.src = APP_ORIGIN + '/' + primary;
        s.setAttribute('data-loaded', 'true');
        s.onload = () => {
          console.log('âœ… loadWithFallbackå®Œäº†:', primary);
          // åˆæœŸåŒ–ã‚’ç¢ºå®Ÿã«å®Ÿè¡Œ
          setTimeout(() => {
            if (typeof window.initGeneratorPage === 'function') {
              console.log('ğŸ”„ loadWithFallbackã‹ã‚‰initGeneratorPageã‚’å®Ÿè¡Œä¸­...');
              window.initGeneratorPage();
            } else {
              console.log('âŒ loadWithFallbackã‹ã‚‰initGeneratorPageãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
          }, 100);
        };
        s.onerror = () => {
          if (!fallback) return;
          console.log('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ' + primary + ' â†’ ' + fallback);
          const s2 = document.createElement('script');
          s2.defer = true;
          s2.src = fallback;
          s2.setAttribute('data-loaded', 'true');
          s2.onload = () => {
            console.log('âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Œäº†:', fallback);
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ã‚‚åˆæœŸåŒ–ã‚’å®Ÿè¡Œ
            setTimeout(() => {
              if (typeof window.initGeneratorPage === 'function') {
                console.log('ğŸ”„ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‹ã‚‰initGeneratorPageã‚’å®Ÿè¡Œä¸­...');
                window.initGeneratorPage();
              } else {
                console.log('âŒ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‹ã‚‰initGeneratorPageãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
              }
            }, 100);
          };
          document.head.appendChild(s2);
        };
        document.head.appendChild(s);
      }

      function load(p) {
        const s = document.createElement('script');
        s.src = APP_ORIGIN + '/' + p;
        s.defer = true;
        document.head.appendChild(s);
      }

      // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç³»ï¼ˆç¾çŠ¶ã®ã¾ã¾ã§OKï¼‰
      load('assets/js/comprehensive-security.js');
      load('assets/js/security.js');
      load('assets/js/privacy-protection.js');
      load('assets/js/security-monitor.js');

      // app.jsã¯æœ€å¾Œã«èª­ã¿è¾¼ã¿ï¼ˆä¾å­˜é–¢ä¿‚ã®ãŸã‚ï¼‰
      setTimeout(() => {
        // æ—¢ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        if (typeof window.drawStudentCard === 'undefined' && !window.APP_JS_LOADED) {
          console.log('ğŸ”„ app.jsã‚’èª­ã¿è¾¼ã¿ä¸­...');
          window.APP_JS_LOADED = true;
          loadWithFallback('assets/js/app.js?v=20250902', 'assets/js/app.js?v=20250902');
        } else {
          console.log('âœ… app.jsã¯æ—¢ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™');
        }
      }, 100);
      
      // ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã®é‡è¤‡èª­ã¿è¾¼ã¿é˜²æ­¢
      if (window.APP_JS_LOADED) {
        console.log('âœ… ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã®é‡è¤‡èª­ã¿è¾¼ã¿é˜²æ­¢');
      }
      
      // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°
      console.log('âœ… ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ­ãƒ¼ãƒ€ãƒ¼åˆæœŸåŒ–å®Œäº†');
      console.log('APP_ORIGIN:', APP_ORIGIN);
      console.log('ç¾åœ¨ã®URL:', window.location.href);
      console.log('ç›¸å¯¾ãƒ‘ã‚¹ãƒ†ã‚¹ãƒˆ:', new URL('assets/js/app.js', window.location.href).href);
    })();
  </script>
  
  <!-- å…±æœ‰URLç”Ÿæˆæ©Ÿèƒ½ -->
  <script>
    // å…±æœ‰ç”¨ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã¯ç¾åœ¨ã®ã‚ªãƒªã‚¸ãƒ³ã‚’ä½¿ç”¨ï¼‰
    const SHARE_BASE = location.hostname === 'localhost' || location.hostname === '127.0.0.1' 
      ? location.origin 
      : 'https://student-id-generator.pages.dev';
    
    // Cloudinaryè¨­å®šï¼ˆapp.jsã¨åŒæœŸã€äºŒé‡å®šç¾©é˜²æ­¢ï¼‰
    window.cloudinaryConfig ??= { 
      cloudName: 'di5xqlddy', 
      uploadPreset: 'student_card_AS_chronicle' 
    };

    // Base64URLé–¢æ•°ã¯å‰Šé™¤æ¸ˆã¿ï¼ˆçŸ­ã„å›ºå®šå½¢å¼ã«çµ±ä¸€ï¼‰

    <!-- å…±æœ‰URLç”Ÿæˆã¯ app.js ã®å®Ÿè£…ã‚’åˆ©ç”¨ï¼ˆå†å®šç¾©ã—ãªã„ï¼‰ -->
    
    // å…±æœ‰ãƒªãƒ³ã‚¯æ›´æ–°é–¢æ•°ï¼ˆapp.jsã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ï¼‰â€¦UIã¯ä¿æŒã®ã¿ã€ãƒãƒ³ãƒ‰ãƒ©ã¯app.jsãŒå‚ç…§
    function updateShareLinksWithImage(imageData, text) {
      const shareUrl = buildShareUrlWithImage({
        public_id: imageData.public_id,
        version: imageData.version
      });
      console.log('å…±æœ‰URLæ›´æ–°:', shareUrl);
      // å…±æœ‰URLã‚’ä¿å­˜
      window.__shareUrl = shareUrl;
      
      // URLã‚³ãƒ”ãƒ¼
      const urlBtn = document.getElementById('urlBtn');
      if (urlBtn) urlBtn.onclick = () => copyTextReliable(window.__shareUrl);
      
      // ç”»åƒç”Ÿæˆå¾Œã¯å…±æœ‰ç´ æã‚’æœ€æ–°ã«æ›´æ–°ï¼ˆå¸¸æ™‚ãƒã‚¤ãƒ³ãƒ‰æ¸ˆã¿ãƒãƒ³ãƒ‰ãƒ©ãŒã“ã‚Œã‚’å‚ç…§ã™ã‚‹ï¼‰
      window.__lastImageData = imageData;
      window.__ogpImageUrl = `${location.origin}/ogp/v${imageData.version}/${imageData.public_id.split('/').map(encodeURIComponent).join('/')}.jpg`;
      
      // è¡¨ç¤ºç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚Œã°æ›´æ–°
      const field = document.getElementById('shareLinkField');
      if (field) field.value = shareUrl;
    }
    window.updateShareLinksWithImage = updateShareLinksWithImage;
    

    
    // âœ… ãƒšãƒ¼ã‚¸èª­è¾¼æ™‚ã«"å¸¸æ™‚"ãƒã‚¤ãƒ³ãƒ‰ï¼ˆç”»åƒç”Ÿæˆã®æœ‰ç„¡ã«é–¢ã‚ã‚‰ãšå‹•ãï¼‰
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('twitterBtn');
      if (!btn) return;
      btn.addEventListener('click', async (e) => {
        e.preventDefault(); e.stopPropagation();
        try {
          const last = window.loadResult?.();
          if (!last || !last.public_id || !last.version) {
            alert('å…ˆã«å­¦ç”Ÿè¨¼ã‚’ä½œæˆã—ã¦ãã ã•ã„'); return;
          }
          // å…±æœ‰URLã¯ app.js ã®å®Ÿè£…ã‚’ä½¿ã†
          const shareUrl = window.buildShareUrlWithImage?.({
            public_id: last.public_id,
            version  : last.version,
            eager_url: last.eager_url || last.secure_url
          });
          const text = [
            'ã‚ˆã†ã“ãã€å¤¢è¦‹ãŒä¸˜å¥³å­é«˜ç­‰å­¦æ ¡ã¸ï¼',
            'ã€€å¿˜ã‚Œã‚‰ã‚Œãªã„æ”¾èª²å¾Œã‚’ã€ã‚ãªãŸã«ã€‚',
            'âœï¸ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿',
            '',
            'â–¼ #æ”¾èª²å¾Œã‚¯ãƒ­ãƒ‹ã‚¯ãƒ«ã€€ã®HPã§è‡ªåˆ†ã ã‘ã®å­¦ç”Ÿè¨¼ã‚’ä½œã‚ã†ï¼'
          ].join('\n');
          // iOSã¯ã‚¢ãƒ—ãƒªã®ã¿ãƒ»ä»–ã¯Intentæ–°è¦ã‚¿ãƒ–
          await window.shareToXAppFirstOnly?.(last.eager_url || last.secure_url, `${text}\n${shareUrl}`);
        } catch (e){}
      }, { passive: false });
    });

    // ãƒ•ã‚©ãƒ¼ãƒ åˆæœŸåŒ–å‡¦ç†ã¯ app.js ã® initGeneratorPage ã«çµ±åˆ
    

  </script>
  
  <!-- ç›´ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢ï¼šè¨ºæ–­æœªå®Ÿæ–½ãªã‚‰è¨ºæ–­ã‚²ãƒ¼ãƒ ã¸èª˜å° -->
  <script>
    (() => {
      // â‘  æ—¢ã«ä¸€åº¦ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãŸã‚‰äºŒåº¦ç›®ã¯ã—ãªã„ï¼ˆãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰
      if (sessionStorage.getItem('redir_guard') === '1') return;

      // StudioåŸ‹ã‚è¾¼ã¿æ™‚ã¯ç›´ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢ã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ–
      try {
        if (document.referrer && (
            document.referrer.includes('preview.studio.site') ||
            document.referrer.includes('studio.site') ||
            document.referrer.includes('embed') ||
            document.referrer.includes('iframe')
        )) {
          console.log('ğŸš€ StudioåŸ‹ã‚è¾¼ã¿ç’°å¢ƒæ¤œå‡ºã€ç›´ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢ã‚’ç„¡åŠ¹åŒ–');
          return;
        }
        
        const currentUrl = window.location.href;
        if (currentUrl.includes('preview.studio.site') || 
            currentUrl.includes('studio.site') || 
            currentUrl.includes('embed') ||
            currentUrl.includes('iframe') ||
            currentUrl.includes('live/')) {
          console.log('ğŸš€ Studioç’°å¢ƒURLæ¤œå‡ºã€ç›´ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢ã‚’ç„¡åŠ¹åŒ–');
          return;
        }
        
        if (window.parent !== window || window.top !== window) {
          console.log('ğŸš€ iframeç’°å¢ƒæ¤œå‡ºã€ç›´ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢ã‚’ç„¡åŠ¹åŒ–');
          return;
        }
        
        if (sessionStorage.getItem('studio_embed_flag') === '1') {
          console.log('ğŸš€ Studioãƒ•ãƒ©ã‚°æ¤œå‡ºã€ç›´ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢ã‚’ç„¡åŠ¹åŒ–');
          return;
        }
      } catch(e) {
        console.log('ğŸš€ ä¾‹å¤–ç™ºç”Ÿã«ã‚ˆã‚ŠåŸ‹ã‚è¾¼ã¿æ‰±ã„ã€ç›´ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢ã‚’ç„¡åŠ¹åŒ–');
        return;
      }

      const sp = new URLSearchParams(location.search);
      const hasParams = ['department','course','club'].some(k => sp.has(k));

      const hasCtx =
        sessionStorage.getItem('diagCtx') ||
        sessionStorage.getItem('as_chronicle_diagnosis') ||
        sessionStorage.getItem('as_chronicle_last_result');

      // â‘¡ åŸ‹ã‚è¾¼ã¿åˆ¤å®šã‚’æœ€å¼·åŒ–ï¼ˆStudioç’°å¢ƒã§ã®ç¢ºå®Ÿãªæ¤œå‡ºï¼‰
      function isEmbedded() {
        console.log('ğŸ” åŸ‹ã‚è¾¼ã¿åˆ¤å®šé–‹å§‹ - ç¾åœ¨ã®çŠ¶æ³:', {
          url: window.location.href,
          searchParams: Object.fromEntries(sp.entries()),
          referrer: document.referrer,
          hostname: window.location.hostname,
          parent: window.parent !== window,
          top: window.top !== window
        });
        
        try { 
          // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æ˜ç¤ºçš„ã«åŸ‹ã‚è¾¼ã¿æŒ‡å®š
          if (sp.get('embed') === '1') {
            console.log('âœ… URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿embed=1ã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º');
            return true; 
          }
          if (sp.get('studio') === '1') {
            console.log('âœ… URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿studio=1ã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º');
            return true; // Studioç’°å¢ƒç”¨
          }
          if (sp.get('iframe') === '1') {
            console.log('âœ… URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿iframe=1ã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º');
            return true; // iframeç”¨
          }
        } catch(_) {}
        
        try { 
          // iframeå†…ã§ã®å®Ÿè¡Œ
          if (window.parent && window.parent !== window) {
            console.log('âœ… window.parentåˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º');
            return true; 
          }
        } catch(_) { 
          console.log('âœ… ä¾‹å¤–ç™ºç”Ÿã§åŸ‹ã‚è¾¼ã¿æ‰±ã„');
          return true; // ä¾‹å¤–ï¼åŸ‹ã‚è¾¼ã¿æ‰±ã„
        }
        
        try {
          // ãƒªãƒ•ã‚¡ãƒ©ãŒä»–ã‚ªãƒªã‚¸ãƒ³ï¼ˆpreview.studio.site ç­‰ï¼‰ãªã‚‰åŸ‹ã‚è¾¼ã¿
          if (document.referrer && !document.referrer.startsWith(location.origin)) {
            console.log('ğŸ” ãƒªãƒ•ã‚¡ãƒ©åˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º:', document.referrer);
            return true;
          }
          
          // ancestorOrigins ãŒä½¿ãˆã‚‹ç’°å¢ƒãªã‚‰ç¥–å…ˆãŒå­˜åœ¨ã™ã‚Œã°åŸ‹ã‚è¾¼ã¿
          if (location.ancestorOrigins && location.ancestorOrigins.length > 0) {
            console.log('ğŸ” ancestorOriginsåˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º:', location.ancestorOrigins);
            return true;
          }
          
          // Studioç’°å¢ƒã®ç‰¹å¾´çš„ãªåˆ¤å®š
          if (window.location.hostname !== 'student-id-generator.pages.dev' && 
              window.location.hostname !== 'localhost' && 
              window.location.hostname !== '127.0.0.1') {
            console.log('ğŸ” ãƒ›ã‚¹ãƒˆååˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º:', window.location.hostname);
            return true;
          }
          
          // ã‚ˆã‚Šå³å¯†ãªåŸ‹ã‚è¾¼ã¿åˆ¤å®š
          if (window.top !== window) {
            console.log('ğŸ” window.topåˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º');
            return true;
          }
          
          // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®åˆ¤å®š
          if (window.isSecureContext === false) {
            console.log('ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º');
            return true;
          }
          
          // è¿½åŠ ã®åŸ‹ã‚è¾¼ã¿åˆ¤å®š
          if (window.frameElement) {
            console.log('ğŸ” frameElementåˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º');
            return true;
          }
          
          // ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆã®åˆ¤å®šï¼ˆåŸ‹ã‚è¾¼ã¿æ™‚ã¯ç•°ãªã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ï¼‰
          const computedStyle = window.getComputedStyle(document.body);
          if (computedStyle && computedStyle.getPropertyValue('--studio-embed')) {
            console.log('ğŸ” CSSå¤‰æ•°åˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º');
            return true;
          }
          
          // æœ¬ç•ªç’°å¢ƒã§ã®åŸ‹ã‚è¾¼ã¿åˆ¤å®šã‚’å¼·åŒ–
          try {
            // æœ¬ç•ªç’°å¢ƒï¼ˆstudent-id-generator.pages.devï¼‰ã§ã®åŸ‹ã‚è¾¼ã¿åˆ¤å®š
            if (window.location.hostname === 'student-id-generator.pages.dev') {
              // ãƒªãƒ•ã‚¡ãƒ©ãŒStudioç’°å¢ƒã‹ã‚‰ã®å ´åˆ
              if (document.referrer && (
                  document.referrer.includes('preview.studio.site') ||
                  document.referrer.includes('studio.site') ||
                  document.referrer.includes('embed') ||
                  document.referrer.includes('iframe')
              )) {
                console.log('âœ… æœ¬ç•ªç’°å¢ƒã§ã®StudioåŸ‹ã‚è¾¼ã¿æ¤œå‡º:', document.referrer);
                return true;
              }
              
              // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«åŸ‹ã‚è¾¼ã¿é–¢é€£ã®æƒ…å ±ãŒã‚ã‚‹å ´åˆ
              const currentUrl = window.location.href;
              if (currentUrl.includes('embed') || currentUrl.includes('studio') || currentUrl.includes('iframe')) {
                console.log('âœ… æœ¬ç•ªç’°å¢ƒã§ã®URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŸ‹ã‚è¾¼ã¿æ¤œå‡º:', currentUrl);
                return true;
              }
              
              // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«åŸ‹ã‚è¾¼ã¿ãƒ•ãƒ©ã‚°ãŒã‚ã‚‹å ´åˆ
              if (sessionStorage.getItem('studio_embed_flag') === '1') {
                console.log('âœ… æœ¬ç•ªç’°å¢ƒã§ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åŸ‹ã‚è¾¼ã¿ãƒ•ãƒ©ã‚°æ¤œå‡º');
                return true;
              }
              
              // ã‚ˆã‚Šå¼·åŠ›ãªStudioåŸ‹ã‚è¾¼ã¿åˆ¤å®š
              try {
                // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®URLãŒStudioç’°å¢ƒã‹ã©ã†ã‹ã®åˆ¤å®šï¼ˆã‚ˆã‚Šå³å¯†ï¼‰
                if (currentUrl.includes('preview.studio.site') || 
                    currentUrl.includes('studio.site') || 
                    currentUrl.includes('embed') ||
                    currentUrl.includes('iframe') ||
                    currentUrl.includes('live/')) {
                  console.log('âœ… æœ¬ç•ªç’°å¢ƒã§ã®URLè©³ç´°åˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º:', currentUrl);
                  return true;
                }
              } catch(_) {}
              
              // Studioç’°å¢ƒã®ç‰¹å¾´çš„ãªåˆ¤å®šï¼ˆã‚ˆã‚Šå³å¯†ï¼‰
              if (window.location.hostname === 'preview.studio.site' || 
                  window.location.hostname.endsWith('.studio.site') ||
                  window.location.hostname.includes('studio.site')) {
                console.log('âœ… Studioç’°å¢ƒå°‚ç”¨åˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º:', window.location.hostname);
                return true;
              }
            }
          } catch(_) {}
          
          // ã‚ˆã‚Šå¼·åŠ›ãªåŸ‹ã‚è¾¼ã¿åˆ¤å®š
          try {
            // ç¾åœ¨ã®URLãŒStudioç’°å¢ƒã‹ã©ã†ã‹ã®åˆ¤å®š
            const currentUrl = window.location.href;
            if (currentUrl.includes('preview.studio.site') || 
                currentUrl.includes('studio.site') || 
                currentUrl.includes('embed') ||
                currentUrl.includes('iframe')) {
              console.log('ğŸ” URLåˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º:', currentUrl);
              return true;
            }
          } catch(_) {}
          
          // æœ€çµ‚çš„ãªåŸ‹ã‚è¾¼ã¿åˆ¤å®šï¼ˆã‚ˆã‚Šå³å¯†ï¼‰
          try {
            // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®åˆ¤å®š
            if (window.trustedTypes && window.trustedTypes.defaultPolicy) {
              console.log('ğŸ” trustedTypesåˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º');
              return true;
            }
          } catch(_) {}
          
          // è¿½åŠ ã®åŸ‹ã‚è¾¼ã¿åˆ¤å®š
          try {
            // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚„ãƒ¡ã‚¿æƒ…å ±ã§åˆ¤å®š
            if (document.title && document.title.includes('Studio')) {
              console.log('âœ… ã‚¿ã‚¤ãƒˆãƒ«åˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º');
              return true;
            }
            
            // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®URLãƒ‘ã‚¹ã§åˆ¤å®š
            if (window.location.pathname && window.location.pathname.includes('studio')) {
              console.log('âœ… ãƒ‘ã‚¹åˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º');
              return true;
            }
            
            // ã‚ˆã‚Šå³å¯†ãªStudioç’°å¢ƒåˆ¤å®š
            if (window.location.hostname.includes('studio') || 
                window.location.hostname.includes('preview') ||
                window.location.hostname.includes('embed')) {
              console.log('âœ… ãƒ›ã‚¹ãƒˆåè©³ç´°åˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º:', window.location.hostname);
              return true;
            }
            
            // ãƒªãƒ•ã‚¡ãƒ©ã®è©³ç´°åˆ¤å®š
            if (document.referrer && (
                document.referrer.includes('studio') ||
                document.referrer.includes('preview') ||
                document.referrer.includes('embed') ||
                document.referrer.includes('iframe')
            )) {
              console.log('âœ… ãƒªãƒ•ã‚¡ãƒ©è©³ç´°åˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º:', document.referrer);
              return true;
            }
            
            // Studioç’°å¢ƒã®ç‰¹å¾´çš„ãªåˆ¤å®šï¼ˆã‚ˆã‚Šå³å¯†ï¼‰
            if (window.location.hostname === 'preview.studio.site' || 
                window.location.hostname.endsWith('.studio.site') ||
                window.location.hostname.includes('studio.site')) {
              console.log('âœ… Studioç’°å¢ƒå°‚ç”¨åˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º:', window.location.hostname);
              return true;
            }
            
            // ã‚ˆã‚Šå¼·åŠ›ãªåŸ‹ã‚è¾¼ã¿åˆ¤å®š
            try {
              // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®URLãŒStudioç’°å¢ƒã‹ã©ã†ã‹ã®åˆ¤å®šï¼ˆã‚ˆã‚Šå³å¯†ï¼‰
              const currentUrl = window.location.href;
              if (currentUrl.includes('preview.studio.site') || 
                  currentUrl.includes('studio.site') || 
                  currentUrl.includes('embed') ||
                  currentUrl.includes('iframe') ||
                  currentUrl.includes('live/')) {
                console.log('âœ… URLè©³ç´°åˆ¤å®šã§åŸ‹ã‚è¾¼ã¿æ¤œå‡º:', currentUrl);
                return true;
              }
            } catch(_) {}
            
          } catch(_) {}
          
        } catch(_) {}
        
        return false;
      }
      const inEmbed = isEmbedded();

      // â‘¢ æœ¬å½“ã«"ç›´ãƒªãƒ³ã‚¯"ã ã‘è·³ã­ã‚‹ï¼ˆåŸ‹ã‚è¾¼ã¿æ™‚ã¯çµ¶å¯¾ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãªã„ï¼‰
      if (!hasParams && !hasCtx && !inEmbed) {
        console.log('ğŸš« ç›´ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ¤œå‡ºã€è¨ºæ–­ã‚²ãƒ¼ãƒ ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ');
        sessionStorage.setItem('redir_guard','1');
        location.replace('./index.html');
      } else {
        console.log('âœ… åŸ‹ã‚è¾¼ã¿ã¾ãŸã¯è¨ºæ–­æ¸ˆã¿ã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãªã„');
        console.log('ğŸ“‹ è©³ç´°:', {
          hasParams: hasParams,
          hasCtx: hasCtx,
          inEmbed: inEmbed,
          params: Object.fromEntries(sp.entries()),
          sessionStorage: {
            diagCtx: sessionStorage.getItem('diagCtx'),
            as_chronicle_diagnosis: sessionStorage.getItem('as_chronicle_diagnosis'),
            as_chronicle_last_result: sessionStorage.getItem('as_chronicle_last_result')
          }
        });
        
        // åŸ‹ã‚è¾¼ã¿æ™‚ã¯è¨ºæ–­æƒ…å ±ã‚’sessionStorageã«ä¿å­˜ï¼ˆå®‰å…¨æ€§å‘ä¸Šï¼‰
        if (inEmbed && hasParams) {
          try {
            const diagnosisData = {
              department: sp.get('department'),
              course: sp.get('course'),
              club: sp.get('club'),
              previewMessage: sp.get('previewMessage'),
              episodeMessage: sp.get('episodeMessage'),
              timestamp: Date.now()
            };
            sessionStorage.setItem('as_chronicle_diagnosis', JSON.stringify(diagnosisData));
            console.log('ğŸ’¾ åŸ‹ã‚è¾¼ã¿æ™‚ã®è¨ºæ–­æƒ…å ±ã‚’ä¿å­˜:', diagnosisData);
          } catch(e) {
            console.warn('âš ï¸ è¨ºæ–­æƒ…å ±ã®ä¿å­˜ã«å¤±æ•—:', e);
          }
        }
        
        // åŸ‹ã‚è¾¼ã¿æ™‚ã¯è¨ºæ–­æƒ…å ±ã‚’sessionStorageã«ä¿å­˜ï¼ˆå®‰å…¨æ€§å‘ä¸Šï¼‰
        if (inEmbed) {
          try {
            // åŸ‹ã‚è¾¼ã¿ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
            sessionStorage.setItem('studio_embed_flag', '1');
            console.log('ğŸ·ï¸ StudioåŸ‹ã‚è¾¼ã¿ãƒ•ãƒ©ã‚°ã‚’è¨­å®š');
            
            // è¨ºæ–­æƒ…å ±ãŒãªã„å ´åˆã§ã‚‚åŸ‹ã‚è¾¼ã¿ãƒ•ãƒ©ã‚°ãŒã‚ã‚Œã°å®‰å…¨
            if (!hasParams && !hasCtx) {
              console.log('ğŸ›¡ï¸ åŸ‹ã‚è¾¼ã¿ãƒ•ãƒ©ã‚°ã«ã‚ˆã‚Šå®‰å…¨æ€§ã‚’ç¢ºä¿');
            }
          } catch(e) {
            console.warn('âš ï¸ åŸ‹ã‚è¾¼ã¿ãƒ•ãƒ©ã‚°ã®è¨­å®šã«å¤±æ•—:', e);
          }
        }
      }
      
      // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°ï¼ˆåŸ‹ã‚è¾¼ã¿åˆ¤å®šã®ç¢ºèªï¼‰
      console.log('ğŸ” ç›´ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢ãƒã‚§ãƒƒã‚¯:', {
        hasParams, hasCtx, inEmbed,
        referrer: document.referrer,
        ancestorOrigins: location.ancestorOrigins,
        windowParent: window.parent !== window,
        hostname: window.location.hostname,
        isSecureContext: window.isSecureContext,
        windowTop: window.top !== window
      });
      
      // StudioåŸ‹ã‚è¾¼ã¿è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚³ãƒ”ãƒšç”¨ï¼‰
      console.log('ğŸ”§ åŸ‹ã‚è¾¼ã¿è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆä»¥ä¸‹ã‚’ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œï¼‰:');
      console.log(`
(async()=>{
  const ORG='https://student-id-generator.pages.dev';
  const show=(lab,r)=>console.log(lab,'=>',r.status, r.headers.get('content-type')||'', r.headers.get('location')||'');
  // 1) /generator.html ã®å¿œç­”ï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãªã—ã€200ã§è¿”ã‚‹ï¼‰
  let r = await fetch(ORG+'/generator.html',{redirect:'manual'});
  show('/generator.html', r);
  r.headers.forEach((v,k)=>/frame-ancestors|x-frame-options|location/i.test(k)&&console.log(k+':',v));
  // 2) JS/MIME
  await fetch(ORG+'/assets/js/app.js?v=20250901',{cache:'no-store'}).then(r=>show('app.js', r));
  // 3) å°ç´™PNGï¼ˆåˆæœŸæç”»ã®ãƒˆãƒªã‚¬ãƒ¼ï¼‰
  await fetch(ORG+'/assets/img/student_template.png',{cache:'no-store'}).then(r=>show('template.png', r));
})();
      `);
    })();
  </script>
</head>
<body>
  <header>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«å‰Šé™¤ -->
  </header>

  <main class="generator-container">
    <!-- é€²æ—ãƒãƒ¼ -->
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    
    <div class="cards-grid">
      <section class="form-card">
        <h2>å­¦ç”Ÿè¨¼ã‚’ä½œæˆ</h2>
        <div id="studentForm">
          <div class="form-group">
          <label class="file-input-label" for="photoInput">
            ç”»åƒã‚’é¸æŠ
            <input type="file" id="photoInput" accept="image/*">
          </label>
        </div>

        <div class="form-group">
          <label>
            æ°åï¼ˆæ¼¢å­—ï¼‰
            <input type="text" id="nameJa" placeholder="ä¾‹ï¼šé«˜æ£®ã®ã°ã‚‰" autocomplete="off" autocapitalize="off" spellcheck="false">
          </label>
        </div>

        <div class="form-group">
          <label>
            æ°åï¼ˆãƒ­ãƒ¼ãƒå­—ï¼‰
            <input type="text" id="nameEn" placeholder="ä¾‹ï¼šTakamori Nobara" autocapitalize="words" inputmode="latin" spellcheck="false" autocomplete="off">
          </label>
        </div>

        <div class="form-group">
          <label>
            ç”Ÿå¹´æœˆæ—¥
          </label>
          <div class="date-inputs">
            <div class="number-input">
              <select id="dobMonth" autocomplete="one-time-code">
                <option value="">æœˆ</option>
                <option value="1">1æœˆ</option>
                <option value="2">2æœˆ</option>
                <option value="3">3æœˆ</option>
                <option value="4">4æœˆ</option>
                <option value="5">5æœˆ</option>
                <option value="6">6æœˆ</option>
                <option value="7">7æœˆ</option>
                <option value="8">8æœˆ</option>
                <option value="9">9æœˆ</option>
                <option value="10">10æœˆ</option>
                <option value="11">11æœˆ</option>
                <option value="12">12æœˆ</option>
              </select>
            </div>
            <div class="number-input">
              <select id="dobDay" autocomplete="one-time-code">
                <option value="">æ—¥</option>
                <option value="1">1æ—¥</option>
                <option value="2">2æ—¥</option>
                <option value="3">3æ—¥</option>
                <option value="4">4æ—¥</option>
                <option value="5">5æ—¥</option>
                <option value="6">6æ—¥</option>
                <option value="7">7æ—¥</option>
                <option value="8">8æ—¥</option>
                <option value="9">9æ—¥</option>
                <option value="10">10æ—¥</option>
                <option value="11">11æ—¥</option>
                <option value="12">12æ—¥</option>
                <option value="13">13æ—¥</option>
                <option value="14">14æ—¥</option>
                <option value="15">15æ—¥</option>
                <option value="16">16æ—¥</option>
                <option value="17">17æ—¥</option>
                <option value="18">18æ—¥</option>
                <option value="19">19æ—¥</option>
                <option value="20">20æ—¥</option>
                <option value="21">21æ—¥</option>
                <option value="22">22æ—¥</option>
                <option value="23">23æ—¥</option>
                <option value="24">24æ—¥</option>
                <option value="25">25æ—¥</option>
                <option value="26">26æ—¥</option>
                <option value="27">27æ—¥</option>
                <option value="28">28æ—¥</option>
                <option value="29">29æ—¥</option>
                <option value="30">30æ—¥</option>
                <option value="31">31æ—¥</option>
              </select>
            </div>
          </div>
        </div>

        <!-- è¨ºæ–­ã‚²ãƒ¼ãƒ é€£æºãƒœã‚¿ãƒ³ï¼ˆè¨ºæ–­çµæœè¨­å®šæ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
        <div id="diagnosisButtons" style="display: none; margin-top: 1rem; gap: 0.5rem; flex-wrap: wrap;">
          <button type="button" id="backToDiagnosisBtn" style="background: linear-gradient(135deg, #98d7a5, #98c8a8); color: white; flex: 1; min-width: 120px;">
            è¨ºæ–­ã«æˆ»ã‚‹
          </button>
          <button type="button" id="viewDiagnosisResultBtn" style="background: linear-gradient(135deg, #87ceeb, #98c8e8); color: white; flex: 1; min-width: 120px;">
            è¨ºæ–­çµæœã‚’è¦‹ã‚‹
          </button>
        </div>
      </section>

      <section class="preview-card">
        <div class="card-header">
          ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        </div>
        <div class="card-body">
          <canvas id="cardCanvas" width="800" height="500"></canvas>
          <img id="cardPreview" alt="å­¦ç”Ÿè¨¼ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" style="display: none;">
        </div>
        <small style="display:block; margin:.5rem 0 0; font-size:12px; color:#888; text-align:center;">
          â€»PCã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã®ä¸Šã§å³ã‚¯ãƒªãƒƒã‚¯ â†’ã€Œåå‰ã‚’ä»˜ã‘ã¦ç”»åƒã‚’ä¿å­˜ã€<br>
          â€»å…±æœ‰URLã¯å¿…ãšã€ŒURLã‚’ã‚³ãƒ”ãƒ¼ã€ãƒœã‚¿ãƒ³ã‹ã‚‰å–å¾—ã—ã¦ãã ã•ã„
        </small>
        <div class="card-footer">
          <button type="button" id="downloadBtn">
            ç”»åƒã‚’ä¿å­˜
          </button>
          <script>
            document.getElementById('downloadBtn')?.addEventListener('click', (e) => {
              e.preventDefault(); e.stopPropagation();
              try {
                // ç›´å‰ç”Ÿæˆãƒ•ãƒ©ã‚°ï¼ˆã‚¬ãƒ¼ãƒ‰ã‚’é€šã™ï¼‰
                sessionStorage.setItem('as_chronicle_last_result','1');
                const cvs = document.getElementById('cardCanvas');
                if (cvs) window.downloadCanvasAsImage?.(cvs, 'æ”¾èª²å¾Œã‚¯ãƒ­ãƒ‹ã‚¯ãƒ«_å­¦ç”Ÿè¨¼.png');
              } catch(e){}
            }, { passive:false });
          </script>
          <button type="button" id="twitterBtn" class="btn-twitter">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
              <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
            </svg>
            Xã«æŠ•ç¨¿
          </button>
          <button type="button" id="urlBtn">
            URLã‚’ã‚³ãƒ”ãƒ¼
          </button>
        </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer>
          <div class="footer-content" style="text-align: center; padding: 1rem; color: #666;">
        <a href="./privacy.html" style="color: #2E8B57; text-decoration: none; margin: 0 1rem;">
          ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼
        </a>
      </div>
  </footer>

  <div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <p>å‡¦ç†ä¸­...</p>
  </div>

  <!-- ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º -->
  <div id="toast" class="toast" style="display: none;">
    <div class="toast-content">
      <span id="toastMessage"></span>
    </div>
  </div>
  
  <!-- ã‚¹ãƒãƒ›ç”¨ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ -->
  <div id="scrollGuide" class="scroll-guide" style="display: none; visibility: hidden; opacity: 0;">
    ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¦‹ã‚‹
  </div>

  <!-- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¼·åˆ¶ä¿®æ­£ -->
  <script>
    // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å¼·åˆ¶çš„ã«æ¨ªä¸¦ã³ã«ä¿®æ­£ï¼ˆã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã¯ç„¡åŠ¹åŒ–ãƒ»ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚µã‚¤ã‚ºã®ã¿ï¼‰
    function forceHorizontalLayout() {
      // ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã¯å®Ÿè¡Œã—ãªã„
      if (window.innerWidth <= 768) {
        console.log('ğŸ“± ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã®ãŸã‚æ¨ªä¸¦ã³å¼·åˆ¶å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—');
        return;
      }
      
      console.log('ğŸ–¥ï¸ ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚µã‚¤ã‚ºã®ãŸã‚æ¨ªä¸¦ã³å¼·åˆ¶å‡¦ç†ã‚’å®Ÿè¡Œ');
      
      const cardsGrid = document.querySelector('.cards-grid');
      if (cardsGrid) {
        // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã§å¼·åˆ¶é©ç”¨
        cardsGrid.style.cssText = `
          display: grid !important;
          grid-template-columns: 1fr 1fr !important;
          grid-template-rows: 1fr !important;
          gap: 2rem !important;
          width: 100% !important;
          max-width: none !important;
          min-height: 550px !important;
          height: 550px !important;
          align-items: stretch !important;
          justify-items: stretch !important;
          position: relative !important;
          overflow: visible !important;
          float: none !important;
          clear: both !important;
          box-sizing: border-box !important;
          margin: 0 !important;
          padding: 0 !important;
          grid-auto-flow: row !important;
          grid-auto-rows: 1fr !important;
        `;
        
        // ã•ã‚‰ã«å¼·åˆ¶çš„ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
        cardsGrid.setAttribute('style', cardsGrid.style.cssText);
        
        // ç›´æ¥ã‚¹ã‚¿ã‚¤ãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šï¼ˆã‚ˆã‚Šå¼·åŠ›ã«ï¼‰
        cardsGrid.style.setProperty('display', 'grid', 'important');
        cardsGrid.style.setProperty('grid-template-columns', '1fr 1fr', 'important');
        cardsGrid.style.setProperty('grid-template-rows', '1fr', 'important');
        cardsGrid.style.setProperty('gap', '2rem', 'important');
        cardsGrid.style.setProperty('width', '100%', 'important');
        cardsGrid.style.setProperty('max-width', 'none', 'important');
        cardsGrid.style.setProperty('min-height', '600px', 'important');
        cardsGrid.style.setProperty('height', '600px', 'important');
        cardsGrid.style.setProperty('align-items', 'stretch', 'important');
        cardsGrid.style.setProperty('justify-items', 'stretch', 'important');
        cardsGrid.style.setProperty('position', 'relative', 'important');
        cardsGrid.style.setProperty('overflow', 'visible', 'important');
        cardsGrid.style.setProperty('float', 'none', 'important');
        cardsGrid.style.setProperty('clear', 'none', 'important');
        cardsGrid.style.setProperty('box-sizing', 'border-box', 'important');
        cardsGrid.style.setProperty('margin', '0', 'important');
        cardsGrid.style.setProperty('padding', '0', 'important');
        cardsGrid.style.setProperty('grid-auto-flow', 'row', 'important');
        cardsGrid.style.setProperty('grid-auto-rows', '1fr', 'important');
        
        // é€šå¸¸ã®ã‚¹ã‚¿ã‚¤ãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚‚è¨­å®šï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
        cardsGrid.style.display = 'grid';
        cardsGrid.style.gridTemplateColumns = '1fr 1fr';
        cardsGrid.style.gridTemplateRows = '1fr';
        cardsGrid.style.gap = '2rem';
        cardsGrid.style.width = '100%';
        cardsGrid.style.maxWidth = 'none';
        cardsGrid.style.minHeight = '600px';
        cardsGrid.style.height = '600px';
        cardsGrid.style.alignItems = 'stretch';
        cardsGrid.style.justifyItems = 'stretch';
        cardsGrid.style.position = 'relative';
        cardsGrid.style.overflow = 'visible';
        cardsGrid.style.float = 'none';
        cardsGrid.style.clear = 'none';
        cardsGrid.style.boxSizing = 'border-box';
        cardsGrid.style.margin = '0';
        cardsGrid.style.padding = '0';
        cardsGrid.style.gridAutoFlow = 'row';
        cardsGrid.style.gridAutoRows = '1fr';
        
        console.log('âœ… ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å¼·åˆ¶çš„ã«æ¨ªä¸¦ã³ã«ä¿®æ­£ã—ã¾ã—ãŸï¼ˆæœ€å¼·åŒ–ç‰ˆï¼‰');
        
        // ã•ã‚‰ã«å¼·åˆ¶çš„ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ï¼ˆç¢ºå®Ÿæ€§ã®ãŸã‚ï¼‰
        setTimeout(() => {
          cardsGrid.style.setProperty('display', 'grid', 'important');
          cardsGrid.style.setProperty('grid-template-columns', '1fr 1fr', 'important');
          cardsGrid.style.setProperty('grid-template-rows', '1fr', 'important');
          cardsGrid.style.setProperty('gap', '2rem', 'important');
          cardsGrid.style.setProperty('height', '550px', 'important');
          console.log('âœ… é…å»¶å¼·åˆ¶é©ç”¨å®Œäº†');
        }, 10);
        
        // ã•ã‚‰ã«é…å»¶ã—ã¦å¼·åˆ¶é©ç”¨ï¼ˆç¢ºå®Ÿæ€§ã®ãŸã‚ãƒ»ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã¯åˆ¶é™ã—ãªã„ï¼‰
        setTimeout(() => {
          if (formCard) {
            formCard.style.setProperty('height', 'auto', 'important');
            formCard.style.setProperty('min-height', window.innerWidth <= 768 ? '1000px' : '550px', 'important');
            formCard.style.setProperty('max-height', 'none', 'important');
            formCard.style.setProperty('top', '0', 'important');
            formCard.style.setProperty('margin-top', '0', 'important');
          }
          if (previewCard) {
            previewCard.style.setProperty('height', 'auto', 'important');
            previewCard.style.setProperty('min-height', window.innerWidth <= 768 ? '900px' : '550px', 'important');
            previewCard.style.setProperty('max-height', 'none', 'important');
            previewCard.style.setProperty('top', '0', 'important');
            previewCard.style.setProperty('margin-top', '0', 'important');
          }
          console.log('âœ… æœ€çµ‚é…å»¶å¼·åˆ¶é©ç”¨å®Œäº†ï¼ˆã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºå¯¾å¿œï¼‰');
        }, 100);
        
        // å­è¦ç´ ã‚‚å¼·åˆ¶ä¿®æ­£
        const formCard = cardsGrid.querySelector('.form-card');
        const previewCard = cardsGrid.querySelector('.preview-card');
        
        if (formCard) {
          formCard.style.setProperty('display', 'flex', 'important');
          formCard.style.setProperty('flex-direction', 'column', 'important');
          formCard.style.setProperty('justify-content', 'flex-start', 'important');
          formCard.style.setProperty('align-items', 'stretch', 'important');
          formCard.style.setProperty('height', 'auto', 'important');
                      formCard.style.setProperty('min-height', window.innerWidth <= 768 ? '800px' : '550px', 'important');
          formCard.style.setProperty('max-height', 'none', 'important');
          formCard.style.setProperty('float', 'none', 'important');
          formCard.style.setProperty('clear', 'none', 'important');
          formCard.style.setProperty('width', 'auto', 'important');
          formCard.style.setProperty('max-width', 'none', 'important');
          formCard.style.setProperty('position', 'relative', 'important');
          formCard.style.setProperty('box-sizing', 'border-box', 'important');
          formCard.style.setProperty('overflow', 'visible', 'important');
          formCard.style.setProperty('top', '0', 'important');
          formCard.style.setProperty('margin-top', '0', 'important');
          formCard.style.setProperty('padding-top', '1.5rem', 'important');
          
          // é€šå¸¸ã®ã‚¹ã‚¿ã‚¤ãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚‚è¨­å®šï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
          formCard.style.display = 'flex';
          formCard.style.flexDirection = 'column';
          formCard.style.justifyContent = 'flex-start';
          formCard.style.alignItems = 'stretch';
          formCard.style.height = 'auto';
          formCard.style.minHeight = window.innerWidth <= 768 ? '1000px' : '550px';
          formCard.style.maxHeight = 'none';
          formCard.style.float = 'none';
          formCard.style.clear = 'none';
          formCard.style.width = 'auto';
          formCard.style.maxWidth = 'none';
          formCard.style.position = 'relative';
          formCard.style.boxSizing = 'border-box';
          formCard.style.overflow = 'visible';
          formCard.style.top = '0';
          formCard.style.marginTop = '0';
          formCard.style.paddingTop = '1.5rem';
        }
        
        if (previewCard) {
          previewCard.style.setProperty('display', 'flex', 'important');
          previewCard.style.setProperty('flex-direction', 'column', 'important');
          previewCard.style.setProperty('justify-content', 'flex-start', 'important');
          previewCard.style.setProperty('align-items', 'stretch', 'important');
          previewCard.style.setProperty('height', 'auto', 'important');
                      previewCard.style.setProperty('min-height', window.innerWidth <= 768 ? '600px' : '550px', 'important');
          previewCard.style.setProperty('max-height', 'none', 'important');
          previewCard.style.setProperty('float', 'none', 'important');
          previewCard.style.setProperty('clear', 'none', 'important');
          previewCard.style.setProperty('width', 'auto', 'important');
          previewCard.style.setProperty('max-width', 'none', 'important');
          previewCard.style.setProperty('position', 'relative', 'important');
          previewCard.style.setProperty('box-sizing', 'border-box', 'important');
          previewCard.style.setProperty('overflow', 'visible', 'important');
          previewCard.style.setProperty('top', '0', 'important');
          previewCard.style.setProperty('margin-top', '0', 'important');
          previewCard.style.setProperty('padding-top', '1.5rem', 'important');
          
          // é€šå¸¸ã®ã‚¹ã‚¿ã‚¤ãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚‚è¨­å®šï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
          previewCard.style.display = 'flex';
          previewCard.style.flexDirection = 'column';
          previewCard.style.justifyContent = 'flex-start';
          previewCard.style.alignItems = 'stretch';
          previewCard.style.height = 'auto';
          previewCard.style.minHeight = window.innerWidth <= 768 ? '900px' : '550px';
          previewCard.style.maxHeight = 'none';
          previewCard.style.float = 'none';
          previewCard.style.clear = 'none';
          previewCard.style.width = 'auto';
          previewCard.style.maxWidth = 'none';
          previewCard.style.position = 'relative';
          previewCard.style.boxSizing = 'border-box';
          previewCard.style.overflow = 'visible';
          previewCard.style.top = '0';
          previewCard.style.marginTop = '0';
          previewCard.style.paddingTop = '1.5rem';
        }
        
        console.log('âœ… ã‚«ãƒ¼ãƒ‰ã®é«˜ã•ã‚’600pxã«çµ±ä¸€ã—ã¾ã—ãŸ');
        
        // ã‚«ãƒ¼ãƒ‰å†…ã®è¦ç´ ã®é«˜ã•ã‚‚çµ±ä¸€
        if (formCard) {
          const formElements = formCard.querySelectorAll('*');
          formElements.forEach(element => {
            if (element.tagName === 'H2') {
              element.style.setProperty('margin-top', '0', 'important');
              element.style.setProperty('margin-bottom', '1.5rem', 'important');
              element.style.setProperty('flex-shrink', '0', 'important');
            } else if (element.id === 'studentForm') {
              element.style.setProperty('flex', '1', 'important');
              element.style.setProperty('display', 'flex', 'important');
              element.style.setProperty('flex-direction', 'column', 'important');
              element.style.setProperty('justify-content', 'flex-start', 'important');
            } else if (element.id === 'diagnosisButtons') {
              element.style.setProperty('margin-top', 'auto', 'important');
              element.style.setProperty('padding-top', '1.5rem', 'important');
              element.style.setProperty('flex-shrink', '0', 'important');
            }
          });
        }
        
        if (previewCard) {
          const previewElements = previewCard.querySelectorAll('*');
          previewElements.forEach(element => {
            if (element.className === 'card-header') {
              element.style.setProperty('margin-top', '0', 'important');
              element.style.setProperty('margin-bottom', '1.5rem', 'important');
              element.style.setProperty('flex-shrink', '0', 'important');
            } else if (element.className === 'card-body') {
              element.style.setProperty('flex', '1', 'important');
              element.style.setProperty('display', 'flex', 'important');
              element.style.setProperty('flex-direction', 'column', 'important');
              element.style.setProperty('justify-content', 'center', 'important');
              element.style.setProperty('align-items', 'center', 'important');
            } else if (element.className === 'card-footer') {
              element.style.setProperty('margin-top', 'auto', 'important');
              element.style.setProperty('padding-top', '1.5rem', 'important');
              element.style.setProperty('flex-shrink', '0', 'important');
            }
          });
        }
      }
    }
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«å®Ÿè¡Œ
    document.addEventListener('DOMContentLoaded', forceHorizontalLayout);
    
    // å°‘ã—é…å»¶ã—ã¦ã‹ã‚‰ã‚‚å®Ÿè¡Œï¼ˆç¢ºå®Ÿæ€§ã®ãŸã‚ï¼‰
    setTimeout(forceHorizontalLayout, 50);
    setTimeout(forceHorizontalLayout, 100);
    setTimeout(forceHorizontalLayout, 200);
    setTimeout(forceHorizontalLayout, 500);
    setTimeout(forceHorizontalLayout, 1000);
    
    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«ã‚‚å®Ÿè¡Œ
    window.addEventListener('load', forceHorizontalLayout);
    
    // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒã‚§ãƒƒã‚¯ã¯å‰Šé™¤æ¸ˆã¿ï¼ˆæ­£å¸¸å‹•ä½œç¢ºèªå®Œäº†ï¼‰
    
    // ã‚¹ãƒãƒ›ç”¨ã®æœ€é©åŒ–
    function optimizeForMobile() {
      const isMobile = window.innerWidth <= 768;
      
      if (isMobile) {
        // ã‚¹ãƒãƒ›ç”¨ã®è¨­å®š
        console.log('ğŸ“± ã‚¹ãƒãƒ›ç”¨æœ€é©åŒ–ã‚’é©ç”¨ä¸­...');
        
        // ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ã‚’ç¸¦ä¸¦ã³ã«å¼·åˆ¶å¤‰æ›´ï¼ˆæœ€å¼·åŒ–ç‰ˆï¼‰
        const cardsGrid = document.querySelector('.cards-grid');
        if (cardsGrid) {
          // ã‚ˆã‚Šå¼·åŠ›ãªã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨
          cardsGrid.style.cssText = `
            display: flex !important;
            flex-direction: column !important;
            grid: none !important;
            grid-template-columns: none !important;
            grid-template-rows: none !important;
            gap: 1.5rem !important;
            width: 100% !important;
            max-width: 100% !important;
            min-height: auto !important;
            height: auto !important;
          `;
          
          // setPropertyã§ã‚‚å¼·åˆ¶é©ç”¨
          cardsGrid.style.setProperty('display', 'flex', 'important');
          cardsGrid.style.setProperty('flex-direction', 'column', 'important');
          cardsGrid.style.setProperty('grid', 'none', 'important');
          cardsGrid.style.setProperty('grid-template-columns', 'none', 'important');
          cardsGrid.style.setProperty('grid-template-rows', 'none', 'important');
          cardsGrid.style.setProperty('gap', '1.5rem', 'important');
          cardsGrid.style.setProperty('width', '100%', 'important');
          
          // ç›´æ¥ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã‚‚è¨­å®š
          cardsGrid.style.display = 'flex';
          cardsGrid.style.flexDirection = 'column';
          cardsGrid.style.grid = 'none';
          
          console.log('âœ… ã‚¹ãƒãƒ›ç”¨ç¸¦ä¸¦ã³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æœ€å¼·åŒ–ã§å¼·åˆ¶é©ç”¨');
        }
        
        // ã‚¿ãƒƒãƒæ“ä½œã®æœ€é©åŒ–
        document.addEventListener('touchstart', function() {}, {passive: true});
        
        // ã‚ºãƒ¼ãƒ é˜²æ­¢ï¼ˆiOSï¼‰
        const viewport = document.querySelector('meta[name="viewport"]');
        if (viewport) {
          viewport.setAttribute('content', 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no');
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã®æœ€é©åŒ–
        const photoInput = document.getElementById('photoInput');
        if (photoInput) {
          photoInput.setAttribute('capture', 'environment'); // ã‚«ãƒ¡ãƒ©èµ·å‹•
          photoInput.setAttribute('accept', 'image/*');
        }
        
        console.log('âœ… ã‚¹ãƒãƒ›ç”¨æœ€é©åŒ–å®Œäº†');
      }
    }
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚¹ãƒãƒ›æœ€é©åŒ–ã‚’å®Ÿè¡Œ
    document.addEventListener('DOMContentLoaded', optimizeForMobile);
    window.addEventListener('resize', optimizeForMobile);
    
    // é…å»¶å¼·åˆ¶é©ç”¨ï¼ˆç¢ºå®Ÿæ€§ã®ãŸã‚ï¼‰
    setTimeout(optimizeForMobile, 100);
    setTimeout(optimizeForMobile, 500);
    setTimeout(optimizeForMobile, 1000);
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«ã‚‚å®Ÿè¡Œ
    window.addEventListener('load', () => {
      setTimeout(optimizeForMobile, 100);
      setTimeout(optimizeForMobile, 500);
    });
    
    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ã®åˆ¶å¾¡
    function setupScrollGuide() {
      const scrollGuide = document.getElementById('scrollGuide');
      const previewCard = document.querySelector('.preview-card');
      
      // PCã‚µã‚¤ã‚ºã§ã¯ç¢ºå®Ÿã«éè¡¨ç¤º
      if (window.innerWidth > 768) {
        if (scrollGuide) {
          scrollGuide.style.display = 'none';
          scrollGuide.style.visibility = 'hidden';
          scrollGuide.style.opacity = '0';
          scrollGuide.style.pointerEvents = 'none';
        }
        return;
      }
      
      if (scrollGuide && previewCard && window.innerWidth <= 768) {
        // ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã®ã¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤º
        scrollGuide.style.display = 'flex';
        scrollGuide.style.visibility = 'visible';
        scrollGuide.style.opacity = '1';
        scrollGuide.style.pointerEvents = 'auto';
        
        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã®å‹•ä½œ
        scrollGuide.addEventListener('click', () => {
          previewCard.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        });
        
        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã«å¿œã˜ã¦ã‚¬ã‚¤ãƒ‰ã‚’éè¡¨ç¤º
        window.addEventListener('scroll', () => {
          const previewCardTop = previewCard.offsetTop;
          const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
          
          if (scrollTop > previewCardTop - 100) {
            scrollGuide.style.display = 'none';
          } else {
            scrollGuide.style.display = 'flex';
          }
        });
        
        console.log('ğŸ“± ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ã‚’è¨­å®šã—ã¾ã—ãŸï¼ˆã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºï¼‰');
      }
    }
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ã‚’è¨­å®š
    window.addEventListener('load', setupScrollGuide);
    
    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã«ã‚‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ¶å¾¡
    window.addEventListener('resize', () => {
      const scrollGuide = document.getElementById('scrollGuide');
      if (scrollGuide) {
        if (window.innerWidth > 768) {
          // PCã‚µã‚¤ã‚ºã§ã¯éè¡¨ç¤º
          scrollGuide.style.display = 'none';
          scrollGuide.style.visibility = 'hidden';
          scrollGuide.style.opacity = '0';
          scrollGuide.style.pointerEvents = 'none';
        } else {
          // ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºã§ã¯è¡¨ç¤º
          scrollGuide.style.display = 'flex';
          scrollGuide.style.visibility = 'visible';
          scrollGuide.style.opacity = '1';
          scrollGuide.style.pointerEvents = 'auto';
        }
      }
    });
    
    // é€²æ—ãƒãƒ¼ã®æ›´æ–°
    function updateProgress() {
      const progressFill = document.getElementById('progressFill');
      if (!progressFill) return;
      
      let completedFields = 0;
      const totalFields = 6; // ç”»åƒã€æ°åï¼ˆæ¼¢å­—ï¼‰ã€æ°åï¼ˆãƒ­ãƒ¼ãƒå­—ï¼‰ã€ç”Ÿå¹´æœˆæ—¥ã€å­¦ç§‘ã€éƒ¨æ´»å‹•
      
      // ç”»åƒãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      const photoInput = document.getElementById('photoInput');
      if (photoInput && photoInput.files && photoInput.files.length > 0) {
        completedFields++;
      }
      
      // æ°åï¼ˆæ¼¢å­—ï¼‰ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      const nameJa = document.getElementById('nameJa');
      if (nameJa && nameJa.value.trim()) {
        completedFields++;
      }
      
      // æ°åï¼ˆãƒ­ãƒ¼ãƒå­—ï¼‰ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      const nameEn = document.getElementById('nameEn');
      if (nameEn && nameEn.value.trim()) {
        completedFields++;
      }
      
      // ç”Ÿå¹´æœˆæ—¥ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      const dobMonth = document.getElementById('dobMonth');
      const dobDay = document.getElementById('dobDay');
      if (dobMonth && dobDay && dobMonth.value && dobDay.value) {
        completedFields++;
      }
      
      // å­¦ç§‘ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      const department = document.getElementById('department');
      if (department && department.value) {
        completedFields++;
      }
      
      // éƒ¨æ´»å‹•ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      const club = document.getElementById('club');
      if (club && club.value) {
        completedFields++;
      }
      
      // é€²æ—ç‡ã‚’è¨ˆç®—ã—ã¦æ›´æ–°
      const progress = (completedFields / totalFields) * 100;
      progressFill.style.width = `${progress}%`;
    }
    
    // ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®å¤‰æ›´ã‚’ç›£è¦–
    function setupProgressTracking() {
      const formElements = [
        'photoInput', 'nameJa', 'nameEn', 'dobMonth', 'dobDay', 'department', 'club'
      ];
      
      formElements.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          if (element.type === 'file') {
            element.addEventListener('change', updateProgress);
          } else if (element.tagName === 'SELECT') {
            element.addEventListener('change', updateProgress);
          } else {
            element.addEventListener('input', updateProgress);
          }
        }
      });
    }
  </script>

  <!-- è¨ºæ–­ã‚²ãƒ¼ãƒ é€£æºå‡¦ç† -->
  <script>
    // æ”¾èª²å¾Œã‚¯ãƒ­ãƒ‹ã‚¯ãƒ«è¨ºæ–­ã‚²ãƒ¼ãƒ ã‹ã‚‰ã®é€£æºå‡¦ç†ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ç‰ˆï¼‰
    document.addEventListener('DOMContentLoaded', function() {
      // çŠ¶æ…‹å¾©å…ƒå‡¦ç†
      function restoreStudentIdState() {
        try {
          const savedResult = window.loadResult ? window.loadResult() : null;
          if (savedResult && savedResult.public_id && savedResult.version) {
            console.log('å­¦ç”Ÿè¨¼ã®çŠ¶æ…‹ã‚’å¾©å…ƒã—ã¾ã™:', savedResult);
            
            // å…±æœ‰URLã‚’å¾©å…ƒ
            if (window.buildShareUrlWithImage) {
              const shareUrl = window.buildShareUrlWithImage({
                public_id: savedResult.public_id,
                version: savedResult.version
              });
              window.__shareUrl = shareUrl;
              
              // å…±æœ‰ãƒªãƒ³ã‚¯ã‚’æ›´æ–°
              if (window.updateShareLinksWithImage) {
                window.updateShareLinksWithImage(savedResult, 'å­¦ç”Ÿè¨¼ãŒå¾©å…ƒã•ã‚Œã¾ã—ãŸ');
              }
            }
            
            // OGPç”»åƒURLã‚’å¾©å…ƒ
            if (savedResult.eager_url) {
              window.__ogpImageUrl = savedResult.eager_url;
            }
            
            // ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
            if (savedResult.imageData) {
              window.__lastImageData = savedResult.imageData;
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ å€¤ã‚’å¾©å…ƒ
            if (savedResult.formData) {
              const { nameJa, nameEn, dobMonth, dobDay } = savedResult.formData;
              if (nameJa && document.getElementById('nameJa')) {
                document.getElementById('nameJa').value = nameJa;
              }
              if (nameEn && document.getElementById('nameEn')) {
                document.getElementById('nameEn').value = nameEn;
              }
              if (dobMonth && document.getElementById('dobMonth')) {
                document.getElementById('dobMonth').value = dobMonth;
              }
              if (dobDay && document.getElementById('dobDay')) {
                document.getElementById('dobDay').value = dobDay;
              }
            }
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å†æç”»
            if (typeof window.drawStudentCard === 'function') {
              setTimeout(() => window.drawStudentCard(), 100);
            }
            
            console.log('âœ… å­¦ç”Ÿè¨¼ã®çŠ¶æ…‹ãŒå¾©å…ƒã•ã‚Œã¾ã—ãŸ');
          }
        } catch (error) {
          console.error('çŠ¶æ…‹å¾©å…ƒã‚¨ãƒ©ãƒ¼:', error);
        }
      }
      
          // çŠ¶æ…‹å¾©å…ƒã‚’å®Ÿè¡Œ
    restoreStudentIdState();
    
    // ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºæ©Ÿèƒ½
    function showToast(message, duration = 3000) {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      if (toast && toastMessage) {
        toastMessage.textContent = message;
        toast.style.display = 'block';
        toast.classList.add('show');
        
        setTimeout(() => {
          toast.classList.add('hide');
          setTimeout(() => {
            toast.style.display = 'none';
            toast.classList.remove('show', 'hide');
          }, 300);
        }, duration);
      }
    }
    
    window.showToast = showToast;
      // è¨ºæ–­æƒ…å ±ã‚’sessionStorageã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆã‚¯ã‚¨ãƒªãŒã‚ã‚‹å ´åˆã®ã¿ï¼‰
      if (location.search) {
        sessionStorage.setItem('diagCtx', location.search);
      }
      
      // å®‰å…¨ãªURLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾—
      const department = window.Security ? window.Security.getSafeUrlParam('department') : new URLSearchParams(location.search).get('department');
      const course = window.Security ? window.Security.getSafeUrlParam('course') : new URLSearchParams(location.search).get('course');
      const club = window.Security ? window.Security.getSafeUrlParam('club') : new URLSearchParams(location.search).get('club');
      
      console.log('è¨ºæ–­çµæœé€£æº:', { department, course, club });

      // å­¦ç§‘ã®è‡ªå‹•è¨­å®š
      if (department && course) {
        const selDept = document.getElementById('department');
        if (selDept) {
          // æ—¢å­˜ã®é¸æŠè‚¢ã«ãªã„å ´åˆã¯å‹•çš„ã«è¿½åŠ 
          const existingOption = Array.from(selDept.options).find(opt => opt.value === course);
          if (!existingOption && course !== '') {
            const newOption = document.createElement('option');
            newOption.value = course;
            newOption.textContent = course;
            selDept.appendChild(newOption);
          }
          
          selDept.value = course;
          selDept.style.display = 'none';
          
          // ãƒ©ãƒ™ãƒ«ã‚’è¨ºæ–­çµæœè¡¨ç¤ºã«å¤‰æ›´ï¼ˆXSSå¯¾ç­–ï¼štextContentä½¿ç”¨ï¼‰
          const deptLabel = selDept.parentElement.querySelector('label');
          if (deptLabel) {
            // å®‰å…¨ãªè¡¨ç¤ºç”¨HTMLã‚’æ§‹ç¯‰
            const safeDepartment = document.createElement('div');
            safeDepartment.style.cssText = 'padding: 0.75rem; background: #f8f9fa; border-radius: 8px; color: #666; border: 2px solid #e0e0e0;';
            
            const deptText = document.createTextNode(`${department}ï¼ˆ${course}ã‚³ãƒ¼ã‚¹ï¼‰ `);
            const resultSpan = document.createElement('span');
            resultSpan.style.cssText = 'font-size: 0.8em; color: #999;';
            resultSpan.textContent = 'ï¼ˆè¨ºæ–­çµæœï¼‰';
            
            safeDepartment.appendChild(deptText);
            safeDepartment.appendChild(resultSpan);
            
            // æ—¢å­˜ã®å†…å®¹ã‚’ã‚¯ãƒªã‚¢ã—ã¦å®‰å…¨ã«è¿½åŠ 
            deptLabel.textContent = 'å­¦ç§‘';
            deptLabel.appendChild(safeDepartment);
          }
        }
      }

      // éƒ¨æ´»å‹•ã®è‡ªå‹•è¨­å®š
      if (club) {
        const selClub = document.getElementById('club');
        if (selClub) {
          // æ—¢å­˜ã®é¸æŠè‚¢ã«ãªã„å ´åˆã¯å‹•çš„ã«è¿½åŠ 
          const existingOption = Array.from(selClub.options).find(opt => opt.value === club);
          if (!existingOption && club !== '') {
            const newOption = document.createElement('option');
            newOption.value = club;
            newOption.textContent = club;
            selClub.appendChild(newOption);
          }
          
          selClub.value = club;
          selClub.style.display = 'none';
          
          // ãƒ©ãƒ™ãƒ«ã‚’è¨ºæ–­çµæœè¡¨ç¤ºã«å¤‰æ›´ï¼ˆXSSå¯¾ç­–ï¼štextContentä½¿ç”¨ï¼‰
          const clubLabel = selClub.parentElement.querySelector('label');
          if (clubLabel) {
            // å®‰å…¨ãªè¡¨ç¤ºç”¨HTMLã‚’æ§‹ç¯‰
            const safeClub = document.createElement('div');
            safeClub.style.cssText = 'padding: 0.75rem; background: #f8f9fa; border-radius: 8px; color: #666; border: 2px solid #e0e0e0;';
            
            const clubText = document.createTextNode(`${club} `);
            const resultSpan = document.createElement('span');
            resultSpan.style.cssText = 'font-size: 0.8em; color: #999;';
            resultSpan.textContent = 'ï¼ˆè¨ºæ–­çµæœï¼‰';
            
            safeClub.appendChild(clubText);
            safeClub.appendChild(resultSpan);
            
            // æ—¢å­˜ã®å†…å®¹ã‚’ã‚¯ãƒªã‚¢ã—ã¦å®‰å…¨ã«è¿½åŠ 
            clubLabel.textContent = 'éƒ¨æ´»å‹•';
            clubLabel.appendChild(safeClub);
          }
        }
      }

      // è¨ºæ–­çµæœãŒè¨­å®šã•ã‚ŒãŸå ´åˆã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
      if (department || course || club) {
        // è¨ºæ–­é–¢é€£ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
        const diagnosisButtons = document.getElementById('diagnosisButtons');
        if (diagnosisButtons) {
          diagnosisButtons.style.display = 'flex';
          
          // è¨ºæ–­ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³
          const backBtn = document.getElementById('backToDiagnosisBtn');
          if (backBtn) {
            backBtn.onclick = () => {
              const url = new URL('index.html', location.href);
              if (location.search.includes('embed=1')) url.searchParams.set('embed','1');
              location.href = url.toString();
            };
          }
          
          // è¨ºæ–­çµæœã‚’è¦‹ã‚‹ãƒœã‚¿ãƒ³
          const viewResultBtn = document.getElementById('viewDiagnosisResultBtn');
          if (viewResultBtn) {
            viewResultBtn.onclick = () => {
              // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¦index.htmlã®çµæœãƒšãƒ¼ã‚¸ã«ç§»å‹•
              const currentParams = new URLSearchParams(location.search);
              const diagnosisUrl = new URL('index.html', window.location.href);
              diagnosisUrl.searchParams.set('showResult', 'true');
              diagnosisUrl.searchParams.set('department', currentParams.get('department') || '');
              diagnosisUrl.searchParams.set('course', currentParams.get('course') || '');
              diagnosisUrl.searchParams.set('club', currentParams.get('club') || '');
              diagnosisUrl.searchParams.set('previewMessage', currentParams.get('previewMessage') || '');
              diagnosisUrl.searchParams.set('episodeMessage', currentParams.get('episodeMessage') || '');
              
              // åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯embed=1ã‚’ä»˜ä¸
              if (location.search.includes('embed=1')) diagnosisUrl.searchParams.set('embed','1');
              
              window.location.href = diagnosisUrl.toString();
            };
          }
        }

        // å°‘ã—é…å»¶ã‚’å…¥ã‚Œã¦ã‹ã‚‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°ï¼ˆä»–ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¦ã‹ã‚‰ï¼‰
        setTimeout(() => {
          if (typeof drawStudentCard === 'function') {
            drawStudentCard();
          }
        }, 500);
      }
      
      // é€²æ—ãƒãƒ¼ã®åˆæœŸåŒ–
      setupProgressTracking();
      updateProgress();
      
      // ç«¯æœ«åˆ¥ã®ä¿å­˜UI
      const isPc = matchMedia('(pointer:fine)').matches && (navigator.maxTouchPoints || 0) === 0;
      const saveBtn = document.getElementById('downloadBtn');
      if (saveBtn) {
        if (isPc) {
          // PCã¯ãƒœã‚¿ãƒ³ä¸è¦ï¼ˆå³ã‚¯ãƒªãƒƒã‚¯ä¿å­˜ï¼‰
          saveBtn.remove();
        } else {
          // ãƒ¢ãƒã‚¤ãƒ«ã¯OGPç”»åƒã‚’æ–°è¦ã‚¿ãƒ–ã§é–‹ãï¼ˆé•·æŠ¼ã—ä¿å­˜ï¼‰
          saveBtn.onclick = () => {
            if (window.__ogpImageUrl) window.open(window.__ogpImageUrl, '_blank', 'noopener');
          };
        }
      }
    });
  </script>
  
  <!-- åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ -->
  <script>
    // åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œã‚‚è‡ªå‰ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰èª­ã¿è¾¼ã¿
    (function() {
      const s = document.createElement('script');
      s.src = (window.APP_ORIGIN || 'https://student-id-generator.pages.dev') + '/assets/js/embed-mode.js';
      s.defer = true;
      document.head.appendChild(s);
    })();
  </script>
  

  
  <!-- iPhoneã§ã‚«ãƒ¡ãƒ©ãŒèµ·å‹•ã™ã‚‹ä»¶ã‚’ä¿®æ­£ -->
  <script>
    // captureå±æ€§ã¯æ—¢ã«å‰Šé™¤æ¸ˆã¿
  </script>
  
  <!-- å…±æœ‰æ©Ÿèƒ½ã¯å…±æœ‰ãƒ–ãƒªãƒƒã‚¸çµŒç”±ã§çµ±ä¸€ç®¡ç† -->
  <!-- å…±æœ‰ãƒœã‚¿ãƒ³ã¯å…±æœ‰ãƒ–ãƒªãƒƒã‚¸ã‚’æ–°è¦ã‚¿ãƒ–ã§é–‹ãã€ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§Web Shareå®Ÿè¡Œ -->
  <!-- ã“ã‚Œã«ã‚ˆã‚Šiframeå†…ã§ã®Web Shareæ‹’å¦å•é¡Œã‚’å›é¿ -->
  
  <!-- app.jsã®ç›´æ¥èª­ã¿è¾¼ã¿ï¼ˆæœ€ã‚‚ç¢ºå®Ÿãªæ–¹æ³•ï¼‰ -->
  <script>
    // é‡è¤‡èª­ã¿è¾¼ã¿é˜²æ­¢
    if (typeof window.APP_JS_LOADED === 'undefined' || !window.APP_JS_LOADED) {
      window.APP_JS_LOADED = true;
      const script = document.createElement('script');
      script.src = 'assets/js/app.js?v=20250902';
      script.onload = () => {
        console.log('âœ… app.jsç›´æ¥èª­ã¿è¾¼ã¿å®Œäº†ï¼ˆé‡è¤‡é˜²æ­¢ï¼‰');
        // åˆæœŸåŒ–ã‚’ç¢ºå®Ÿã«å®Ÿè¡Œ
        setTimeout(() => {
          if (typeof window.initGeneratorPage === 'function') {
            console.log('ğŸ”„ initGeneratorPageã‚’å®Ÿè¡Œä¸­...');
            window.initGeneratorPage();
          } else {
            console.log('âŒ initGeneratorPageãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
          }
        }, 100);
        
        // drawStudentCardé–¢æ•°ã®å®šç¾©ã‚’å¾…ã£ã¦ã‹ã‚‰åˆæœŸåŒ–
        const checkDrawFunction = () => {
          // app.jsã®èª­ã¿è¾¼ã¿å®Œäº†ã‚‚ãƒã‚§ãƒƒã‚¯
          if (typeof window.initGeneratorPage === 'function') {
            console.log('âœ… initGeneratorPageé–¢æ•°ãŒå®šç¾©ã•ã‚Œã¾ã—ãŸ');
            
            // drawStudentCardé–¢æ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€ã™ãã«é–¢æ•°ã‚’ç›´æ¥å®šç¾©
            if (typeof window.drawStudentCard === 'function') {
              console.log('âœ… drawStudentCardé–¢æ•°ã‚‚å®šç¾©ã•ã‚Œã¦ã„ã¾ã™');
                              console.log('ğŸ”„ é–¢æ•°å®šç¾©å¾Œã«initGeneratorPageã‚’å®Ÿè¡Œä¸­...');
                window.initGeneratorPage();
                
                        // ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚ã«è‡ªå‹•çš„ã«å­¦ç”Ÿè¨¼ã‚’æ›´æ–°
        const formElements = ['nameJa', 'nameEn', 'dobMonth', 'dobDay'];
        formElements.forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.addEventListener('input', () => {
              console.log('ğŸ”„ ãƒ•ã‚©ãƒ¼ãƒ å€¤å¤‰æ›´ã‚’æ¤œçŸ¥ã€å­¦ç”Ÿè¨¼ã‚’æ›´æ–°ä¸­...');
              setTimeout(() => window.drawStudentCard(), 100);
            });
            
            // ã‚¹ãƒãƒ›ç”¨ã®å…¥åŠ›æœ€é©åŒ–
            if (window.innerWidth <= 768) {
              // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®æœ€é©åŒ–
              element.addEventListener('focus', () => {
                element.style.fontSize = '16px'; // iOSã§ã‚ºãƒ¼ãƒ ã‚’é˜²ã
                element.style.transform = 'scale(1.02)';
                element.style.transition = 'all 0.2s ease';
              });
              
              element.addEventListener('blur', () => {
                element.style.transform = 'scale(1)';
                element.style.transition = 'all 0.2s ease';
              });
            }
          }
        });
            } else {
              console.log('â³ drawStudentCardé–¢æ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ç›´æ¥å®šç¾©ã—ã¾ã™');
                          // é–¢æ•°ã‚’ç›´æ¥å®šç¾©
            window.drawStudentCard = function() {
              console.log('âœ… drawStudentCardé–¢æ•°ã‚’ç›´æ¥å®šç¾©ã—ã¾ã—ãŸ');
              
              const canvas = document.getElementById('cardCanvas');
              if (!canvas) {
                console.error('âŒ cardCanvasè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
              }
              
              const ctx = canvas.getContext('2d');
              if (!ctx) {
                console.error('âŒ Canvas 2Dã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒå–å¾—ã§ãã¾ã›ã‚“');
                return;
              }
              
              // å­¦ç”Ÿè¨¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”»åƒã‚’èª­ã¿è¾¼ã‚“ã§æç”»
              const templateImage = new Image();
              templateImage.onload = function() {
                console.log('âœ… å­¦ç”Ÿè¨¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”»åƒã®èª­ã¿è¾¼ã¿å®Œäº†');
                
                // Canvasã‚’ã‚¯ãƒªã‚¢
                ctx.clearRect(0, 0, 800, 500);
                
                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”»åƒã‚’æç”»
                ctx.drawImage(templateImage, 0, 0, 800, 500);
                
                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒã‚’æç”»ï¼ˆå®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ã€çµ¶å¯¾å¤‰æ›´ç¦æ­¢ã€‘ï¼‰
                const photoInput = document.getElementById('photoInput');
                if (photoInput && photoInput.files && photoInput.files.length > 0) {
                  const file = photoInput.files[0];
                  const img = new Image();
                  img.onload = function() {
                    // å†™çœŸãƒ•ãƒ¬ãƒ¼ãƒ ã®åº§æ¨™ï¼ˆå®Œç’§ã«èª¿æ•´æ¸ˆã¿ã€å¤‰æ›´å³ç¦ã€‘ï¼‰
                    const PHOTO_FRAME = {
                      x: 42,   // å®Œç’§ã«èª¿æ•´æ¸ˆã¿ã€å¤‰æ›´å³ç¦ã€‘
                      y: 125,   // å®Œç’§ã«èª¿æ•´æ¸ˆã¿ã€å¤‰æ›´å³ç¦ã€‘
                      width: 255,  // å®Œç’§ã«èª¿æ•´æ¸ˆã¿ã€å¤‰æ›´å³ç¦ã€‘
                      height: 324  // å®Œç’§ã«èª¿æ•´æ¸ˆã¿ã€å¤‰æ›´å³ç¦ã€‘
                    };
                    
                    // ç”»åƒå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå®Œç’§ã«èª¿æ•´æ¸ˆã¿ã€å¤‰æ›´å³ç¦ã€‘ï¼‰
                    ctx.save();
                    ctx.beginPath();
                    ctx.rect(PHOTO_FRAME.x, PHOTO_FRAME.y, PHOTO_FRAME.width, PHOTO_FRAME.height);
                    ctx.clip();
                    
                    const frameAspect = PHOTO_FRAME.width / PHOTO_FRAME.height;
                    const imgAspect = img.width / img.height;
                    
                    let drawWidth, drawHeight, drawX, drawY;

                    if (imgAspect > frameAspect) {
                      drawHeight = PHOTO_FRAME.height;
                      drawWidth = PHOTO_FRAME.height * imgAspect;
                      drawX = PHOTO_FRAME.x - (drawWidth - PHOTO_FRAME.width) / 2;
                      drawY = PHOTO_FRAME.y;
                    } else {
                      drawWidth = PHOTO_FRAME.width;
                      drawHeight = PHOTO_FRAME.width / imgAspect;
                      drawX = PHOTO_FRAME.x;
                      drawY = PHOTO_FRAME.y - (drawHeight - PHOTO_FRAME.height) / 2;
                    }
                    
                    ctx.drawImage(img, drawX, drawY, drawWidth, drawHeight);
                    ctx.restore();
                    
                    console.log('âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒã‚’æç”»å®Œäº†');
                    
                    // ç”»åƒæç”»å¾Œã«æ–‡å­—ã‚’åˆ»å°
                    drawTextElements();
                  };
                  img.src = URL.createObjectURL(file);
                } else {
                  // ç”»åƒãŒãªã„å ´åˆã¯ç›´æ¥æ–‡å­—ã‚’åˆ»å°
                  drawTextElements();
                }
                
                // æ–‡å­—è¦ç´ ã‚’æç”»ã™ã‚‹é–¢æ•°
                function drawTextElements() {
                  // ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’å–å¾—
                  const nameJa = document.getElementById('nameJa')?.value || '';
                  const nameEn = document.getElementById('nameEn')?.value || '';
                  const dobMonth = document.getElementById('dobMonth')?.value || '';
                  const dobDay = document.getElementById('dobDay')?.value || '';
                
                // è¨ºæ–­çµæœã®æƒ…å ±ã‚’å–å¾—
                const params = new URLSearchParams(location.search);
                const departmentLabel = params.get('course') || '';
                const clubLabel = params.get('club') || '';
                
                // ãƒ•ã‚©ãƒ³ãƒˆã®æº–å‚™
                ctx.font = '34px "Noto Serif JP", serif';
                ctx.fillStyle = '#000';
                ctx.textAlign = 'left';
                
                // æ°åï¼ˆæ¼¢å­—ï¼‰ã‚’åˆ»å°ï¼ˆå®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ï¼‰
                if (nameJa) {
                  const nameX = Math.round(1400 / 2291 * 800);
                  const nameY = Math.round(540 / 1440 * 500);
                  ctx.fillText(nameJa, nameX, nameY);
                  console.log('âœ… æ°åï¼ˆæ¼¢å­—ï¼‰ã‚’åˆ»å°:', nameJa, 'ä½ç½®:', nameX, nameY);
                }
                
                // æ°åï¼ˆãƒ­ãƒ¼ãƒå­—ï¼‰ã‚’åˆ»å°ï¼ˆå®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ï¼‰
                if (nameEn) {
                  ctx.font = '16px "Noto Sans JP", sans-serif';
                  ctx.fillStyle = '#666';
                  const nameEnX = Math.round(1400 / 2291 * 800);
                  const nameEnY = Math.round(620 / 1440 * 500);
                  ctx.fillText(nameEn, nameEnX, nameEnY);
                  console.log('âœ… æ°åï¼ˆãƒ­ãƒ¼ãƒå­—ï¼‰ã‚’åˆ»å°:', nameEn, 'ä½ç½®:', nameEnX, nameEnY);
                }
                
                // ç”Ÿå¹´æœˆæ—¥ã‚’åˆ»å°ï¼ˆå®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ã€çµ¶å¯¾å¤‰æ›´ç¦æ­¢ã€‘ï¼‰
                if (dobMonth && dobDay) {
                  ctx.font = '22px "Noto Sans JP", sans-serif';
                  ctx.fillStyle = '#000';
                  ctx.textAlign = 'center';
                  const monthX = Math.round(1570 / 2291 * 800);
                  const monthY = Math.round(1050 / 1440 * 500);
                  const dayX = Math.round(1720 / 2291 * 800);
                  const dayY = Math.round(1050 / 1440 * 500);
                  ctx.fillText(dobMonth, monthX, monthY);
                  ctx.fillText(dobDay, dayX, dayY);
                  console.log('âœ… ç”Ÿå¹´æœˆæ—¥ã‚’åˆ»å°:', `${dobMonth}æœˆ${dobDay}æ—¥`, 'ä½ç½®:', monthX, monthY, dayX, dayY);
                }
                
                // å­¦ç§‘ãƒ»ã‚³ãƒ¼ã‚¹ãƒ»éƒ¨æ´»å‹•ã‚’åˆ»å°ï¼ˆå®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ã€çµ¶å¯¾å¤‰æ›´ç¦æ­¢ã€‘ï¼‰
                if (departmentLabel || clubLabel) {
                  // å­¦ç§‘ã¨ã‚³ãƒ¼ã‚¹ã‚’åˆ†ã‘ã¦ç”Ÿæˆ
                  let actualDepartment = '';
                  let actualCourse = '';
                  
                  if (departmentLabel) {
                    switch(departmentLabel) {
                      case 'ç‰¹é€²':
                      case 'ç‰¹é€²ã‚³ãƒ¼ã‚¹':
                        actualDepartment = 'æ™®é€šç§‘';
                        actualCourse = 'ç‰¹é€²ã‚³ãƒ¼ã‚¹';
                        break;
                      case 'è‹±èª':
                      case 'è‹±èªã‚³ãƒ¼ã‚¹':
                        actualDepartment = 'æ™®é€šç§‘';
                        actualCourse = 'è‹±èªã‚³ãƒ¼ã‚¹';
                        break;
                      case 'éŸ³æ¥½':
                      case 'éŸ³æ¥½ã‚³ãƒ¼ã‚¹':
                        actualDepartment = 'èŠ¸è¡“ç§‘';
                        actualCourse = 'éŸ³æ¥½ã‚³ãƒ¼ã‚¹';
                        break;
                      case 'ç¾è¡“':
                      case 'ç¾è¡“ã‚³ãƒ¼ã‚¹':
                        actualDepartment = 'èŠ¸è¡“ç§‘';
                        actualCourse = 'ç¾è¡“ã‚³ãƒ¼ã‚¹';
                        break;
                      default:
                        if (departmentLabel.endsWith('ã‚³ãƒ¼ã‚¹')) {
                          const baseName = departmentLabel.replace('ã‚³ãƒ¼ã‚¹', '');
                          if (baseName === 'ç‰¹é€²' || baseName === 'è‹±èª') {
                            actualDepartment = 'æ™®é€šç§‘';
                          } else if (baseName === 'éŸ³æ¥½' || baseName === 'ç¾è¡“') {
                            actualDepartment = 'èŠ¸è¡“ç§‘';
                          } else {
                            actualDepartment = 'æ™®é€šç§‘';
                          }
                          actualCourse = departmentLabel;
                        } else {
                          actualDepartment = departmentLabel;
                          actualCourse = departmentLabel + 'ã‚³ãƒ¼ã‚¹';
                        }
                    }
                  }
                  
                  // å­¦ç§‘ - å®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ã€çµ¶å¯¾å¤‰æ›´ç¦æ­¢ã€‘
                  ctx.font = '22px "Noto Sans JP", sans-serif';
                  ctx.fillStyle = '#000';
                  ctx.textAlign = 'center';
                  const deptX = Math.round(1520 / 2291 * 800);
                  const deptY = Math.round(800 / 1440 * 500);
                  if (actualDepartment) {
                    const cleanDepartment = actualDepartment.replace(/ç§‘$/, '');
                    ctx.fillText(cleanDepartment, deptX, deptY);
                    console.log('âœ… å­¦ç§‘ã‚’åˆ»å°:', cleanDepartment, 'ä½ç½®:', deptX, deptY);
                  }
                  
                  // ã‚³ãƒ¼ã‚¹ - å®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ã€çµ¶å¯¾å¤‰æ›´ç¦æ­¢ã€‘
                  ctx.font = '22px "Noto Sans JP", sans-serif';
                  ctx.fillStyle = '#000';
                  ctx.textAlign = 'center';
                  const courseX = Math.round(2000 / 2291 * 800);
                  const courseY = Math.round(800 / 1440 * 500);
                  if (actualCourse) {
                    ctx.fillText(actualCourse, courseX, courseY);
                    console.log('âœ… ã‚³ãƒ¼ã‚¹ã‚’åˆ»å°:', actualCourse, 'ä½ç½®:', courseX, courseY);
                  }
                  
                  // éƒ¨æ´» - å®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ã€çµ¶å¯¾å¤‰æ›´ç¦æ­¢ã€‘
                  ctx.font = '22px "Noto Sans JP", sans-serif';
                  ctx.fillStyle = '#000';
                  ctx.textAlign = 'center';
                  const clubX = Math.round(1620 / 2291 * 800);
                  const clubY = Math.round(920 / 1440 * 500);
                  if (clubLabel) {
                    let displayClubName;
                    if (clubLabel === 'å¸°å®…') {
                      displayClubName = 'ãƒ¼'; // å¸°å®…éƒ¨ã®å ´åˆã¯æ¨ªæ£’ã‚’è¡¨ç¤º
                    } else {
                      displayClubName = clubLabel.replace(/éƒ¨$/, '');
                    }
                    ctx.fillText(displayClubName, clubX, clubY);
                    console.log('âœ… éƒ¨æ´»å‹•ã‚’åˆ»å°:', displayClubName, 'ä½ç½®:', clubX, clubY);
                  }
                }
                
                console.log('âœ… å­¦ç”Ÿè¨¼ã®æç”»ãŒå®Œäº†ã—ã¾ã—ãŸ');
              }
              
              console.log('âœ… å­¦ç”Ÿè¨¼ã®æç”»ãŒå®Œäº†ã—ã¾ã—ãŸ');
            };
              
              templateImage.onerror = function() {
                console.error('âŒ å­¦ç”Ÿè¨¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šåŸºæœ¬çš„ãªæç”»
                ctx.clearRect(0, 0, 800, 500);
                ctx.fillStyle = '#f0f0f0';
                ctx.fillRect(0, 0, 800, 500);
                ctx.fillStyle = '#333';
                ctx.font = '24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('å­¦ç”Ÿè¨¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼', 400, 250);
              };
              
              // ç”»åƒã®èª­ã¿è¾¼ã¿é–‹å§‹
              console.log('ğŸ”„ å­¦ç”Ÿè¨¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”»åƒã‚’èª­ã¿è¾¼ã¿ä¸­...');
              templateImage.src = 'assets/img/student_template.png';
            };
              console.log('ğŸ”„ é–¢æ•°å®šç¾©å¾Œã«initGeneratorPageã‚’å®Ÿè¡Œä¸­...');
              window.initGeneratorPage();
            }
          } else {
            console.log('â³ initGeneratorPageé–¢æ•°ã®å®šç¾©ã‚’å¾…æ©Ÿä¸­...');
            // 100msé–“éš”ã§ãƒã‚§ãƒƒã‚¯ã€æœ€å¤§5ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
            if (window.drawFunctionTimeout) {
              clearTimeout(window.drawFunctionTimeout);
            }
            if (window.drawFunctionTimeoutCount === undefined) {
              window.drawFunctionTimeoutCount = 0;
            }
            window.drawFunctionTimeoutCount++;
            
            if (window.drawFunctionTimeoutCount > 50) { // 5ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
              console.error('âŒ initGeneratorPageé–¢æ•°ã®å®šç¾©ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
              return;
            }
            
            window.drawFunctionTimeout = setTimeout(checkDrawFunction, 100);
          }
        };
        checkDrawFunction();
      };
      script.onerror = () => console.error('âŒ app.jsç›´æ¥èª­ã¿è¾¼ã¿å¤±æ•—');
      document.head.appendChild(script);
    } else {
      console.log('âœ… app.jsã¯æ—¢ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™ï¼ˆç›´æ¥èª­ã¿è¾¼ã¿ã‚¹ã‚­ãƒƒãƒ—ï¼‰');
      // æ—¢ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å ´åˆã‚‚åˆæœŸåŒ–ã‚’å®Ÿè¡Œ
      setTimeout(() => {
        if (typeof window.initGeneratorPage === 'function') {
          console.log('ğŸ”„ initGeneratorPageã‚’å®Ÿè¡Œä¸­...ï¼ˆæ—¢å­˜ï¼‰');
          window.initGeneratorPage();
        } else {
          console.log('âŒ initGeneratorPageãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆæ—¢å­˜ï¼‰');
        }
      }, 100);
      
      // drawStudentCardé–¢æ•°ã®å®šç¾©ã‚’å¾…ã£ã¦ã‹ã‚‰åˆæœŸåŒ–ï¼ˆæ—¢å­˜ï¼‰
      const checkDrawFunctionExisting = () => {
        // app.jsã®èª­ã¿è¾¼ã¿å®Œäº†ã‚‚ãƒã‚§ãƒƒã‚¯
        if (typeof window.initGeneratorPage === 'function') {
          console.log('âœ… initGeneratorPageé–¢æ•°ãŒå®šç¾©ã•ã‚Œã¾ã—ãŸï¼ˆæ—¢å­˜ï¼‰');
          
          // drawStudentCardé–¢æ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€ã™ãã«é–¢æ•°ã‚’ç›´æ¥å®šç¾©
          if (typeof window.drawStudentCard === 'function') {
            console.log('âœ… drawStudentCardé–¢æ•°ã‚‚å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ï¼ˆæ—¢å­˜ï¼‰');
            console.log('ğŸ”„ é–¢æ•°å®šç¾©å¾Œã«initGeneratorPageã‚’å®Ÿè¡Œä¸­...ï¼ˆæ—¢å­˜ï¼‰');
            window.initGeneratorPage();
          } else {
            console.log('â³ drawStudentCardé–¢æ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ç›´æ¥å®šç¾©ã—ã¾ã™ï¼ˆæ—¢å­˜ï¼‰');
            // é–¢æ•°ã‚’ç›´æ¥å®šç¾©
            window.drawStudentCard = function() {
              console.log('âœ… drawStudentCardé–¢æ•°ã‚’ç›´æ¥å®šç¾©ã—ã¾ã—ãŸï¼ˆæ—¢å­˜ï¼‰');
              
              const canvas = document.getElementById('cardCanvas');
              if (!canvas) {
                console.error('âŒ cardCanvasè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆæ—¢å­˜ï¼‰');
                return;
              }
              
              const ctx = canvas.getContext('2d');
              if (!ctx) {
                console.error('âŒ Canvas 2Dã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒå–å¾—ã§ãã¾ã›ã‚“ï¼ˆæ—¢å­˜ï¼‰');
                return;
              }
              
              // å­¦ç”Ÿè¨¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”»åƒã‚’èª­ã¿è¾¼ã‚“ã§æç”»
              const templateImage = new Image();
              templateImage.onload = function() {
                console.log('âœ… å­¦ç”Ÿè¨¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”»åƒã®èª­ã¿è¾¼ã¿å®Œäº†ï¼ˆæ—¢å­˜ï¼‰');
                
                // Canvasã‚’ã‚¯ãƒªã‚¢
                ctx.clearRect(0, 0, 800, 500);
                
                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”»åƒã‚’æç”»
                ctx.drawImage(templateImage, 0, 0, 800, 500);
                
                // ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’å–å¾—
                const nameJa = document.getElementById('nameJa')?.value || '';
                const nameEn = document.getElementById('nameEn')?.value || '';
                const dobMonth = document.getElementById('dobMonth')?.value || '';
                const dobDay = document.getElementById('dobDay')?.value || '';
                
                // è¨ºæ–­çµæœã®æƒ…å ±ã‚’å–å¾—
                const params = new URLSearchParams(location.search);
                const departmentLabel = params.get('course') || '';
                const clubLabel = params.get('club') || '';
                
                // ãƒ•ã‚©ãƒ³ãƒˆã®æº–å‚™
                ctx.font = '34px "Noto Serif JP", serif';
                ctx.fillStyle = '#000';
                ctx.textAlign = 'left';
                
                // æ°åï¼ˆæ¼¢å­—ï¼‰ã‚’åˆ»å°ï¼ˆå®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ï¼‰
                if (nameJa) {
                  const nameX = Math.round(1400 / 2291 * 800);
                  const nameY = Math.round(540 / 1440 * 500);
                  ctx.fillText(nameJa, nameX, nameY);
                  console.log('âœ… æ°åï¼ˆæ¼¢å­—ï¼‰ã‚’åˆ»å°:', nameJa, 'ä½ç½®:', nameX, nameY);
                }
                
                // æ°åï¼ˆãƒ­ãƒ¼ãƒå­—ï¼‰ã‚’åˆ»å°ï¼ˆå®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ï¼‰
                if (nameEn) {
                  ctx.font = '16px "Noto Sans JP", sans-serif';
                  ctx.fillStyle = '#666';
                  const nameEnX = Math.round(1400 / 2291 * 800);
                  const nameEnY = Math.round(620 / 1440 * 500);
                  ctx.fillText(nameEn, nameEnX, nameEnY);
                  console.log('âœ… æ°åï¼ˆãƒ­ãƒ¼ãƒå­—ï¼‰ã‚’åˆ»å°:', nameEn, 'ä½ç½®:', nameEnX, nameEnY);
                }
                
                // ç”Ÿå¹´æœˆæ—¥ã‚’åˆ»å°ï¼ˆå®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ã€çµ¶å¯¾å¤‰æ›´ç¦æ­¢ã€‘ï¼‰
                if (dobMonth && dobDay) {
                  ctx.font = '22px "Noto Sans JP", sans-serif';
                  ctx.fillStyle = '#000';
                  ctx.textAlign = 'center';
                  const monthX = Math.round(1570 / 2291 * 800);
                  const monthY = Math.round(1050 / 1440 * 500);
                  const dayX = Math.round(1720 / 2291 * 800);
                  const dayY = Math.round(1050 / 1440 * 500);
                  ctx.fillText(dobMonth, monthX, monthY);
                  ctx.fillText(dobDay, dayX, dayY);
                  console.log('âœ… ç”Ÿå¹´æœˆæ—¥ã‚’åˆ»å°:', `${dobMonth}æœˆ${dobDay}æ—¥`, 'ä½ç½®:', monthX, monthY, dayX, dayY);
                }
                
                // å­¦ç§‘ãƒ»ã‚³ãƒ¼ã‚¹ãƒ»éƒ¨æ´»å‹•ã‚’åˆ»å°ï¼ˆå®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ã€çµ¶å¯¾å¤‰æ›´ç¦æ­¢ã€‘ï¼‰
                if (departmentLabel || clubLabel) {
                  // å­¦ç§‘ã¨ã‚³ãƒ¼ã‚¹ã‚’åˆ†ã‘ã¦ç”Ÿæˆ
                  let actualDepartment = '';
                  let actualCourse = '';
                  
                  if (departmentLabel) {
                    switch(departmentLabel) {
                      case 'ç‰¹é€²':
                      case 'ç‰¹é€²ã‚³ãƒ¼ã‚¹':
                        actualDepartment = 'æ™®é€šç§‘';
                        actualCourse = 'ç‰¹é€²ã‚³ãƒ¼ã‚¹';
                        break;
                      case 'è‹±èª':
                      case 'è‹±èªã‚³ãƒ¼ã‚¹':
                        actualDepartment = 'æ™®é€šç§‘';
                        actualCourse = 'è‹±èªã‚³ãƒ¼ã‚¹';
                        break;
                      case 'éŸ³æ¥½':
                      case 'éŸ³æ¥½ã‚³ãƒ¼ã‚¹':
                        actualDepartment = 'èŠ¸è¡“ç§‘';
                        actualCourse = 'éŸ³æ¥½ã‚³ãƒ¼ã‚¹';
                        break;
                      case 'ç¾è¡“':
                      case 'ç¾è¡“ã‚³ãƒ¼ã‚¹':
                        actualDepartment = 'èŠ¸è¡“ç§‘';
                        actualCourse = 'ç¾è¡“ã‚³ãƒ¼ã‚¹';
                        break;
                      default:
                        if (departmentLabel.endsWith('ã‚³ãƒ¼ã‚¹')) {
                          const baseName = departmentLabel.replace('ã‚³ãƒ¼ã‚¹', '');
                          if (baseName === 'ç‰¹é€²' || baseName === 'è‹±èª') {
                            actualDepartment = 'æ™®é€šç§‘';
                          } else if (baseName === 'éŸ³æ¥½' || baseName === 'ç¾è¡“') {
                            actualDepartment = 'èŠ¸è¡“ç§‘';
                          } else {
                            actualDepartment = 'æ™®é€šç§‘';
                          }
                          actualCourse = departmentLabel;
                        } else {
                          actualDepartment = departmentLabel;
                          actualCourse = departmentLabel + 'ã‚³ãƒ¼ã‚¹';
                        }
                    }
                  }
                  
                  // å­¦ç§‘ - å®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ã€çµ¶å¯¾å¤‰æ›´ç¦æ­¢ã€‘
                  ctx.font = '22px "Noto Sans JP", sans-serif';
                  ctx.fillStyle = '#000';
                  ctx.textAlign = 'center';
                  const deptX = Math.round(1520 / 2291 * 800);
                  const deptY = Math.round(800 / 1440 * 500);
                  if (actualDepartment) {
                    const cleanDepartment = actualDepartment.replace(/ç§‘$/, '');
                    ctx.fillText(cleanDepartment, deptX, deptY);
                    console.log('âœ… å­¦ç§‘ã‚’åˆ»å°:', cleanDepartment, 'ä½ç½®:', deptX, deptY);
                  }
                  
                  // ã‚³ãƒ¼ã‚¹ - å®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ã€çµ¶å¯¾å¤‰æ›´ç¦æ­¢ã€‘
                  ctx.font = '22px "Noto Sans JP", sans-serif';
                  ctx.fillStyle = '#000';
                  ctx.textAlign = 'center';
                  const courseX = Math.round(2000 / 2291 * 800);
                  const courseY = Math.round(800 / 1440 * 500);
                  if (actualCourse) {
                    ctx.fillText(actualCourse, courseX, courseY);
                    console.log('âœ… ã‚³ãƒ¼ã‚¹ã‚’åˆ»å°:', actualCourse, 'ä½ç½®:', courseX, courseY);
                  }
                  
                  // éƒ¨æ´» - å®Œç’§ãªä½ç½®ã«èª¿æ•´æ¸ˆã¿ã€çµ¶å¯¾å¤‰æ›´ç¦æ­¢ã€‘
                  ctx.font = '22px "Noto Sans JP", sans-serif';
                  ctx.fillStyle = '#000';
                  ctx.textAlign = 'center';
                  const clubX = Math.round(1620 / 2291 * 800);
                  const clubY = Math.round(920 / 1440 * 500);
                  if (clubLabel) {
                    let displayClubName;
                    if (clubLabel === 'å¸°å®…') {
                      displayClubName = 'ãƒ¼'; // å¸°å®…éƒ¨ã®å ´åˆã¯æ¨ªæ£’ã‚’è¡¨ç¤º
                    } else {
                      displayClubName = clubLabel.replace(/éƒ¨$/, '');
                    }
                    ctx.fillText(displayClubName, clubX, clubY);
                    console.log('âœ… éƒ¨æ´»å‹•ã‚’åˆ»å°:', displayClubName, 'ä½ç½®:', clubX, clubY);
                  }
                }
                
                console.log('âœ… å­¦ç”Ÿè¨¼ã®æç”»ãŒå®Œäº†ã—ã¾ã—ãŸï¼ˆæ—¢å­˜ï¼‰');
              };
              
              templateImage.onerror = function() {
                console.error('âŒ å­¦ç”Ÿè¨¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆæ—¢å­˜ï¼‰');
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šåŸºæœ¬çš„ãªæç”»
                ctx.clearRect(0, 0, 800, 500);
                ctx.fillStyle = '#f0f0f0';
                ctx.fillRect(0, 0, 800, 500);
                ctx.fillStyle = '#333';
                ctx.font = '24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('å­¦ç”Ÿè¨¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼', 400, 250);
              };
              
              // ç”»åƒã®èª­ã¿è¾¼ã¿é–‹å§‹
              console.log('ğŸ”„ å­¦ç”Ÿè¨¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”»åƒã‚’èª­ã¿è¾¼ã¿ä¸­...ï¼ˆæ—¢å­˜ï¼‰');
              templateImage.src = 'assets/img/student_template.png';
            };
            console.log('ğŸ”„ é–¢æ•°å®šç¾©å¾Œã«initGeneratorPageã‚’å®Ÿè¡Œä¸­...ï¼ˆæ—¢å­˜ï¼‰');
            window.initGeneratorPage();
          }
        } else {
          console.log('â³ initGeneratorPageé–¢æ•°ã®å®šç¾©ã‚’å¾…æ©Ÿä¸­...ï¼ˆæ—¢å­˜ï¼‰');
          // 100msé–“éš”ã§ãƒã‚§ãƒƒã‚¯ã€æœ€å¤§5ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
          if (window.drawFunctionTimeoutExisting) {
            clearTimeout(window.drawFunctionTimeoutExisting);
          }
          if (window.drawFunctionTimeoutCountExisting === undefined) {
            window.drawFunctionTimeoutCountExisting = 0;
          }
          window.drawFunctionTimeoutCountExisting++;
          
          if (window.drawFunctionTimeoutCountExisting > 50) { // 5ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
            console.error('âŒ initGeneratorPageé–¢æ•°ã®å®šç¾©ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸï¼ˆæ—¢å­˜ï¼‰');
            return;
          }
          
          window.drawFunctionTimeoutExisting = setTimeout(checkDrawFunctionExisting, 100);
        }
      };
      checkDrawFunctionExisting();
    }
  </script>
  

</body>
</html> 
