<!doctype html><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<!-- 超制限CSP：このページだけで完結 -->
<meta http-equiv="Content-Security-Policy"
  content="default-src 'none'; style-src 'unsafe-inline'; script-src 'unsafe-inline'">
<script>
(function(){
  try{
    var u = new URL(location.href).searchParams.get('u') || '';
    if (!u) { location.replace('/'); return; }
    // Clipboard API をまず試す
    var done = false;
    var finish = function(){
      var back = new URL(location.href).searchParams.get('back');
      if (back) { location.replace(back); return; }
      if (document.referrer) { location.replace(document.referrer); return; }
      location.replace('/'); // 最後の逃げ
    };
    if (navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(u).then(function(){ done=true; finish(); })
      .catch(function(){ /* 下へ */ runExec(); });
    } else {
      runExec();
    }
    function runExec(){
      try{
        var div = document.createElement('div');
        div.contentEditable='true'; div.textContent=u;
        div.style.position='fixed'; div.style.opacity='0';
        document.body.appendChild(div);
        var r=document.createRange(); r.selectNodeContents(div);
        var s=window.getSelection(); s.removeAllRanges(); s.addRange(r);
        document.execCommand('copy');
        s.removeAllRanges(); document.body.removeChild(div);
      }catch(e){}
      finish();
    }
  }catch(e){ location.replace('/'); }
})();
</script>
