<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>九条あまね - 放課後クロニクル | 学生証データベース</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Zen+Maru+Gothic:wght@400;500;700&family=Kalam:wght@300;400;700&family=Caveat:wght@400;500;600;700&family=Comic+Neue:wght@300;400;700&family=Klee+One:wght@400;600&display=swap" rel="stylesheet" crossorigin="anonymous">
    <script
      src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"
      integrity="sha384-z4bNmRd9zmbE6dF9Y0VTYB7qoBWVFJQCbS2L6vVG1AwOxTJM1gOvgWWPu6pJKGPc"
      crossorigin="anonymous"
      defer></script>
    <style>
        /* 修正版 - 2024年12月更新 - コンテンツカード位置復元・学校ノート調整・スティッキータブ接触・YouTube文字化完了 */
        :root {
            --amane-color: #ADD8E6;
            --amane-light: #E6F3FF;
            --amane-dark: #4A90E2;
            --amane-accent: #87CEEB;
            --nobara-color: #228B22;
            --nobara-light: #E8F5E8;
            --nobara-dark: #1B5E20;
            --nobara-accent: #4CAF50;
            --nobara-soft: #A5D6A7;
            --notebook-bg: #2A2A2A;
            --grid-color: #505050;
            --margin-line: #EF4444;
            --text-dark: #FFFFFF;
            --id-radius: 16px;
        }

        * {
            font-family: 'Klee One', 'Caveat', 'Comic Neue', 'Noto Sans JP', cursive !important;
        }

        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: 
                linear-gradient(90deg, transparent 79px, #999999 79px, #999999 81px, transparent 81px),
                repeating-linear-gradient(90deg, transparent 0px, transparent 19px, #AAAAAA 19px, #AAAAAA 20px),
                repeating-linear-gradient(0deg, transparent 0px, transparent 19px, #AAAAAA 19px, #AAAAAA 20px),
                #888888;
            background-size: 100% 100%, 20px 20px, 20px 20px, 100% 100%;
            color: var(--text-dark);
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            left: 30px;
            top: 0;
            width: 20px;
            height: 100vh;
            background: 
                radial-gradient(circle at 10px 60px, #BBBBBB 6px, transparent 6px),
                radial-gradient(circle at 10px 160px, #BBBBBB 6px, transparent 6px),
                radial-gradient(circle at 10px 260px, #BBBBBB 6px, transparent 6px),
                radial-gradient(circle at 10px 360px, #BBBBBB 6px, transparent 6px),
                radial-gradient(circle at 10px 460px, #BBBBBB 6px, transparent 6px),
                radial-gradient(circle at 10px 560px, #BBBBBB 6px, transparent 6px);
            background-repeat: repeat-y;
            background-size: 20px 100px;
            z-index: -1;
        }



        /* スティッキータブをノート左辺に縦並びで配置 */
        .sticky-tabs-container {
            position: absolute;
            top: 50px;
            left: 0px;
            z-index: 15;
        }

        .social-nav {
            display: flex;
            gap: 6px;
            background: rgba(240, 240, 240, 0.6);
            padding: 4px 6px;
            border-radius: 12px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* トグルスイッチデザイン */
        .character-selector {
            position: relative;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 25px;
            padding: 4px;
            border: 2px solid var(--amane-color);
            box-shadow: 0 4px 15px rgba(173, 216, 230, 0.3);
            backdrop-filter: blur(10px);
            display: flex;
            width: 200px;
        }

        /* スティッキータブデザイン - 縦並び強制 - 2024更新 - 自の字より左側配置 */
        .content-nav {
            display: flex !important;
            flex-direction: column !important;
            gap: 3px;
            background: transparent;
            padding: 0;
            border: none;
            box-shadow: none;
            backdrop-filter: none;
            position: relative;
        }

        .selector-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            border: none;
            flex: 1;
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--amane-dark);
            white-space: nowrap;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        /* スティッキータブボタン（縦並び） */
        .content-nav-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--amane-color);
            border: 2px solid var(--amane-dark);
            border-right: none;
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--amane-dark);
            white-space: nowrap;
            text-align: center;
            position: relative;
            border-radius: 8px 0 0 8px;
            margin-bottom: 0px;
            transform: translateX(0px);
            box-shadow: -2px 0 4px rgba(173, 216, 230, 0.3);
            min-height: 50px;
            width: 120px;
        }

        .selector-item.active {
            color: white;
            font-weight: 700;
        }

        /* トグルスイッチの背景スライダー */
        .character-selector::before {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            width: calc(50% - 4px);
            height: calc(100% - 8px);
            background: linear-gradient(135deg, var(--amane-color), var(--amane-accent));
            border-radius: 18px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(173, 216, 230, 0.4);
            z-index: 1;
        }

        /* のばらが選択された時のスライダー位置 */
        .character-selector.nobara-active::before {
            left: calc(50% + 0px);
            background: linear-gradient(135deg, var(--nobara-color), #006400);
            box-shadow: 0 2px 8px rgba(34, 139, 34, 0.4);
        }

        .content-nav-btn.active {
            transform: translateX(-2px);
            background: white;
            color: var(--amane-dark);
            font-weight: 700;
            z-index: 10;
            box-shadow: -3px 0 6px rgba(173, 216, 230, 0.4);
            border-color: var(--amane-dark);
        }

        .content-nav-btn:hover:not(.active) {
            transform: translateX(1px);
            background: var(--amane-light);
            color: var(--amane-dark);
        }

        /* SNSタブのスタイル（縦並び） */
        .content-nav-btn.sns-tab {
            background: var(--amane-accent);
            color: white;
            font-weight: 700;
            min-height: 40px;
            padding: 8px 6px;
            font-size: 0.6rem;
        }

        .content-nav-btn.sns-tab:hover {
            background: var(--amane-dark);
            transform: translateX(1px);
        }

        .selector-logo {
            width: 16px;
            height: 16px;
            object-fit: contain;
        }

        .social-nav-btn {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: none;
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .social-nav-btn.youtube { background: #ff0000; }
        .social-nav-btn.twitter { background: #000000; }

        /* メインレイアウト */
        .main-layout {
            min-height: 100vh;
            padding-top: 0px;
        }

        .character-image-outside {
            position: fixed;
            top: 5vh;
            left: 7vw;
            width: 50vw;
            height: 100vh;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }



        .amane-key-visual, .nobara-key-visual {
            height: 110vh;
            width: auto;
            object-fit: contain;
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.3));
            transition: all 0.4s ease;
        }



        /* 九条あまねモード時のサイズ調整 */
        .amane-mode .amane-key-visual {
            height: 100vh;
            max-width: 48vw;
        }

        .amane-key-visual {
            animation: float 3s ease-in-out infinite;
        }

        .nobara-key-visual {
            animation: float 3s ease-in-out infinite reverse;
            display: none; /* 初期状態では非表示 */
        }

        .amane-key-visual:hover, .nobara-key-visual:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 15px 40px rgba(0, 0, 0, 0.4));
        }

        /* 九条あまねモード：あまね単体表示 */
        .amane-mode .character-image-outside {
            justify-content: center;
            padding-left: 0vw;
        }

        .amane-mode .nobara-key-visual {
            display: none;
        }

        /* 高森のばらモード：のばら単体表示 */
        .nobara-mode .character-image-outside {
            justify-content: center;
            padding-left: 0vw;
        }

        .nobara-mode .amane-key-visual {
            display: none;
        }

        .nobara-mode .nobara-key-visual {
            display: block;
        }

        /* 高森のばらモード時ののばらのサイズ調整（あまねと同じサイズ） */
        .nobara-mode .nobara-key-visual {
            height: 95vh;
            max-width: 45vw;
            transform: translateY(-5vh) translateX(3vw);
        }



        /* キャッチコピー（中央＆1920距離感を維持） */
        .character-keyword {
            background:#fff; padding:10px 18px; border-radius:10px;
            width: fit-content; max-width: min(90vw, 980px);
            text-align:center; box-shadow: 0 6px 18px rgba(0,0,0,.12);
            z-index: 1001;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--amane-dark);
            border: 2px solid #4A4A4A;
            font-family: 'Klee One', cursive;
            text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
        }

        /* 1920×1080デザイン保持 - キービジュアルとの相対位置を維持 */
        .character-keyword {
            position: fixed;
            top: 15%;
            left: calc(7vw + 80px); /* キービジュアルの左端に80px重ねて配置 */
            transform: none; /* 中央揃えを解除 */
            writing-mode: vertical-rl;
            text-orientation: upright;
        }

        /* PC/タブは1920準拠の縦書き・キービジュアルの左側 */
        @media (min-width:1025px){
          .character-keyword{
            position: fixed; 
            left: calc(7vw + 80px); /* キービジュアルの左端に80px重ねて配置 */
            transform: none; /* 中央揃えを解除 */
            writing-mode: vertical-rl; 
            text-orientation: upright;
            top: 15%; /* 1920の距離感に合わせる */
          }
        }
        
        /* 1367px以上：1920×1080に近い画面での距離調整 */
        @media (min-width:1367px){
          .character-keyword{
            left: calc(7vw + 90px) !important; /* 1920×1080でより近い配置（90px重ねて配置） */
          }
        }
        
        /* 1600px以上：さらに大きな画面での距離調整 */
        @media (min-width:1600px){
          .character-keyword{
            left: calc(7vw + 100px) !important; /* 大きな画面で100px重ねて配置 */
          }
        }
        
        /* 1920px以上：最大画面での距離調整 */
        @media (min-width:1920px){
          .character-keyword{
            left: calc(7vw + 110px) !important; /* 1920×1080で110px重ねて配置 */
          }
        }
        /* スマホは横書き・上部中央 */
        @media (max-width:1024px){
          .character-keyword{
            writing-mode: horizontal-tb; 
            text-orientation: mixed;
            top: clamp(8px, 3vw, 24px);
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            width: fit-content;
            max-width: 90vw;
          }
        }

        /* 丸アイコン（顔）の表示とトリミング・ページ切替 */
        .mobile-nav{ position:fixed; left:12px; bottom: 18vh; display:flex; flex-direction:column; gap:10px; z-index: 8; }
        .fab{ width:80px; height:80px; border-radius:50%; overflow:hidden; border:none; padding:0; background:#fff; box-shadow:0 4px 12px rgba(0,0,0,.18); transition: all 0.3s ease; }
        .fab img{ width:150%; height:150%; object-fit: cover; }
        
        /* 現在表示しているページの顔アイコンを強調 */
        /* あまねモード時のアクティブアイコン */
        .amane-mode .fab[data-target="amane"] {
            transform: scale(1.15);
            box-shadow: 0 6px 20px rgba(0,0,0,.25), 0 0 0 3px var(--amane-color);
            background: var(--amane-light);
            z-index: 10;
        }
        
        /* のばらモード時のアクティブアイコン */
        .nobara-mode .fab[data-target="nobara"] {
            transform: scale(1.15);
            box-shadow: 0 6px 20px rgba(0,0,0,.25), 0 0 0 3px var(--nobara-color);
            background: var(--nobara-light);
            z-index: 10;
        }

        /* スマホサイズ（≤1024px）用のスタイル調整 */
        @media (max-width: 1024px) {
            /* モバイルナビゲーションをノート背景に重ねる */
            .mobile-nav {
                left: 20px !important;
                bottom: 20vh !important;
                z-index: 15 !important;
            }
            
                         /* キービジュアルが切れないように設定 */
             .character-image-outside {
                 width: 100% !important;
                 height: auto !important;
                 max-height: none !important;
                 overflow: visible !important;
                 object-fit: contain !important;
                 padding-top: 2vh !important;
                 box-sizing: border-box !important;
             }
            
                         .amane-key-visual,
             .nobara-key-visual {
                 width: 100% !important;
                 height: auto !important;
                 max-height: none !important;
                 object-fit: contain !important;
                 overflow: visible !important;
             }
             
             /* 高森のばらのキービジュアルを画面内に収める */
             .nobara-key-visual {
                 max-height: 85vh !important;
                 object-position: center center !important;
             }
            
                         /* 高森のばらのページのキービジュアルが切れないように特別調整 */
             .nobara-mode .nobara-key-visual {
                 object-position: center center !important;
                 width: 100% !important;
                 height: auto !important;
                 max-height: 90vh !important;
                 margin-top: 5vh !important;
             }
            
            /* コンテンツセクションを画面内で幅を広げる - 強制適用 */
            .content-section {
                width: calc(100vw - 40px) !important;
                margin-left: 0 !important;
                padding: 20px 15px 20px 20px !important;
                max-width: calc(100vw - 40px) !important;
                box-sizing: border-box !important;
            }
            
            /* コンテンツカードを画面内で幅を広げる - 強制適用 */
            .content-card {
                margin-left: 0 !important;
                border-radius: 12px !important;
                border-right: 2px solid var(--amane-color) !important;
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
            }

            /* 顔アイコン（.mobile-nav）を常に画面内の下部固定で可視化 */
            .mobile-nav{
                position:fixed !important;
                left:12px !important;
                bottom: calc(env(safe-area-inset-bottom) + 16px) !important; /* 端末下バー考慮 */
                z-index: 2200 !important;   /* ノート/画像より前、モーダル(2000)より下でもOK */
                opacity:1 !important;
                transform:none !important;
            }
            .fab{ width:72px; height:72px; }
        }

        /* 顔が中心に来るように調整 - 強制適用 */
        .fab[data-target="amane"] img{ 
            object-position: 35% 20% !important;   /* 35% = 顔を中心に、20% = 顔を上に */
        }
        .fab[data-target="nobara"] img{ 
            object-position: 35% 25% !important;   /* 35% = 顔をより左に、25% = 顔を上に */
        }

        /* 動画モードは削除済み */





        /* キーワード表示制御 */
        .amane-keyword, .nobara-keyword {
            display: none;
            color: #4A4A4A;
        }

        .amane-mode .amane-keyword {
            display: block;
        }

        .nobara-mode .nobara-keyword {
            display: block;
        }

        .content-section {
            width: 48vw;
            margin-left: 48vw;
            padding: 40px 30px 40px 40px;
            position: relative;
            z-index: 5;
            min-height: 100vh;
            box-sizing: border-box;
        }

        /* コンテンツカード - 白い紙のノート */
        .content-card {
            background: white !important;
            padding: 10px 45px 35px 45px !important;
            border-radius: 12px 0 0 12px !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
            border: 2px solid var(--amane-color) !important;
            border-right: none !important;
            margin-bottom: 35px !important;
            position: relative !important;
            transition: all 0.4s ease !important;
            opacity: 0;
            transform: translateY(30px);
            margin-left: 120px !important;
            /* 白い紙のノート風背景 - 水色マージン線と薄い罫線（右側マージン） */
            background-image: 
                /* 水色マージン線（右側） */
                linear-gradient(270deg, transparent 50px, var(--amane-color) 50px, var(--amane-color) 52px, transparent 52px),
                /* 薄い横罫線 */
                repeating-linear-gradient(
                    0deg,
                    transparent 0px,
                    transparent 23px,
                    rgba(173, 216, 230, 0.3) 23px,
                    rgba(173, 216, 230, 0.3) 24px
                ) !important;
            background-size: 100% 100%, 100% 24px !important;
        }

        .content-card.active {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }



        /* セクションタイトル */
        .section-title {
            font-family: 'Caveat', 'Klee One', cursive;
            font-size: 2.2rem;
            color: var(--amane-dark);
            margin-bottom: 15px;
            font-weight: 700;
            transform: rotate(-1deg);
            position: relative;
            text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.8);
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: -5px;
            right: 15px;
            height: 6px;
            background: linear-gradient(90deg, var(--amane-color), var(--amane-accent), var(--amane-color));
            border-radius: 3px;
                opacity: 0.8;
        }



                /* 学生証ギミックを「紹介ノート」内に戻し、全幅で表示 */
        .student-id-image-container{
          width: clamp(260px, 20vw, 380px);
          margin: clamp(64px,8vw,80px) auto clamp(18px,2vw,28px);
          aspect-ratio: 3 / 2;
          position: relative;
          z-index: 5; /* ノート上に必ず出す */
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
        }
        .student-id{
          width:100%;
          height:100%;
          object-fit:contain;
          filter:drop-shadow(0 6px 18px rgba(0,0,0,.25));
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
        }

        .student-id-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.3s ease;
            cursor: pointer;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .student-id-view.active {
            opacity: 1;
        }

        /* 学生証詳細表示スタイル - 全サイズで統一 */
        .student-id-detail, .student-id-back {
            background: white;
            padding: 20px;
            border-radius: 12px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            /* 全サイズで統一されたサイズ設定 */
            width: 100% !important;
            aspect-ratio: 3 / 2 !important;
            box-sizing: border-box !important;
        }
        
        /* 全サイズで学生証の表示を確実にする */
        .student-id-image-container,
        .student-id-views {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* 学生証の画像表示を確実にする */
        .student-id-image-container img {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            width: 100% !important;
            height: auto !important;
        }
        
        /* クリックギミック用のビュー制御 - JavaScriptで制御可能にする */
        .student-id-view {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .student-id-view.active {
            display: block !important;
            opacity: 1 !important;
        }

        /* あまね用の詳細表示（指定されたカラー） */
        .student-id-detail {
            background: linear-gradient(135deg, #6fa8ff, #8b79ff, #6f43d6);
            border: 2px solid #6f43d6;
        }

        .detail-content {
            text-align: center;
            color: white;
        }

        .detail-line {
            font-family: 'Klee One', cursive;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 8px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .detail-line:first-child {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        /* あまね用の裏面表示（指定されたカラー） */
        .student-id-back {
            background: linear-gradient(135deg, #2b0f0f, #7a0b0b, #cf1b1b);
            border: 2px solid rgba(43, 15, 15, 0.8) !important;
            box-shadow: 
                0 4px 16px rgba(207, 27, 27, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
        }

        .back-content {
            text-align: center;
            color: white;
        }

        .back-title {
            font-family: 'Klee One', cursive;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: #FFB6C1;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .back-line {
            font-family: 'Klee One', cursive;
            font-size: 1.0rem;
            font-weight: 500;
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            line-height: 1.4;
        }

        /* のばら用スタイル（あまねのカラーに統一） */
        #nobara-profile .student-id-detail {
            background: linear-gradient(135deg, #6fa8ff, #8b79ff, #6f43d6);
            border: 2px solid rgba(111, 67, 214, 0.8) !important;
            box-shadow: 
                0 4px 16px rgba(111, 67, 214, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
        }

        #nobara-profile .student-id-back {
            background: linear-gradient(135deg, #2b0f0f, #7a0b0b, #cf1b1b);
            border: 2px solid rgba(43, 15, 15, 0.8) !important;
            box-shadow: 
                0 4px 16px rgba(207, 27, 27, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
        }

        /* キャラクター情報 */
        .character-info {
            background: transparent;
            padding: 20px 0;
            border-radius: 0;
            margin: 20px 0 20px -30px;
            border: none;
            position: relative;
            z-index: 2;
            box-shadow: none;
            transform: scale(0.9);
        }

        .character-info h3 {
            font-family: 'Caveat', 'Klee One', cursive;
            font-size: 1.8rem;
            color: var(--amane-dark);
            margin-bottom: 20px;
            font-weight: 700;
            transform: rotate(-0.8deg);
            text-shadow: 1px 1px 3px rgba(173, 216, 230, 0.3);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: linear-gradient(135deg, #fff9c4 0%, #fff3a0 100%);
            border-radius: 0;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            min-height: 32px;
            transform: rotate(-1deg);
            position: relative;
            margin: 6px 3px;
        }

        .info-item::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 6px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 0 0 6px 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .info-item:nth-child(odd) {
            background: linear-gradient(135deg, #ffe4e1 0%, #ffd1cc 100%);
            transform: rotate(0.8deg);
        }

        .info-item:nth-child(3n) {
            background: linear-gradient(135deg, #e1f5fe 0%, #b3e5fc 100%);
            transform: rotate(-0.5deg);
        }

        .info-item:nth-child(4n) {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            transform: rotate(1.2deg);
        }

        .info-item:nth-child(5n) {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            transform: rotate(-0.8deg);
        }

        .info-item:hover {
            transform: translateY(-3px) scale(1.05) rotate(0deg);
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            z-index: 10;
        }

        .info-label {
            font-size: 0.8rem;
            color: #2d3748;
            font-weight: 600;
            font-family: 'Klee One', cursive;
            text-shadow: 0.5px 0.5px 1px rgba(255, 255, 255, 0.9);
            transform: rotate(-0.3deg);
            position: relative;
        }

        .info-label::after {
            content: ':';
            margin-left: 2px;
            color: #4a5568;
        }

        .info-value {
            font-size: 0.9rem;
            color: #2d3748;
            font-weight: 700;
            font-family: 'Caveat', cursive;
            transform: rotate(0.4deg);
            text-shadow: 0.5px 0.5px 1px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        /* 学校ノート風セクション - 白い紙（右開きページ） */
        .school-note {
            background: white;
            margin: 15px 0;
            padding: 15px 25px 15px 95px;
            border-radius: 0 8px 8px 0;
            border-right: 2px solid var(--amane-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(173, 216, 230, 0.4);
            transition: all 0.3s ease;
            transform: rotate(-0.4deg) scale(0.85);
            position: relative;
            min-height: 80px;
            /* max-height: 120px; 削除してテキストに応じて高さを調整 */
            /* 白い紙のノート風背景 - 水色マージン線と薄い罫線（左側マージン） */
            background-image: 
                /* 水色マージン線（左側） */
                linear-gradient(90deg, transparent 78px, var(--amane-color) 78px, var(--amane-color) 80px, transparent 80px),
                /* 薄い横罫線 */
                repeating-linear-gradient(
                    0deg,
                    transparent 0px,
                    transparent 23px,
                    rgba(173, 216, 230, 0.3) 23px,
                    rgba(173, 216, 230, 0.3) 24px
                );
            background-size: 100% 100%, 100% 24px;
            word-break: keep-all;
            overflow-wrap: break-word;
        }



        .school-note:nth-child(even) {
            transform: rotate(0.4deg) scale(0.85);
        }

        .school-note:hover {
            transform: translateY(-2px) scale(0.87);
            box-shadow: 0 4px 15px rgba(173, 216, 230, 0.2);
        }

        .school-note strong {
            color: var(--amane-dark);
            font-family: 'Caveat', 'Klee One', cursive;
            font-size: 1.0rem !important;
            font-weight: 700;
            transform: rotate(-0.6deg);
            display: inline;
                position: relative;
            text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.8);
            line-height: 1.8 !important;
        }

        .school-note strong::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--amane-color), var(--amane-accent), var(--amane-color));
            border-radius: 1px;
            opacity: 0.8;
        }

        .intro-text {
            font-size: 1.0rem;
            line-height: 1.8;
            color: #1A202C;
            font-weight: 500;
            text-shadow: 0.5px 0.5px 2px rgba(255, 255, 255, 0.8);
            word-break: keep-all;
            overflow-wrap: break-word;
            white-space: normal;
        }

        /* スティッキータブ */
        .sticky-tabs {
            position: fixed;
            left: calc(48vw + 80px);
            top: 30%;
            transform: translateY(-50%) translateY(30px);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
                opacity: 0;
            transition: all 0.4s ease;
            }

        .sticky-tabs.active {
                opacity: 1;
            transform: translateY(-50%) translateY(0);
        }

        .sticky-tab {
            padding: 10px 16px;
            border: none;
            border-radius: 12px 0 0 12px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: -2px 2px 8px rgba(0, 0, 0, 0.2);
            font-family: 'Klee One', cursive;
            min-width: 90px;
            text-align: center;
            border: 2px solid var(--amane-color);
            border-right: none;
            position: relative;
            overflow: hidden;
        }

        .sticky-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s ease;
        }

        .sticky-tab:active::before {
            left: 100%;
        }

        /* パルスアニメーション */
        @keyframes pulse {
            0% {
                transform: translateX(-5px) scale(1);
            }
            50% {
                transform: translateX(-5px) scale(1.05);
            }
            100% {
                transform: translateX(-5px) scale(1);
            }
        }

        .sticky-tab:hover {
            transform: translateX(-3px);
            box-shadow: -3px 3px 10px rgba(0, 0, 0, 0.3);
        }

        .sticky-tab.youtube {
            background: #FF0000;
            color: white;
            margin-top: 80px; /* ボタン二個分の間隔を追加 */
        }

        .sticky-tab.twitter {
            background: #000000;
            color: white;
        }



        .content-card {
            display: block;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.4s ease;
            pointer-events: none;
            visibility: hidden;
        }

        /* 学生証部分は常にクリック可能 */
        .student-id-views {
            pointer-events: auto !important;
            cursor: pointer;
        }

        .content-card.active {
            opacity: 1 !important;
            transform: translateY(0) !important;
            pointer-events: auto;
            visibility: visible !important;
            display: block !important;
        }

        /* モード別コンテンツ表示制御 */
        /* 九条あまねモード時：九条あまねのプロフィールのみ表示 */
        .amane-mode #profile {
            display: block !important;
        }
        .amane-mode #nobara-profile {
            display: none !important;
        }
        /* 高森のばらモード時：高森のばらのプロフィールのみ表示 */
        .nobara-mode #profile {
            display: none !important;
        }
        .nobara-mode #nobara-profile {
            display: block !important;
        }

        /* 動画モード時：動画コンテンツのみ表示 */






        /* 九条あまねプロフィール専用スタイル - 水色配色 */
        #profile.content-card {
            /* プロフィールのノート風スタイル */
            background: white !important;
            padding: 10px 45px 35px 45px !important;
            border-radius: 12px 0 0 12px !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
            border: 2px solid var(--amane-color) !important;
            border-right: none !important;
            margin-bottom: 35px !important;
            position: relative !important;
            transition: all 0.4s ease !important;
            margin-left: 120px !important;
            /* 水色のマージン線と薄い罫線（右側マージン） */
            background-image: 
                /* 水色マージン線（右側） */
                linear-gradient(270deg, transparent 50px, var(--amane-color) 50px, var(--amane-color) 52px, transparent 52px),
                /* 薄い横罫線 */
                repeating-linear-gradient(
                    0deg,
                    transparent 0px,
                    transparent 23px,
                    rgba(173, 216, 230, 0.3) 23px,
                    rgba(173, 216, 230, 0.3) 24px
                ) !important;
            background-size: 100% 100%, 100% 24px !important;
            /* 十分な最小高さを確保 */
            min-height: 100vh !important;
            /* アニメーション設定 */
            opacity: 0;
            transform: translateY(30px);
            pointer-events: none;
            visibility: hidden;
        }

        /* 高森のばらプロフィール専用スタイル - 深緑配色 */
        #nobara-profile.content-card {
            /* 高森のばら専用の深緑ノート風スタイル */
            background: white !important;
            padding: 10px 45px 35px 45px !important;
            border-radius: 12px 0 0 12px !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
            border: 2px solid var(--nobara-color) !important;
            border-right: none !important;
            margin-bottom: 35px !important;
            position: relative !important;
            transition: all 0.4s ease !important;
            margin-left: 120px !important;
            /* 高森のばら専用の深緑マージン線と薄い罫線（右側マージン） */
            background-image: 
                /* 深緑マージン線（右側） */
                linear-gradient(270deg, transparent 50px, var(--nobara-color) 50px, var(--nobara-color) 52px, transparent 52px),
                /* 薄い横罫線 */
                repeating-linear-gradient(
                    0deg,
                    transparent 0px,
                    transparent 23px,
                    rgba(34, 139, 34, 0.3) 23px,
                    rgba(34, 139, 34, 0.3) 24px
                ) !important;
            background-size: 100% 100%, 100% 24px !important;
            /* 十分な最小高さを確保 */
            min-height: 100vh !important;
            /* アニメーション設定 */
            opacity: 0;
            transform: translateY(30px);
            pointer-events: none;
            visibility: hidden;
        }

        #nobara-profile.content-card.active {
            /* プロフィールと同じアクティブ状態 */
            opacity: 1 !important;
            transform: translateY(0) !important;
            pointer-events: auto !important;
            visibility: visible !important;
            display: block !important;
        }

        /* 高森のばら専用の深緑配色 - 九条あまねと同じバランス */
        #nobara-profile .section-title {
            color: var(--nobara-dark);
        }

        #nobara-profile .section-title::after {
            background: linear-gradient(90deg, var(--nobara-color), var(--nobara-accent), var(--nobara-color));
        }

        #nobara-profile .character-info h3 {
            color: var(--nobara-dark);
            text-shadow: 1px 1px 3px rgba(34, 139, 34, 0.3);
        }

        #nobara-profile .school-note {
            background: white !important;
            border-right: 2px solid var(--nobara-color);
            border: 1px solid rgba(34, 139, 34, 0.4);
            /* 高森のばら専用の深緑マージン線と薄い罫線（左側マージン） */
            background-image: 
                /* 深緑マージン線（左側） */
                linear-gradient(90deg, transparent 78px, var(--nobara-color) 78px, var(--nobara-color) 80px, transparent 80px),
                /* 薄い横罫線 */
                repeating-linear-gradient(
                    0deg,
                    transparent 0px,
                    transparent 23px,
                    rgba(34, 139, 34, 0.3) 23px,
                    rgba(34, 139, 34, 0.3) 24px
                ) !important;
            background-size: 100% 100%, 100% 24px !important;
        }

        #nobara-profile .school-note:hover {
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
        }

        #nobara-profile .school-note strong {
            color: var(--nobara-dark);
        }

        #nobara-profile .school-note strong::after {
            background: linear-gradient(90deg, var(--nobara-color), var(--nobara-accent), var(--nobara-color));
        }

        #nobara-profile .intro-text {
            color: #1A202C;
        }

        /* 高森のばらのクリックカウンター */
        #nobara-profile .student-id-image-container div[style*="color: var(--amane-dark)"] {
            color: var(--nobara-dark) !important;
        }





























        .playlist-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }






        /* Coming Soon スタイル */
        .coming-soon-container {
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }



        /* レスポンシブデザイン - 古い重複定義を削除済み */
        
        /* デスクトップ下位対応 (1366px以下) */
        @media (max-width: 1366px) {
            /* その他の調整 */
            body::before {
                display: none; /* ノート穴を非表示 */
            }

            /* スクロールインジケーター調整 */
            .scroll-indicator {
                right: 12px;
                width: 5px;
                height: 45vh;
            }

            /* グリッド調整 */
            .info-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 8px;
            }


        }

        /* 古い768px対応を削除済み */

        /* 古い480px対応を削除済み */

        /* 古い動画モード専用レスポンシブ調整を削除済み */

        /* アクティブタブの強調表示 */
        .sticky-tab.active {
            transform: translateX(-8px) scale(1.05) !important;
            box-shadow: 
                -6px 6px 20px rgba(0, 0, 0, 0.4),
                0 0 15px rgba(255, 255, 255, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
            border: 3px solid rgba(255, 255, 255, 0.4) !important;
            border-right: none !important;
            z-index: 10;
            font-weight: 700 !important;
        }

        /* アクティブタブのパルス効果 */
        @keyframes activeGlow {
            0%, 100% {
                box-shadow: 
                    -6px 6px 20px rgba(0, 0, 0, 0.4),
                    0 0 15px rgba(255, 255, 255, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
            50% {
                box-shadow: 
                    -6px 6px 20px rgba(0, 0, 0, 0.4),
                    0 0 25px rgba(255, 255, 255, 0.5),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }
        }

        .sticky-tab.active {
            animation: activeGlow 2s ease-in-out infinite;
        }

        /* スクロールインジケーター */
        .scroll-indicator {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 60vh;
            background: linear-gradient(180deg, 
                rgba(255, 183, 77, 0.2) 0%,
                rgba(255, 138, 101, 0.2) 25%,
                rgba(255, 112, 67, 0.2) 50%,
                rgba(156, 39, 176, 0.2) 75%,
                rgba(63, 81, 181, 0.2) 100%
            );
            border-radius: 4px;
            z-index: 500;
            border: 1px solid rgba(255, 183, 77, 0.3);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .scroll-progress {
            width: 100%;
            height: 0%;
            background: linear-gradient(180deg, 
                #FFB74D 0%,
                #FF8A65 25%,
                #FF7043 50%,
                #9C27B0 75%,
                #3F51B5 100%
            );
            border-radius: 4px;
            transition: height 0.1s ease-out;
            position: absolute;
            top: 0;
            left: 0;
            box-shadow: 0 0 10px rgba(255, 183, 77, 0.4);
        }

        /* スクロールインジケーターの装飾 */
        .scroll-indicator::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 12px solid #FFB74D;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .scroll-indicator::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 12px solid #3F51B5;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        /* スクロールインジケーターのホバー効果 */
        .scroll-indicator:hover {
            width: 12px;
            box-shadow: 0 4px 16px rgba(255, 183, 77, 0.3);
        }

        /* 古い1919px対応を削除済み */

        /* 古い1024px対応を削除済み */

        /* 古い600px対応を削除済み */

        /* ========= 全画面サイズで統一された学生証とカードスタイル ========= */
        /* 学生証の基本サイズ統一 - 全画面サイズで過不足なく表示 */
        .student-id-image-container,
        .student-id-views {
            width: 100% !important;
            max-width: 400px !important;
            height: auto !important;
            aspect-ratio: 3 / 2 !important;
            margin: 60px auto 0 auto !important; /* 上マージンをさらに増やして下に配置 */
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative !important;
        }
        
        .student-id-view img {
            width: 100% !important;
            height: auto !important;
            object-fit: contain !important;
        }
        
        /* 学生証クリック時のカードサイズ調整 - 学生証と同じサイズで統一 */
        .student-id-detail,
        .student-id-back,
        #nobara-profile .student-id-detail,
        #nobara-profile .student-id-back{
            width: 100% !important;
            height: auto !important;
            aspect-ratio: 3 / 2 !important; /* 学生証と同じ縦横比 */
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 20px !important; /* 適切な余白を確保 */
            box-sizing: border-box !important;
            border-radius: 16px !important; /* より洗練された角丸 */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2) !important; /* より洗練された影 */
            margin: 0 !important; /* マージンをリセット */
            position: relative !important;
            overflow: hidden !important; /* 縁が切れないように */
        }
        
        .detail-content,
        .back-content{
            width: 100% !important;
            text-align: center !important;
            padding: 12px !important; /* 適切な余白を確保 */
            box-sizing: border-box !important;
            max-width: calc(100% - 24px) !important; /* 縁が切れないように */
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        /* 学生証のテキストスタイルに合わせる - 全画面サイズで統一された美しいデザイン */
        .detail-title,
        .back-title{
            font-family: 'Caveat', 'Klee One', cursive !important;
            font-size: 1.3rem !important;
            font-weight: 700 !important;
            margin-bottom: 16px !important;
            color: white !important;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;
            text-align: center !important;
            letter-spacing: 0.5px !important;
            line-height: 1.3 !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            display: block !important;
            width: 100% !important;
            max-width: 100% !important;
        }
        
        .detail-text,
        .back-text{
            font-family: 'Caveat', 'Klee One', cursive !important;
            font-size: 1.1rem !important;
            line-height: 1.6 !important;
            color: white !important;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important;
            font-weight: 400 !important;
            text-align: center !important;
            letter-spacing: 0.4px !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            display: block !important;
            width: 100% !important;
            max-width: 100% !important;
        }

        /* ========= ≤1024pxのみ適用。1920×1080は一切変更しない ========= */
        @media (max-width: 1024px){
          /* スマホサイズ用のフォントサイズ調整 - 余白を確保して読みやすく */
          .detail-title,
          .back-title{
            font-size: 1.0rem !important;
            margin-bottom: 12px !important;
            line-height: 1.2 !important;
          }
          
          .detail-text,
          .back-text{
            font-size: 0.85rem !important;
            line-height: 1.4 !important;
          }

          /* まず、固定配置を撤回して通常フローに戻す（!important で強制） */
          .character-image-outside,
          .character-keyword,
          .sticky-tabs,
          .content-section{
            position: static !important;
            left: auto !important;
            top: auto !important;
            transform: none !important;
            margin: 0;
          }

          /* 画面をグリッドで組み直し：順序= KV → コピー → タブ → ノート */
          body{
            display: grid;
            grid-template-columns: 44px minmax(0,1fr); /* 左44pxにタブ、右にノート/その他 */
            grid-template-rows: auto auto auto;        /* KV, コピー, タブ+ノート */
            grid-template-areas:
              "kv    kv"
              "copy  copy"
              "tabs  note";
            gap: 8px;
            align-items: start;
          }

          .character-image-outside{ grid-area: kv; width: min(88vw, 560px); height: auto; margin: 0 auto; }
          .amane-key-visual, .nobara-key-visual{ width: 100%; height: auto; max-width: none; }

          .character-keyword{
            grid-area: copy;
            writing-mode: horizontal-tb;
            text-orientation: mixed;
            text-align: center;
            padding: 8px 12px;
            font-size: clamp(0.95rem, 2.6vw, 1.1rem);
            justify-self: center;
            width: fit-content;
            max-width: 90vw;
          }

          /* タブは常にノートと接地（左サイドに縦並び、スクロールに追従） */
          .sticky-tabs{
            grid-area: tabs;
            position: sticky !important;
            top: 8px;                 /* 追従位置 */
            display: flex;
            flex-direction: column;   /* 縦並び */
            gap: 6px;
            writing-mode: vertical-rl;  /* 縦書きでタブ文字が読める */
          }
          .sticky-tab{ min-width: 44px; padding: 6px 4px; }

          /* ノート（紹介カード） */
          .content-section{
            grid-area: note;
            width: auto !important;
            margin: 0 !important;
            padding: clamp(12px, 3vw, 24px);
          }
          .content-card{
            margin-left: 0 !important;          /* 余計な左マージンを消す */
            border-radius: 12px !important;
            padding: clamp(15px, 4vw, 30px) clamp(20px, 5vw, 45px) clamp(25px, 6vw, 35px) clamp(20px, 5vw, 45px) !important;
            box-sizing: border-box !important;
          }

          /* 学生証は全画面サイズで統一されたスタイルが適用される */
          
          /* ≤1024pxで学生証の表示を確実にする */
          .student-id-image-container,
          .student-id-views {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
          }
          
          /* ≤1024px用のクリックギミック制御 */
          .student-id-view {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
          }
          
          .student-id-view.active {
            display: block !important;
            opacity: 1 !important;
          }

          /* スマホサイズでの学生証サイズ調整 - テキストが収まるように */
          .student-id-image-container {
            width: clamp(280px, 80vw, 360px) !important;
            margin: clamp(30px, 5vw, 50px) auto clamp(15px, 2vw, 25px) !important;
            max-width: calc(100% - 40px) !important;
            box-sizing: border-box !important;
          }

          /* 学生証のビューも同じサイズ制限を適用 */
          .student-id-views {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
            overflow: hidden !important;
          }

          /* 学生証クリック時のカードもノート背景内に収める */
          .student-id-detail,
          .student-id-back {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
            padding: 15px !important;
            overflow: hidden !important;
          }

          /* 学生証内のテキストサイズも調整 */
          .detail-title,
          .back-title {
            font-size: 0.75rem !important;
            margin-bottom: 10px !important;
            line-height: 1.1 !important;
          }
          
          .detail-text,
          .back-text {
            font-size: 0.6rem !important;
            line-height: 1.3 !important;
          }




        }

        /* さらにスマホでの微調整（幅600px以下） */
        @media (max-width: 600px){
          .sticky-tab{ font-size: 12px; }
          .section-title{ font-size: clamp(1.3rem, 6vw, 1.7rem); }
        }











        /* 1025px以上では丸アイコンUIを隠し、縦タブを使う */
        @media (min-width: 1025px){
          .mobile-nav{ display:none !important; }
          .sticky-tabs{ display:flex !important; }
        }

        /* 1025–1366px を 1920 デザインに寄せる微調整 */
        @media (min-width:1025px) and (max-width:1366px){
          /* ノートの幅と基準位置（1920の比率に準拠） - 幅を拡大 */
          .content-section{
            width: min(55vw, 900px) !important; /* 48vw → 55vw、800px → 900px */
            margin-left: calc(45vw + 15px) !important; /* ノートの左端を調整 */
            position: relative !important;
          }
          /* キービジュアルは左側に縮尺配置 */
          .character-image-outside{ 
            width: min(35vw, 400px) !important; /* 40vw → 35vw、450px → 400px */
            left: max(3vw, 25px) !important; /* 4vw → 3vw、30px → 25px */
            position: fixed !important;
            top: 5vh !important;
          }

          /* タブはノート左肩に"接地"させる - スクロール追従付き付箋イメージ */
          .sticky-tabs{
            position: fixed !important; /* absolute → fixed に変更してスクロール追従 */
            right: calc(100vw - (45vw + 25px)) !important; /* ノートからほんの少し外に移動（15px → 25px） */
            top: 35% !important; /* ノートの上側に配置（25% → 35%） */
            transform: translateY(-50%) !important;
            z-index: 1000 !important;
            display: flex !important;
            flex-direction: column !important;
            gap: 8px !important;
            /* タブの幅をさらに狭くしてノートとの重なりを軽減 */
            max-width: 50px !important;
            overflow: visible !important; /* タブが完全に見えるように */
          }
          .sticky-tab{ 
            min-width: 50px !important; /* 65px → 50px に変更して横幅を狭く */
            max-width: 50px !important; /* 最大幅も制限 */
            width: 50px !important; /* 固定幅を設定 */
            writing-mode: vertical-rl !important;
            border-radius: 12px 0 0 12px !important;
            padding: 8px 12px !important; /* パディングも調整（10px 16px → 8px 12px） */
            box-sizing: border-box !important; /* パディングを幅に含める */
          }

          /* 学生証は全画面サイズで統一されたスタイルが適用される */
          
          /* 学生証クリック時のカードスタイルは全画面サイズで統一されたスタイルを使用 */
          
          /* あまねとノバラの両方の学生証カードは全画面サイズで統一されたスタイルが適用される */
          
          /* 学生証のビュー制御 - 初期状態では最初のビューのみ表示 */
          .student-id-view:not(.active){
            display: none !important;
          }
          
          .student-id-view.active{
            display: block !important;
          }
          
          /* キャッチコピーの位置調整 - キービジュアルの左側に配置 */
          .character-keyword{
            top: 15% !important; /* 1920の距離感に合わせる */
            left: calc(max(3vw, 25px) + 60px) !important; /* キービジュアルの左端に60px重ねて配置 */
            transform: none !important; /* 中央揃えを解除 */
            writing-mode: vertical-rl !important;
            text-orientation: upright !important;
            z-index: 999 !important;
            width: fit-content !important;
            max-width: 90% !important;
          }
        }

        /* ≤1024px（スマホ／小タブレット） */
        @media (max-width:1024px){
          /* キービジュアルを「切れない範囲で画面いっぱい」に */
          .character-image-outside{ position:static !important; width:100vw !important; max-height:100vh !important; margin:0 auto 8px; }
          .amane-key-visual,.nobara-key-visual{ width:100% !important; height:auto !important; max-height:100vh !important; object-fit:contain !important; }
          /* ノート幅を最大化（丸アイコンが重なってOK） */
          .content-section{ width:100vw !important; margin:0 !important; padding: clamp(12px, 3vw, 24px) clamp(100px, 12vw, 140px) clamp(12px, 3vw, 24px) clamp(12px, 3vw, 24px) !important; }
          .content-card{ margin-left: 0 !important; }
          /* 付箋（ノートの切れ端）の縦水色ラインは消す（本文幅確保） */
          .school-note::before, .paper-left-rule, .note-line { display:none !important; }
          /* キャッチコピーの位置調整 */
          .character-keyword{ top: clamp(8px, 3vw, 24px); width:max-content; padding-inline: clamp(10px,2.6vw,20px); }

          /* タブを完全に非表示にして顔アイコンのみ表示 */
          .sticky-tabs{ display: none !important; }
          .mobile-nav{ display: flex !important; }
          
          /* ≤1024px専用の顔アイコン調整 */
          .fab img{ object-position:0% 0% !important; } /* 最左寄せ */

          /* のばらページの付箋エリアの縦線を完全に消す */
          #nobara-profile .school-note{
            /* ルーラー（左の緑2pxライン）を外し、罫線だけに */
            background-image:
              repeating-linear-gradient(
                0deg,
                transparent 0px,
                transparent 23px,
                rgba(34,139,34,0.3) 23px,
                rgba(34,139,34,0.3) 24px
              ) !important;
            padding-left: 25px !important; /* 本文幅を確保 */
          }
          /* あまねページの付箋も同様に */
          .school-note{
            background-image: 
              repeating-linear-gradient(
                0deg,
                transparent 0px,
                transparent 23px,
                rgba(173, 216, 230, 0.3) 23px,
                rgba(173, 216, 230, 0.3) 24px
              ) !important;
            padding-left: 25px !important; /* 本文幅を確保 */
          }
        }

        /* 1025px 以上はモバイルUIを隠す（重複対策） */
        @media (min-width:1025px){ 
          .mobile-nav{ display:none !important; } 
          .sticky-tabs{ display:flex !important; }
          
          /* 1025px以上用の学生証カードサイズ統一 */
          .student-id-detail,
          .student-id-back{
            width: 100% !important;
            aspect-ratio: 3 / 2 !important;
            box-sizing: border-box !important;
            border-radius: 8px !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
          }
          
          /* 1025px以上で学生証の表示を確実にする */
          .student-id-image-container,
          .student-id-views {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
          }
          
          /* 1025px以上用のクリックギミック制御 */
          .student-id-view {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
          }
          
          .student-id-view.active {
            display: block !important;
            opacity: 1 !important;
          }
        }

        /* 学生証内のテキストサイズも調整 */
        .detail-title,
        .back-title {
          font-size: 1.0rem !important;
          margin-bottom: 10px !important;
          line-height: 1.1 !important;
        }
        
        .detail-text,
        .back-text {
          font-size: 0.8rem !important;
          line-height: 1.3 !important;
        }

        /* 高森のばらの学生証テキストを特に調整 */
        #nobara-profile .detail-title,
        #nobara-profile .back-title {
          font-size: 0.9rem !important;
          margin-bottom: 6px !important;
          line-height: 1.0 !important;
          word-wrap: break-word !important;
          overflow-wrap: break-word !important;
        }
        
        #nobara-profile .detail-text {
          font-size: 0.75rem !important;
          line-height: 1.1 !important;
          word-break: break-all !important;
          overflow-wrap: break-word !important;
          margin: 0 !important;
          padding: 0 !important;
        }
        
        #nobara-profile .back-text {
          font-size: 0.8rem !important;
          line-height: 1.1 !important;
          word-wrap: break-word !important;
          overflow-wrap: break-word !important;
        }

        /* 高森のばらの学生証カードのパディングを調整 */
        #nobara-profile .student-id-detail,
        #nobara-profile .student-id-back {
          padding: 12px !important;
        }

        /* 高森のばらの学生証テキストの表示制御強化 */
        #nobara-profile .detail-content,
        #nobara-profile .back-content {
          width: 100% !important;
          max-width: 100% !important;
          padding: 8px !important;
          box-sizing: border-box !important;
        }

                /* 高森のばらの学生証テキストの改行制御 */
        #nobara-profile .detail-text br {
            display: block !important;
            content: "" !important;
            margin-top: 2px !important;
        }

        /* 学生証モーダル用CSS - スマホサイズ時のみ適用 */
        :root { --id-modal-dim: rgba(0,0,0,.6); }
        .no-scroll { overflow: hidden; }

        /* 親が相対配置でないケースに備え強制 */
        .student-id-image-container { position: relative !important; z-index: 10; }

        /* スマホでだけ小さい学生証全面に透明ボタンを被せて既存クリックを奪取 */
        @media (max-width:1024px){
          .id-zoom-shield{
            position: absolute; inset: 0; background: transparent; border: 0;
            padding: 0; margin: 0; cursor: zoom-in; z-index: 50; display: block;
          }
        }
        @media (min-width:1025px){ .id-zoom-shield{ display: none; } }

        .id-modal{ 
          position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:2000;
          padding:
            max(8px, env(safe-area-inset-top))
            max(8px, env(safe-area-inset-right))
            max(8px, env(safe-area-inset-bottom))
            max(8px, env(safe-area-inset-left));
        }
        .id-modal.open{ display:flex; }
        .id-modal__backdrop{ position:absolute; inset:0; background:var(--id-modal-dim); backdrop-filter:blur(2px); }
        .id-modal__inner{ 
          position: relative;
          width: min(96vw, 720px);   /* 初期値（JSで上書き） */
          height: auto;
          max-height: calc(100dvh - 16px);
          border-radius: 16px;
          box-shadow: 0 20px 60px rgba(0,0,0,.35);
          overflow: hidden;
          background: transparent;
          box-sizing: border-box;
        }
        .id-modal__stage{ width:100%; height:100%; }

        /* ====== Mobile only: Prevent "overflow clipping" within the modal ====== */
        @media (max-width:1024px){
          .id-modal{
            /* Ensure safe-area (for device bottom bar) */
            padding:
              max(10px, env(safe-area-inset-top))
              max(10px, env(safe-area-inset-right))
              max(12px, env(safe-area-inset-bottom))
              max(10px, env(safe-area-inset-left));
          }
          .id-modal__inner{
            /* Remove height limit as it's managed by JS, and avoid visual clipping of shadows/corners */
            max-height: none !important;
            overflow: visible !important;
          }
          /* Ensure a thin inner margin to prevent shadows from appearing clipped */
          .id-modal__stage{
            padding-bottom: 8px;      /* Create a slight escape at the bottom */
            box-sizing: border-box;
          }
          /* Adjust shadow for cloned cards if it appears too harsh (optional) */
          .id-modal .student-id-view{
            box-shadow: 0 8px 28px rgba(0,0,0,.28); /* Reduce visual bleed */
            border-radius: 15px;
          }

          /* 拡大前カードの最大サイズを広げる */
          .student-id-image-container,
          .student-id-views{
            width: min(92vw, 520px) !important;
            max-width: min(92vw, 520px) !important;
            margin: clamp(18px, 4vw, 28px) auto clamp(10px, 2.5vw, 20px) !important;
            aspect-ratio: 3 / 2 !important;
          }

          /* 画像を確実にフィット */
          .student-id,
          .student-id-view img{
            width:100% !important; height:100% !important; object-fit: contain !important;
          }

          /* コンテンツ余白を確保 */
          .detail-content,
          .back-content{
            padding: clamp(14px, 4vw, 22px) !important;
            gap: clamp(6px, 1.8vw, 10px) !important;
          }

          /* タイトルは見出しとして明瞭に */
          .detail-title,
          .back-title{
            font-size: clamp(1.0rem, 4.2vw, 1.25rem) !important;
            line-height: 1.25 !important;
            margin-bottom: clamp(10px, 2.6vw, 14px) !important;
            letter-spacing: 0.02em !important;
          }

          /* 本文は一段階大型化 */
          .detail-text,
          .back-text{
            font-size: clamp(0.85rem, 3.6vw, 1.05rem) !important;
            line-height: 1.55 !important;
            letter-spacing: 0.01em !important;
          }

          /* ノート内で 90% 程度に抑える（上書き用にセレクタを強め＋!important） */
          .content-card .student-id-image-container,
          .content-card .student-id-views{
            width: min(90%, 340px) !important;
            max-width: min(90%, 340px) !important;
            aspect-ratio: 3 / 2 !important;
            margin: clamp(22px,4.5vw,30px) auto clamp(10px,2vw,18px) !important;
          }
          /* シールドや画像も縮尺に追随 */
          .content-card .student-id,
          .content-card .student-id-view img,
          .content-card .id-zoom-shield{ width:100% !important; height:100% !important; }
        }
        .id-modal__close{
          position:absolute; top:8px; right:8px;
          width:44px; height:44px; border:none; border-radius:50%;
          background:rgba(0,0,0,.55); color:#fff; font-size:22px; line-height:1;
          z-index:3000;             /* stage より確実に前面 */
          cursor:pointer; display:flex; align-items:center; justify-content:center;
          -webkit-tap-highlight-color: transparent;
        }

        @media (min-width:1025px){ .id-modal{ display:none !important; } }

        /* モーダル内でも既存のカードが綺麗に収まるよう最低限の保険 */
        .id-modal .student-id-view{ width:100% !important; height:100% !important; display:none; }
        .id-modal .student-id-view.active{ display:block !important; }

        /* 角丸クリッピング専用のマスク層 */
        .id-modal__mask{
          position: relative;
          width: 100%;
          height: 100%;
          border-radius: var(--id-radius);
          overflow: hidden;          /* ここで角を切る */
        }

        /* 中身は全部マスクの角丸を継承 */
        .id-modal .student-id-view,
        .id-modal .student-id-detail,
        .id-modal .student-id-back,
        .id-modal .student-id-view img{
          border-radius: inherit !important;
        }

    </style>
</head>
<body>


        <!-- スティッキータブ -->
    <div class="sticky-tabs active">
        <button class="sticky-tab" data-target="amane" style="background: var(--amane-color); color: var(--amane-dark);">九条あまね</button>
        <button class="sticky-tab" data-target="nobara" style="background: var(--nobara-soft); color: var(--nobara-dark);">高森のばら</button>

        <button class="sticky-tab youtube" onclick="openYouTube()" title="YouTube">YouTube</button>
        <button class="sticky-tab twitter" onclick="openTwitter()" title="X (Twitter)">X</button>
                        </div>

    <div class="main-layout">
        <!-- コンテンツエリア -->
        <section class="content-section">
            <div class="content-container" style="position: relative;">

            <!-- プロフィールコンテンツ -->
            <div id="profile" class="content-card active" data-section="amane">
                <h2 class="section-title">自己紹介ノート</h2>
                
                <!-- 学生証画像 -->
                <div class="student-id-image-container" id="amane-student-id" onclick="cycleAmaneStudentId()">
                    <div class="student-id-views">
                        <div class="student-id-view active" id="amane-view1">
                            <img src="assets/img/amane.png" alt="九条あまね 学生証" loading="eager" />
                        </div>
                        <div class="student-id-view" id="amane-view2">
                            <div class="student-id-detail">
                                <div class="detail-content">
                                    <div class="detail-title">帰宅部</div>
                                    <div class="detail-text">
                                        ここだけの話、部活動に興味はあるらしい。
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="student-id-view" id="amane-view3">
                            <div class="student-id-back">
                                <div class="back-content">
                                    <div class="back-title">隠された一面</div>
                                    <div class="back-text">
                                        目に映る景色が真実とは限らない。<br>
                                        黄昏は、ふいに足元をさらっていく。
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- キャラクター情報 -->
                <div class="character-info">
                    <h3>キャラクター詳細</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">年齢</span>
                            <span class="info-value">15歳</span>
                    </div>
                        <div class="info-item">
                            <span class="info-label">血液型</span>
                            <span class="info-value">AB型</span>
                    </div>
                        <div class="info-item">
                            <span class="info-label">身長</span>
                            <span class="info-value">155cm</span>
                </div>
                        <div class="info-item">
                            <span class="info-label">部活動</span>
                            <span class="info-value">帰宅部</span>
                </div>
                        <div class="info-item">
                            <span class="info-label">委員会</span>
                            <span class="info-value">図書委員</span>
                </div>
                        <div class="info-item">
                            <span class="info-label">趣味</span>
                            <span class="info-value">読書</span>
                </div>
                        <div class="info-item">
                            <span class="info-label">得意科目</span>
                            <span class="info-value">英語・音楽</span>
                </div>
                        <div class="info-item">
                            <span class="info-label">好きな花</span>
                            <span class="info-value">勿忘草・紫陽花</span>
            </div>
                        <div class="info-item">
                            <span class="info-label">将来の夢</span>
                            <span class="info-value">特になし</span>
        </div>
    </div>
                    </div>
                    
                <div class="student-profile-section" style="margin-left: -30px;">
                    <div class="school-note">
                        <p class="intro-text">初めまして、九条あまねだよ。皆からは「あまねちゃん」って呼ばれてるよ！<br>えっ、仲良くしてくれるの…？本当…？</p>
                </div>

                    <div class="school-note">
                        <p class="intro-text"><strong>学校生活</strong></p>
                        <p class="intro-text">うぅーん…普通の学生生活を送ってる…よ！強いて言うなら…放課後に1人で読書するのが好き、かな？<br>最近『これで完璧！友達との会話術2』を読んでるよ、読む？</p>
                    </div>
                    
                    <div class="school-note">
                        <p class="intro-text"><strong>『これで完璧！友達との会話術2』について</strong></p>
                        <p class="intro-text">毎日この本を持って学校に来てるよ！様々なシチュエーションへの対応が書かれていてとっても参考になるんだ…！<br>もちろん、1も持ってるよ！噂によると、今度3が出るみたいなの！楽しみ！</p>
                    </div>
                </div>
            </div>

            <!-- 高森のばらプロフィールコンテンツ -->
            <div id="nobara-profile" class="content-card" data-section="nobara" hidden>
                <h2 class="section-title">自己紹介ノート</h2>
                
                <!-- 学生証画像 -->
                <div class="student-id-image-container" id="nobara-student-id" onclick="cycleNobaraStudentId()">
                    <div class="student-id-views">
                        <div class="student-id-view active" id="nobara-view1">
                            <img src="assets/img/nobara_ID.png" alt="高森のばら 学生証" loading="eager" />
                        </div>
                        <div class="student-id-view" id="nobara-view2">
                            <div class="student-id-detail">
                                <div class="detail-content">
                                    <div class="detail-title">ホラー布教部</div>
                                    <div class="detail-text">
                                        夢見が丘女子高等学校には、<br>
                                        "あったりなかったりする部活"の噂がある。<br>
                                        その名も――ホラー布教部。<br>
                                        部長に会えば、昔からの友人のように感じるのに、<br>
                                        いなくなると、誰もその存在を思い出せなくなるという。
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="student-id-view" id="nobara-view3">
                            <div class="student-id-back">
                                <div class="back-content">
                                    <div class="back-title">バッドエンドも好き</div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- キャラクター情報 -->
                <div class="character-info">
                    <h3>キャラクター詳細</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">年齢</span>
                            <span class="info-value">15歳</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">血液型</span>
                            <span class="info-value">B型</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">身長</span>
                            <span class="info-value">150cm</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">部活動</span>
                            <span class="info-value">ホラー布教部</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">委員会</span>
                            <span class="info-value">美化委員</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">趣味</span>
                            <span class="info-value">映画鑑賞</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">得意科目</span>
                            <span class="info-value">国語</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">好きな花</span>
                            <span class="info-value">金木犀・鈴蘭</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">将来の夢</span>
                            <span class="info-value">世界一周旅行</span>
                        </div>
                    </div>
                </div>
                    
                <div class="student-profile-section" style="margin-left: -30px;">
                    <div class="school-note">
                        <p class="intro-text">初めまして！クラスメイトからは<strong>「のばらちゃん」</strong>と呼ばれています！よろしく～</p>
                    </div>

                    <div class="school-note">
                        <p class="intro-text"><strong>学校生活</strong></p>
                        <p class="intro-text">ホラー布教部の部長としてホラーの布教に心血を注いでいます！部員募集中！</p>
                    </div>
                    
                    <div class="school-note">
                        <p class="intro-text"><strong>ホラーへの想い</strong></p>
                        <p class="intro-text">ホラーは怖いだけじゃなく、生まれた理由や怖いと感じる理由など、様々な要因が折り重なっています！是非そんなところにも目を向けてくださいね～</p>
                    </div>
                </div>
            </div>



            <!-- 動画コンテンツ（Coming Soon版） -->

            </div>
        </section>
            </div>

    <!-- 背景キービジュアル -->
    <div class="character-image-outside">
        <img src="assets/img/Amane_key.png" alt="九条あまね" class="amane-key-visual">
        <img src="assets/img/Nobara.png" alt="高森のばら" class="nobara-key-visual">
    </div>
    
    <!-- キーワード縦書きテキスト -->
    <div class="character-keyword">
        <span class="amane-keyword">ごく普通の女子高生</span>
        <span class="nobara-keyword">不思議な転校生</span>
    </div>

    <!-- スクロールインジケーター -->
    <div class="scroll-indicator">
        <div class="scroll-progress" id="scrollProgress"></div>
    </div>

    <script>








        function openYouTube() {
                window.open('https://www.youtube.com/@AS_Chronicle', '_blank');
        }

        function openTwitter() {
                window.open('https://x.com/as_chronicle', '_blank');
        }



        // 学生証クリック機能
        let amaneCurrentView = 1;
        let nobaraCurrentView = 1;

        function cycleAmaneStudentId() {
            console.log('Amane student ID clicked, current view:', amaneCurrentView);
            
            // 現在のビューを非表示
            document.getElementById(`amane-view${amaneCurrentView}`).classList.remove('active');
            
            // 次のビューに切り替え
            amaneCurrentView = amaneCurrentView >= 3 ? 1 : amaneCurrentView + 1;
            document.getElementById(`amane-view${amaneCurrentView}`).classList.add('active');
            
            console.log('Amane switched to view:', amaneCurrentView);
        }

        function cycleNobaraStudentId() {
            console.log('Nobara student ID clicked, current view:', nobaraCurrentView);
            
            // 現在のビューを非表示
            document.getElementById(`nobara-view${nobaraCurrentView}`).classList.remove('active');
            
            // 次のビューに切り替え
            nobaraCurrentView = nobaraCurrentView >= 3 ? 1 : nobaraCurrentView + 1;
            document.getElementById(`nobara-view${nobaraCurrentView}`).classList.add('active');
            
            console.log('Nobara switched to view:', nobaraCurrentView);
        }



        // スクロール進行状況の更新
        function updateScrollProgress() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrollProgress = Math.max(0, Math.min(100, (scrollTop / scrollHeight) * 100));
            
            const progressElement = document.getElementById('scrollProgress');
            
            if (progressElement) {
                // 進行バーの高さを設定（上から下に伸びる）
                progressElement.style.height = scrollProgress + '%';
            }
        }

        // スクロールイベントリスナー
        window.addEventListener('scroll', updateScrollProgress);
        window.addEventListener('resize', updateScrollProgress);

        // 初期状態：あまねを表示
        const MAP = { amane: 'profile', nobara: 'nobara-profile' };
        function activate(target){
          // 本文カードの表示切替
          document.querySelectorAll('.content-card').forEach(c => c.classList.remove('active'));
          document.getElementById(MAP[target]).classList.add('active');

          // ボディのモード切替（KVやコピーの表示制御に利用）
          document.body.classList.remove('amane-mode','nobara-mode');
          document.body.classList.add(`${target}-mode`);

          // タブのアクティブ表示
          document.querySelectorAll('[data-target]').forEach(b => {
            b.classList.toggle('active', b.dataset.target === target);
          });
        }

        // DOMが読み込まれた後に初期化
        document.addEventListener('DOMContentLoaded', function() {
            // 起動時
            activate('amane');

            // 顔アイコン＆縦タブに同じイベントを付与
            document.querySelectorAll('[data-target]').forEach(btn=>{
              btn.addEventListener('click', ()=> activate(btn.dataset.target));
            });

            // 初期スクロール進行状況を設定
            updateScrollProgress();
        });
    </script>

    <!-- セキュリティ機能の読み込み（Studio埋め込み互換） -->
    <script src="assets/js/security.js"></script>
    <script src="assets/js/security-monitor.js"></script>

    <!-- <=1024px 用：追従丸アイコンナビ -->
    <nav class="mobile-nav" aria-label="キャラ切替">
      <button class="fab" data-target="amane">
        <img class="fab-face amane" src="assets/img/Amane_icon.png" alt="九条あまね">
      </button>
      <button class="fab" data-target="nobara">
        <img class="fab-face nobara" src="assets/img/nobara_icon.png" alt="高森のばら">
      </button>
      
    </nav>

    <!-- 学生証モーダル機能 - スマホサイズ時のみ -->
    <script>
    (()=> {
      const mq = window.matchMedia('(max-width:1024px)');

      // モーダル生成（1回だけ）
      const modal = document.createElement('div');
      modal.className = 'id-modal';
      modal.innerHTML = `
        <div class="id-modal__backdrop" data-close></div>
        <div class="id-modal__inner" role="dialog" aria-modal="true" aria-label="学生証拡大表示">
          <button class="id-modal__close" aria-label="閉じる" data-close>×</button>
          <div class="id-modal__mask">
            <div class="id-modal__stage"></div>
          </div>
        </div>`;
      document.body.appendChild(modal);
      const stage = modal.querySelector('.id-modal__stage');

      // 追加：シールド生成（スマホ時のみ）
      function installShields(){
        if (!mq.matches) return;
        // 学生証の画像コンテナすべてにシールドを被せる
        document.querySelectorAll('.student-id-image-container').forEach(box=>{
          if (box.querySelector('.id-zoom-shield')) return; // 二重作成防止
          const b = document.createElement('button');
          b.type = 'button';
          b.className = 'id-zoom-shield';
          b.setAttribute('aria-label','学生証を拡大表示');
          // 既存切替を完全阻止して拡大のみ
          b.addEventListener('click', (e)=>{
            e.preventDefault();
            e.stopImmediatePropagation();
            e.stopPropagation();
            openZoom(box);
          }, {passive:false});
          box.appendChild(b);
        });
      }
      function removeShields(){
        document.querySelectorAll('.id-zoom-shield').forEach(b=>b.remove());
      }

      // Completely replace existing fitModalToViewport
      function fitModalToViewport(ratio){
        const inner = modal.querySelector('.id-modal__inner');
        const vv = window.visualViewport;

        // Current viewport size
        const vw = Math.min(window.innerWidth,  vv?.width  || window.innerWidth);
        const vh = Math.min(window.innerHeight, vv?.height || window.innerHeight);

        // Modal top/bottom padding (get resolved values including env(safe-area-*))
        const mcs = getComputedStyle(modal);
        const padTop    = parseFloat(mcs.paddingTop)    || 0;
        const padBottom = parseFloat(mcs.paddingBottom) || 0;

        // Margin for shadow "bleed" + close button (adjust as needed)
        const SHADOW_BLEED = 20;   // For visual clipping due to shadow/border-radius
        const CLOSE_SAFE   = 36;   // For overlap with the 'x' close button

        // Actual usable height
        const availH = Math.max(0, vh - padTop - padBottom - SHADOW_BLEED - CLOSE_SAFE);

        // Max width (96vw, max 720px horizontally)
        const maxW = Math.min(vw * 0.96, 720);

        // Fit by prioritizing height constraint
        let width  = Math.min(maxW, availH * ratio);
        let height = width / ratio;

        // Final clip check (for floating point errors)
        if (height > availH){ height = availH; width = height * ratio; }

        inner.style.width  = width  + 'px';
        inner.style.height = height + 'px';
      }

      function openZoom(fromContainer){
        // 学生証ビュー（.student-id-views）をクローンしてモーダルに差し込む
        const base = fromContainer.closest('.content-card') || document;
        const views = base.querySelector('.student-id-views');
        stage.innerHTML = '';

        if (views){
          const clone = views.cloneNode(true);
          // 最初は先頭だけ表示（activeを強制）
          const list = clone.querySelectorAll('.student-id-view');
          list.forEach((v,i)=>{
            v.classList.toggle('active', i===0);
            v.style.display = i===0 ? 'block' : 'none';
          });
          stage.appendChild(clone);
        } else {
          // 万一ビューが無い場合は画像をそのまま拡大
          const img = fromContainer.querySelector('.student-id')?.cloneNode(true);
          if (img) stage.appendChild(img);
        }

        // Actual aspect ratio if image exists, otherwise 3:2
        let ar = 1.5;
        const probe = stage.querySelector('img, canvas, svg');
        if (probe && probe.naturalWidth && probe.naturalHeight){
          ar = probe.naturalWidth / probe.naturalHeight;
        }

        // Ensure calculation after initial render (wait for layout to settle)
        const doFit = ()=>fitModalToViewport(ar);
        requestAnimationFrame(doFit);

        const onRz = ()=>fitModalToViewport(ar);
        window.addEventListener('resize', onRz, {passive:true});
        window.visualViewport?.addEventListener('resize', onRz, {passive:true});
        modal.addEventListener('transitionend', function _cleanup(){
          if (!modal.classList.contains('open')){
            window.removeEventListener('resize', onRz);
            window.visualViewport?.removeEventListener('resize', onRz);
            modal.removeEventListener('transitionend', _cleanup);
          }
        });

        document.documentElement.classList.add('no-scroll');
        modal.classList.add('open');
      }

      function toggleInside(){
        const list = stage.querySelectorAll('.student-id-view');
        if (!list.length) return;
        const arr = Array.from(list);
        const cur = arr.findIndex(v=>v.classList.contains('active'));
        const next = (cur + 1) % arr.length;
        arr.forEach((v,i)=>{
          v.classList.toggle('active', i===next);
          v.style.display = i===next ? 'block' : 'none';
        });
      }

      function closeZoom(){
        modal.classList.remove('open');
        document.documentElement.classList.remove('no-scroll');
        stage.innerHTML = '';
      }

      // モーダルの閉じる操作
      modal.addEventListener('click', (e)=>{
        if (e.target.closest('[data-close]')) closeZoom();
      });
      document.addEventListener('keydown', (e)=>{
        if (e.key === 'Escape' && modal.classList.contains('open')) closeZoom();
      });

      // モバイル時だけバインド
      function bindMobile(){
        if (!mq.matches) return;
        // 学生証画像タップで拡大（画像でもコンテナでもOKにしておく）
        document.querySelectorAll('.student-id-image-container, .student-id-image-container .student-id')
          .forEach(el=>{
            el.style.cursor = 'zoom-in';
            el.addEventListener('click', onOpen, { passive:true });
          });
        // モーダル内どこでもタップでビュー切替（✕と背景は除外）
        stage.addEventListener('click', onToggle, { passive:true });
      }
      function unbindMobile(){
        // 既存のイベントは最低限で付けているため明示解除は省略（必要ならWeakRef管理でremove）
      }
      function onOpen(ev){
        ev.preventDefault?.();
        const container = ev.currentTarget.closest('.student-id-image-container') || ev.currentTarget;
        openZoom(container);
      }
      function onToggle(ev){
        // 内部のカードを順送り（閉じるボタンや背景は対象外）
        if (ev.target.closest('[data-close]')) return;
        toggleInside();
      }

      mq.addEventListener?.('change', e=>{ e.matches ? installShields() : removeShields(); });
      installShields();
      bindMobile();
    })();
    </script>
</body>
</html> 