<!doctype html><meta charset="utf-8"><meta name="viewport" content="width=device-width">
<title>Share</title>
<div style="max-width:520px;margin:8vh auto;padding:24px;background:#fff;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.08);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif">
  <h2>共有の準備ができました</h2>
  <p>下のボタンを押すと、Xなどのアプリを選べます。</p>
  <button id="go" style="padding:14px 20px;border:0;border-radius:12px;background:#111;color:#fff;font-weight:700;font-size:16px;width:100%">共有を開く</button>
  <p id="err" style="display:none;color:#c00;margin-top:12px"></p>
</div>
<script>
const p=new URLSearchParams(location.search);
const text=p.get('text')||''; const img=p.get('img');
async function doShare(){
  let files=[];
  if(img){ try{
    const r=await fetch(img,{cache:'no-store'}); const b=await r.blob();
    files=[new File([b],'student-id.jpg',{type:b.type||'image/jpeg'})];
  }catch{} }
  try{
    if(navigator.share){
      await navigator.share(files.length?{text,files}:{text}); window.close(); return;
    }
  }catch(e){ document.getElementById('err').textContent='共有をキャンセル/失敗しました'; document.getElementById('err').style.display='block'; return; }
  location.replace('https://x.com/intent/post?text='+encodeURIComponent(text));
}
document.getElementById('go').onclick=doShare;
setTimeout(()=>doShare().catch(()=>{}),100);
</script>
