<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ”¾èª²å¾Œã‚¯ãƒ­ãƒ‹ã‚¯ãƒ« â€• è¨ºæ–­ã‚²ãƒ¼ãƒ </title>
  
  <!-- æœ€é€ŸStudioç’°å¢ƒæ¤œå‡ºãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ -->
  <script>
    if (window.location.hostname.includes('studio') || 
        (document.referrer && document.referrer.includes('studio')) ||
        window.location.href.includes('studio') ||
        /studio/i.test(window.location.toString())) {
      console.log('ğŸš€ Studioç’°å¢ƒæ¤œå‡º - å³åº§ã«ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ');
      window.location.replace('quiz.html');
    }
  </script>
  
  <link rel="icon" type="image/png" href="assets/img/crest.png">
  
  <!-- æœ€å„ªå…ˆTypeSquareå®Œå…¨é®æ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script>
    (function() {
      'use strict';
      
      // Studioç’°å¢ƒã®å³åº§æ¤œå‡ºã¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      const isStudio = window.location.hostname.includes('studio') || 
                       document.referrer.includes('studio') ||
                       window.location.href.includes('studio');
      
      if (isStudio) {
        console.log('ğŸ¬ Studioç’°å¢ƒã‚’æ¤œå‡ºã—ã¾ã—ãŸã€‚ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚');
        window.location.href = 'quiz.html';
        return;
      }
      
      // å³åº§ã«TypeSquareé–¢é€£ã‚’ç„¡åŠ¹åŒ–
      console.log('ğŸ›¡ï¸ TypeSquareé®æ–­ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•');
      
      // TypeSquareã‚¨ãƒ©ãƒ¼æ¤œå‡ºã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
      let typeSquareErrorCount = 0;
      
      // ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ã‚’ç„¡æ¡ä»¶ã§æŠ‘åˆ¶
      window.addEventListener('error', function(e) {
        if (e.filename && (e.filename.includes('typesquare') || e.filename.includes('ts?'))) {
          typeSquareErrorCount++;
          console.warn('ğŸš« TypeSquareã‚¨ãƒ©ãƒ¼ã‚’ç„¡åŠ¹åŒ–:', e.message, '(ã‚«ã‚¦ãƒ³ãƒˆ:', typeSquareErrorCount, ')');
          
          // 3å›ä»¥ä¸ŠTypeSquareã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
          if (typeSquareErrorCount >= 3) {
            console.warn('ğŸš¨ TypeSquareã‚¨ãƒ©ãƒ¼ãŒå¤šç™ºã—ã¦ã„ã¾ã™ã€‚ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚');
            setTimeout(() => {
              window.location.href = 'quiz.html';
            }, 1000);
          }
          
          e.stopImmediatePropagation();
          e.preventDefault();
          return false;
        }
      }, true);
      
      window.addEventListener('unhandledrejection', function(e) {
        if (e.reason && e.reason.toString().includes('typesquare')) {
          typeSquareErrorCount++;
          console.warn('ğŸš« TypeSquare Promise rejection ã‚’ç„¡åŠ¹åŒ– (ã‚«ã‚¦ãƒ³ãƒˆ:', typeSquareErrorCount, ')');
          
          // 3å›ä»¥ä¸Šã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
          if (typeSquareErrorCount >= 3) {
            console.warn('ğŸš¨ TypeSquareã‚¨ãƒ©ãƒ¼ãŒå¤šç™ºã—ã¦ã„ã¾ã™ã€‚ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚');
            setTimeout(() => {
              window.location.href = 'quiz.html';
            }, 1000);
          }
          
          e.stopImmediatePropagation();
          e.preventDefault();
          return false;
        }
      }, true);
      
      // TypeSquareé–¢é€£ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’å³åº§ã«ç„¡åŠ¹åŒ–
      const tsVariables = ['ts', 'TypeSquare', 'Typekit', 'WebFont', 'Ts', 'TS'];
      tsVariables.forEach(varName => {
        Object.defineProperty(window, varName, {
          get: function() { return null; },
          set: function() { console.warn('ğŸš« TypeSquareå¤‰æ•°è¨­å®šã‚’é˜»æ­¢:', varName); },
          configurable: false,
          enumerable: false
        });
      });
      
      // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã‚‚æŠ‘åˆ¶
      const originalConsoleError = console.error;
      console.error = function(...args) {
        const message = args.join(' ');
        if (message.includes('typesquare') || message.includes('ERR_BLOCKED_BY_CLIENT')) {
          console.warn('ğŸ”‡ TypeSquareã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’æŠ‘åˆ¶:', message);
          return;
        }
        return originalConsoleError.apply(console, args);
      };
      
      // 5ç§’å¾Œã«é¸æŠè‚¢ãŒã‚¯ãƒªãƒƒã‚¯ã§ããªã„å ´åˆã€ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      setTimeout(() => {
        const questionContainer = document.getElementById('questionContainer');
        const answerOptions = document.querySelectorAll('.answer-option');
        
        if (questionContainer && answerOptions.length === 0) {
          console.warn('ğŸš¨ è³ªå•ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚');
          window.location.href = 'quiz.html';
        } else if (typeof selectAnswer !== 'function') {
          console.warn('ğŸš¨ selectAnsweré–¢æ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚');
          window.location.href = 'quiz.html';
        }
      }, 5000);
      
      console.log('âœ… TypeSquareé®æ–­ã‚·ã‚¹ãƒ†ãƒ å®Œäº†');
    })();
  </script>
  
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">
  <!-- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š -->
  <style>
    /* ã‚¢ãƒ‰ãƒ–ãƒ­ãƒƒã‚«ãƒ¼å¯¾ç­–: å®Œå…¨ãªãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚©ãƒ³ãƒˆã‚¹ã‚¿ãƒƒã‚¯ */
    body, html, * {
      font-family: "Noto Sans JP", "Yu Gothic UI", "Yu Gothic", "Meiryo UI", "Meiryo", "MS PGothic", "Hiragino Sans", "Hiragino Kaku Gothic ProN", "BIZ UDPGothic", "BIZ UDGothic", sans-serif !important;
    }
    
    /* TypeSquareã®CSSèª­ã¿è¾¼ã¿ã‚’æ¤œå‡ºã—ã¦ç„¡åŠ¹åŒ– */
    link[href*="typesquare"], 
    script[src*="typesquare"] {
      display: none !important;
    }
    
    /* ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿å¤±æ•—æ™‚ã®ä¿è­· */
    @font-face {
      font-family: 'Fallback-Gothic';
      src: local('Yu Gothic UI'), local('Meiryo UI'), local('MS PGothic');
      font-display: swap;
    }

    /* Font Awesome ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾ç­– */
    .fas, .fab {
      font-family: "Font Awesome 6 Free", "Font Awesome 6 Brands", sans-serif;
    }

    /* ã‚¢ã‚¤ã‚³ãƒ³ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ */
    .fas::before, .fab::before {
      font-family: "Font Awesome 6 Free", "Font Awesome 6 Brands", sans-serif;
    }

    /* ç‰¹å®šã®ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã®ä»£æ›¿è¡¨ç¤º */
    .fa-id-card::before {
      content: "ğŸ“‹";
      font-family: sans-serif;
    }
    
    .fa-redo::before {
      content: "ğŸ”„";
      font-family: sans-serif;
    }
    
    .fa-arrow-left::before {
      content: "â†";
      font-family: sans-serif;
    }

    /* Font AwesomeãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚ŒãŸå ´åˆã¯å…ƒã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½¿ç”¨ */
    @supports (font-family: "Font Awesome 6 Free") {
      .fa-id-card::before {
        content: "\f2c2";
        font-family: "Font Awesome 6 Free";
      }
      
      .fa-redo::before {
        content: "\f01e";
        font-family: "Font Awesome 6 Free";
      }
      
      .fa-arrow-left::before {
        content: "\f060";
        font-family: "Font Awesome 6 Free";
      }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <!-- Font Awesome ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="none" onload="if(media!='all')media='all'">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.1/css/all.css" media="none" onload="if(media!='all')media='all'">
  <noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.1/css/all.css">
  </noscript>
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    /* è¨ºæ–­ã‚²ãƒ¼ãƒ å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .diagnosis-container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
    }

    .question-card {
      background: rgba(248, 246, 240, 0.9);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transform: perspective(1000px) rotateY(-10deg);
      transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .question-card.active {
      transform: perspective(1000px) rotateY(0deg);
    }

    .question-card.answered {
      transform: perspective(1000px) rotateY(10deg);
      opacity: 0.7;
    }

    .question-card.fade-out {
      opacity: 0;
      transform: translateX(-20px);
      transition: all 0.4s ease-in;
    }

    .question-card.fade-in {
      opacity: 1;
      transform: translateX(0);
      transition: all 0.4s ease-out;
    }

    .question-title {
      font-size: 1.5rem;
      font-weight: 650;
      color: #666;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .question-text {
      font-size: 1.2rem;
      color: #444;
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    .answer-options {
      display: grid;
      gap: 1rem;
    }

    .answer-option {
      padding: 1rem 1.5rem;
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      color: #666;
      font-weight: 500;
    }

    .answer-option:hover {
      background: #f8f9fa;
      border-color: #dda0dd;
      color: #444;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(221, 160, 221, 0.2);
    }

    .question-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 2rem;
      gap: 1rem;
    }

    .back-btn {
      background: #a8a8a8;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 500;
    }

    .back-btn:hover {
      background: #969696;
      transform: translateY(-1px);
    }

    .back-btn:disabled {
      background: #e0e0e0;
      color: #999;
      cursor: not-allowed;
      transform: none;
    }

    .question-number {
      color: #666;
      font-weight: 500;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      margin-bottom: 2rem;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #dda0dd, #b0c4de);
      border-radius: 4px;
      transition: width 0.6s cubic-bezier(0.25, 1, 0.5, 1);
      width: 0%;
    }

    .result-container {
      text-align: center;
      display: none;
    }

    .result-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 249, 250, 0.9));
      border-radius: 16px;
      padding: 3rem 2.5rem;
      margin-bottom: 2rem;
      box-shadow: 
        0 8px 32px rgba(221, 160, 221, 0.15),
        0 4px 16px rgba(0, 0, 0, 0.08);
      border: 2px solid rgba(221, 160, 221, 0.2);
      max-width: 650px;
      margin-left: auto;
      margin-right: auto;
      position: relative;
      overflow: hidden;
    }

    .result-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #dda0dd, #b0c4de, #98d7a5);
    }

    .result-title {
      font-size: 2.2rem;
      font-weight: 700;
      background: linear-gradient(135deg, #dda0dd, #b0c4de);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.75rem;
      text-align: center;
      text-shadow: 0 2px 4px rgba(221, 160, 221, 0.3);
      letter-spacing: -0.02em;
    }

    .result-subtitle {
      font-size: 1.1rem;
      color: #787878;
      margin-bottom: 2.5rem;
      font-weight: 500;
      text-align: center;
      opacity: 0.9;
    }

    .result-details {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 248, 255, 0.8));
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2.5rem;
      border: 2px solid rgba(221, 160, 221, 0.1);
      box-shadow: 
        0 4px 15px rgba(221, 160, 221, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }

    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding: 0.75rem 0;
      background: none;
      border: none;
      border-bottom: 1px solid rgba(221, 160, 221, 0.2);
      border-radius: 0;
      transition: all 0.3s ease;
      box-shadow: none;
    }

    .result-item:hover {
      border-bottom-color: rgba(221, 160, 221, 0.4);
    }

    .result-item:last-child {
      margin-bottom: 0;
      border-bottom: none;
    }

    .result-label {
      color: #787878;
      font-weight: 600;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .result-value {
      color: #4a4a4a;
      font-weight: 700;
      font-size: 1rem;
      text-align: right;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .preview-msg {
      font-size: 1.4rem;
      color: #444;
      font-weight: 600;
      margin-bottom: 2.5rem;
      padding: 1.5rem 2rem;
      background: linear-gradient(135deg, rgba(248, 249, 250, 0.9), rgba(255, 255, 255, 0.8));
      border-radius: 12px;
      border-left: 5px solid #dda0dd;
      box-shadow: 
        0 4px 15px rgba(221, 160, 221, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
      line-height: 1.6;
      backdrop-filter: blur(5px);
      transition: all 0.3s ease;
    }

    .preview-msg:hover {
      transform: translateY(-1px);
      box-shadow: 
        0 6px 20px rgba(221, 160, 221, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.9);
    }

    .narrative-text {
      font-size: 1.1rem;
      color: #555;
      line-height: 1.8;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(248, 246, 240, 0.8);
      border-radius: 12px;
      border: 2px solid #e0e0e0;
      white-space: pre-line;
      font-family: 'Noto Sans JP', sans-serif;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .episode-msg {
      font-size: 1.1rem;
      color: #555;
      line-height: 1.7;
      margin-bottom: 2.5rem;
      padding: 1.5rem 2rem;
      background: linear-gradient(135deg, rgba(255, 248, 220, 0.9), rgba(255, 250, 235, 0.8));
      border-radius: 12px;
      border: 2px solid rgba(240, 208, 160, 0.3);
      border-left: 5px solid #f0d0a0;
      font-family: 'Noto Sans JP', sans-serif;
      box-shadow: 
        0 4px 12px rgba(240, 208, 160, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.6);
      text-align: center;
      font-style: italic;
      font-weight: 500;
      backdrop-filter: blur(5px);
      transition: all 0.3s ease;
    }

    .episode-msg:hover {
      transform: translateY(-1px);
      box-shadow: 
        0 6px 18px rgba(240, 208, 160, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.7);
    }

    .unified-result-card {
      background: rgba(248, 249, 250, 0.5);
      border-radius: 8px;
      padding: 1.5rem;
      border: 1px solid rgba(221, 160, 221, 0.15);
      box-shadow: none;
      backdrop-filter: none;
    }

    .unified-result-card .preview-msg {
      margin-bottom: 1.5rem;
      background: none;
      border: none;
      border-left: 4px solid #dda0dd;
      border-radius: 0;
      box-shadow: none;
      padding: 1rem 1.5rem 1rem 2rem;
      font-size: 1.1rem;
      color: #4a4a4a;
      font-weight: 600;
      line-height: 1.6;
      text-align: center;
      letter-spacing: 0.01em;
    }

    .unified-result-card .result-details {
      margin-bottom: 1.25rem;
      background: none;
      border: none;
      border-radius: 0;
      box-shadow: none;
      padding: 0;
    }

    .episode-section {
      margin-top: 1.5rem;
      padding: 1.25rem 0 0;
      background: none;
      border: none;
      border-top: 2px solid rgba(152, 215, 165, 0.3);
      border-radius: 0;
      box-shadow: none;
      position: relative;
    }

    .episode-title {
      font-size: 1rem;
      font-weight: 700;
      color: #4a4a4a;
      margin-bottom: 0.75rem;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      text-shadow: none;
    }

    .unified-result-card .episode-msg {
      background: none;
      border: none;
      border-radius: 0;
      box-shadow: none;
      padding: 0;
      margin: 0;
      font-style: italic;
      font-weight: 500;
      font-size: 0.95rem;
      color: #787878;
      line-height: 1.5;
      text-align: center;
      letter-spacing: 0.01em;
    }

    .to-generator-btn {
      background: linear-gradient(135deg, #dda0dd, #b0c4de);
      color: white;
      border: 2px solid rgba(221, 160, 221, 0.3);
      padding: 1rem 2rem;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      box-shadow: 0 4px 12px rgba(221, 160, 221, 0.3);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      letter-spacing: 0.02em;
    }

    .to-generator-btn:hover {
      background: linear-gradient(135deg, #e0a8e0, #b8ccde);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(221, 160, 221, 0.4);
      border-color: rgba(221, 160, 221, 0.5);
    }

    .restart-btn {
      background: linear-gradient(135deg, #98d7a5, #b0c4de);
      color: white;
      border: 2px solid rgba(152, 215, 165, 0.3);
      padding: 1rem 2rem;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      box-shadow: 0 4px 12px rgba(152, 215, 165, 0.3);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      letter-spacing: 0.02em;
    }

    .restart-btn:hover {
      background: linear-gradient(135deg, #a0daa8, #b8ccde);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(152, 215, 165, 0.4);
      border-color: rgba(152, 215, 165, 0.5);
    }

    .button-container {
      display: flex;
      gap: 1.5rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 2rem;
      padding-top: 1.25rem;
      border-top: 2px solid rgba(221, 160, 221, 0.1);
    }



    @media (max-width: 768px) {
      .diagnosis-container {
        padding: 1rem;
        margin: 1rem auto;
      }

      .question-card {
        padding: 1.5rem;
      }

      .question-title {
        font-size: 1.2rem;
      }

      .question-text {
        font-size: 1rem;
      }

      .result-card {
        padding: 2rem 1.5rem;
        margin: 1rem;
      }

      .result-title {
        font-size: 1.8rem;
      }

      .result-subtitle {
        font-size: 1rem;
      }

      .unified-result-card {
        padding: 1.25rem;
      }

      .unified-result-card .preview-msg {
        font-size: 1rem;
        padding: 0.875rem 1.25rem 0.875rem 1.5rem;
        margin-bottom: 1.25rem;
      }

      .result-item {
        padding: 0.625rem 0;
        margin-bottom: 0.875rem;
      }

      .result-label {
        font-size: 0.9rem;
      }

      .result-value {
        font-size: 0.95rem;
      }

      .episode-section {
        padding: 1rem 0 0;
        margin-top: 1.25rem;
      }

      .episode-title {
        font-size: 0.95rem;
        margin-bottom: 0.625rem;
      }

      .unified-result-card .episode-msg {
        font-size: 0.9rem;
        padding: 0;
      }

      .button-container {
        margin-top: 1.75rem;
        gap: 1rem;
        padding-top: 1rem;
      }

      .to-generator-btn,
      .restart-btn {
        width: 100%;
        padding: 0.875rem 1.5rem;
        font-size: 1rem;
        margin-bottom: 0.5rem;
      }

      .question-controls {
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
      }

      .back-btn {
        width: 100%;
        justify-content: center;
        padding: 1rem;
      }

      .question-number {
        font-size: 0.9rem;
      }

      .narrative-text {
        font-size: 1rem;
        padding: 1rem;
        line-height: 1.6;
      }

      .episode-msg {
        font-size: 0.9rem;
        padding: 0.8rem 1rem;
        line-height: 1.5;
      }

      .unified-result-card {
        padding: 1rem;
      }

      .episode-title {
        font-size: 0.95rem;
      }

      .unified-result-card .preview-msg {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«å‰Šé™¤æ¸ˆã¿ -->
  </header>

  <div class="diagnosis-container">
    <!-- é€²æ—ãƒãƒ¼ -->
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <!-- è³ªå•è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div id="questionContainer">
      <!-- è³ªå•ãŒã“ã“ã«å‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
    </div>

    <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div class="result-container" id="resultContainer">
      <div class="result-card">
        <div class="result-title">ğŸ“ è¨ºæ–­çµæœç™ºè¡¨ï¼</div>
        <div class="result-subtitle">ã‚ãªãŸã®å­¦æ ¡ç”Ÿæ´»ã¯...</div>
        
        <div class="unified-result-card">
          <div class="preview-msg" id="previewMsg">
            <!-- ãƒ©ãƒ³ãƒ€ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
          </div>

          <div class="result-details">
            <div class="result-item">
              <span class="result-label">ğŸ“š å­¦ç§‘/ã‚³ãƒ¼ã‚¹</span>
              <span class="result-value" id="resultCourse">-</span>
            </div>
            <div class="result-item">
              <span class="result-label">ğŸ­ éƒ¨æ´»å‹•</span>
              <span class="result-value" id="resultClub">-</span>
            </div>
          </div>

          <div class="episode-section">
            <div class="episode-title">ğŸƒ ã²ã¨ãã¡ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰</div>
            <div class="episode-msg" id="episodeMsg">
              <!-- å€‹æ€§ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
          </div>
        </div>

        <div class="button-container">
          <button class="to-generator-btn" id="toGeneratorBtn">
            <i class="fas fa-id-card"></i>
            å­¦ç”Ÿè¨¼ã‚’ä½œæˆã™ã‚‹
          </button>
          <button class="restart-btn" id="restartBtn">
            <i class="fas fa-redo"></i>
            è¨ºæ–­ã‚’ã‚„ã‚Šç›´ã™
          </button>
        </div>
      </div>
    </div>
  </div>



  <footer>
    <p>&copy; 2025 æ”¾èª²å¾Œã‚¯ãƒ­ãƒ‹ã‚¯ãƒ« è¨ºæ–­ã‚²ãƒ¼ãƒ </p>
  </footer>

  <script>
    // ã‚·ãƒ³ãƒ—ãƒ«ãªåˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸš€ è¨ºæ–­ã‚²ãƒ¼ãƒ é–‹å§‹');
      
      // è³ªå•ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦10å•é¸æŠ
      for (let i = questionPool.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [questionPool[i], questionPool[j]] = [questionPool[j], questionPool[i]];
      }
      
      // æœ€åˆã®è³ªå•ã‚’è¡¨ç¤º
      showQuestion(0);
    });

    // TypeSquare ãƒ•ã‚©ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ã®å®Œå…¨ç„¡è¦–
    window.addEventListener('error', function(e) {
      if (e.message && (
        e.message.includes('typesquare') || 
        e.message.includes('ERR_BLOCKED_BY_CLIENT') ||
        e.message.includes('net::') ||
        e.message.includes('Failed to fetch')
      )) {
        console.warn('ğŸ”‡ ã‚¨ãƒ©ãƒ¼ã‚’ç„¡è¦–:', e.message);
        e.preventDefault();
        return true;
      }
    });

    window.addEventListener('unhandledrejection', function(e) {
      if (e.reason && e.reason.toString().includes('typesquare')) {
        console.warn('ğŸ”‡ Promise rejection ã‚’ç„¡è¦–');
        e.preventDefault();
      }
    });

    // è³ªå•ãƒ—ãƒ¼ãƒ«ï¼ˆå…¨22å•ï¼ãƒ©ãƒ³ãƒ€ãƒ 10å•å‡ºé¡Œï¼‰
    const questionPool = [
      {
        q: 'æœã®æ”¯åº¦ã€ã©ã‚“ãªæ„Ÿã˜ï¼Ÿ',
        choices: [
          { text:'ãã‚Šãã‚Šã¾ã§å¯ã¦ã‚‹', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:4 } },
          { text:'æ”¯åº¦ã¯å‰æ—¥ã«å®Œç’§', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:1 } },
          { text:'ãªã‚“ã¨ãªãã§OK', scores:{ course:null, club:'ç¾è¡“', vibe:3 } },
          { text:'æ¯æœãƒ‰ã‚¿ãƒã‚¿ã—ã¦ã‚‹', scores:{ course:null, club:'ãƒ€ãƒ³ã‚¹éƒ¨', vibe:5 } }
        ]
      },
      {
        q: 'æˆæ¥­ä¸­ã«ã‚ˆãã‚ã‚‹ã“ã¨ã¯ï¼Ÿ',
        choices: [
          { text:'ã¤ã„è½æ›¸ãã—ã¦ã—ã¾ã†', scores:{ course:'ç¾è¡“ã‚³ãƒ¼ã‚¹', club:null, vibe:3 } },
          { text:'ãƒãƒ¼ãƒˆã‚’ãã‚Œã„ã«ã¾ã¨ã‚ã‚‹', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:1 } },
          { text:'å¤¢ã®ä¸­', scores:{ course:null, club:'å›³æ›¸', vibe:2 } },
          { text:'å‹é”ã«ã“ã£ãã‚Šãƒ¡ãƒ¢æ¸¡ã™', scores:{ course:null, club:'æ–‡èŠ¸', vibe:4 } }
        ]
      },
      {
        q: 'ãŠæ˜¼ä¼‘ã¿ã®éã”ã—æ–¹ã¯ï¼Ÿ',
        choices: [
          { text:'å‹é”ã¨ãƒ¯ã‚¤ãƒ¯ã‚¤ã”é£¯', scores:{ course:null, club:'æ¼”åŠ‡éƒ¨', vibe:4 } },
          { text:'å›³æ›¸å®¤ã§ã®ã‚“ã³ã‚Šèª­æ›¸', scores:{ course:null, club:'å›³æ›¸', vibe:2 } },
          { text:'æ ¡åº­ã§éŠã¶', scores:{ course:null, club:'é™¸ä¸Šéƒ¨', vibe:3 } },
          { text:'è³¼è²·ãƒ€ãƒƒã‚·ãƒ¥', scores:{ course:null, club:'ãƒã‚¹ã‚±ãƒƒãƒˆãƒœãƒ¼ãƒ«éƒ¨', vibe:5 } }
        ]
      },
      {
        q: 'ä½“è‚²ã®æ™‚é–“ã¨ã„ãˆã°ï¼Ÿ',
        choices: [
          { text:'å…¨åŠ›ã§å‹ã¡ã«ã„ãï¼', scores:{ course:null, club:'ãƒ†ãƒ‹ã‚¹éƒ¨', vibe:2 } },
          { text:'ã¾ã‚ã¾ã‚æ¥½ã—ã‚€æ´¾', scores:{ course:null, club:'ãƒãƒ¬ãƒ¼ãƒœãƒ¼ãƒ«éƒ¨', vibe:3 } },
          { text:'è¦‹å­¦ã—ãŸã„â€¦â€¦', scores:{ course:null, club:'æ–‡èŠ¸', vibe:1 } },
          { text:'ä½“è‚²ç¥­ã ã‘æœ¬æ°—å‡ºã™', scores:{ course:null, club:'ãƒ€ãƒ³ã‚¹éƒ¨', vibe:4 } }
        ]
      },
      {
        q: 'æ”¾èª²å¾Œã®äºˆå®šã¯ï¼Ÿ',
        choices: [
          { text:'éƒ¨æ´»ã«å…¨åŠ›ï¼', scores:{ course:null, club:'å¹å¥æ¥½éƒ¨', vibe:2 } },
          { text:'å‹é”ã¨å¯„ã‚Šé“', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:4 } },
          { text:'å³å¸°å®…', scores:{ course:null, club:'å¸°å®…', vibe:3 } },
          { text:'å­¦æ ¡ã«æ®‹ã£ã¦è‡ªä¸»ç·´ã‚„è‡ªç¿’', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:1 } }
        ]
      },
      {
        q: 'ãƒ†ã‚¹ãƒˆæœŸé–“ä¸­ã€ã‚ãªãŸã¯â€¦ï¼Ÿ',
        choices: [
          { text:'è¨ˆç”»çš„ã«ã‚³ãƒ„ã‚³ãƒ„', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:1 } },
          { text:'ä¸€å¤œæ¼¬ã‘', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:5 } },
          { text:'å‹‰å¼·ä¼šã‚’é–‹å‚¬', scores:{ course:null, club:'æ¼”åŠ‡éƒ¨', vibe:3 } },
          { text:'ãƒãƒªã¨å‹¢ã„', scores:{ course:null, club:'ãƒ€ãƒ³ã‚¹éƒ¨', vibe:4 } }
        ]
      },
      {
        q: 'æœç™»æ ¡ã—ãŸæ™‚ã«ã¾ãšæ€ã†ã“ã¨ã¯ï¼Ÿ',
        choices: [
          { text:'ä»Šæ—¥ã®äºˆå®šãƒã‚§ãƒƒã‚¯', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:1 } },
          { text:'çœ ã™ãã‚‹', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:4 } },
          { text:'å‹é”ã¨è©±ã—ãŸã„', scores:{ course:null, club:'æ¼”åŠ‡éƒ¨', vibe:3 } },
          { text:'å¸°ã‚ŠãŸã„', scores:{ course:null, club:'å¸°å®…', vibe:5 } }
        ]
      },
      {
        q: 'æ–‡åŒ–ç¥­ã§ã‚„ã£ã¦ã¿ãŸã„ã“ã¨ã¯ï¼Ÿ',
        choices: [
          { text:'æ¼”åŠ‡ã‚„ãƒ€ãƒ³ã‚¹ã®ã‚¹ãƒ†ãƒ¼ã‚¸', scores:{ course:null, club:'æ¼”åŠ‡éƒ¨', vibe:3 } },
          { text:'æ¨¡æ“¬åº—ã‚„å±‹å°é‹å–¶', scores:{ course:'ãƒã‚¹ã‚±ãƒƒãƒˆãƒœãƒ¼ãƒ«éƒ¨', club:null, vibe:4 } },
          { text:'å±•ç¤ºã‚„åˆ¶ä½œç³»ã®å‡ºã—ç‰©', scores:{ course:'ç¾è¡“ã‚³ãƒ¼ã‚¹', club:null, vibe:2 } },
          { text:'ãŠåŒ–ã‘å±‹æ•·ã‚„è„±å‡ºã‚²ãƒ¼ãƒ ', scores:{ course:null, club:'ãƒ›ãƒ©ãƒ¼å¸ƒæ•™éƒ¨', vibe:5 } }
        ]
      },
      {
        q: 'å¿˜ã‚Œç‰©ã—ãŸæ™‚ã©ã†ã™ã‚‹ï¼Ÿ',
        choices: [
          { text:'æ­£ç›´ã«è¨€ã£ã¦è¬ã‚‹', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:1 } },
          { text:'èª°ã‹ã«å€Ÿã‚Šã‚‹', scores:{ course:null, club:'æ¼”åŠ‡éƒ¨', vibe:3 } },
          { text:'ãã‚‚ãã‚‚æ°—ã¥ã‹ãªã„', scores:{ course:null, club:'ç¾è¡“', vibe:4 } },
          { text:'ãªã‚“ã¨ã‹èª¤é­”åŒ–ã™', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:5 } }
        ]
      },
      {
        q: 'ãƒ†ã‚¹ãƒˆè¿”å´ã®æ—¥ã®æ°—æŒã¡ã¯ï¼Ÿ',
        choices: [
          { text:'è‡ªä¿¡ã‚ã‚Š', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:2 } },
          { text:'ã¨ã«ã‹ãç¥ˆã‚‹', scores:{ course:null, club:'æ–‡èŠ¸', vibe:3 } },
          { text:'å‘¨ã‚Šã®ç‚¹æ•°ãŒæ°—ã«ãªã‚‹', scores:{ course:null, club:'æ¼”åŠ‡éƒ¨', vibe:4 } },
          { text:'ã“ã‚Œä½•ã®æ•™ç§‘ã ã£ã‘ï¼Ÿ', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:5 } }
        ]
      },
      {
        q: 'æœã®ãƒ›ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ ã€ã‚ãªãŸã®å§¿ã¯ï¼Ÿ',
        choices: [
          { text:'ãƒãƒƒãƒãƒªå…ƒæ°—ã«è¿”äº‹ã™ã‚‹', scores:{ course:null, club:'é™¸ä¸Šéƒ¨', vibe:2 } },
          { text:'å¤¢ã®ä¸­', scores:{ course:null, club:'ç¾è¡“', vibe:3 } },
          { text:'éš£ã®å‹é”ã¨å°å£°ã§è©±ã—ã¦ã‚‹', scores:{ course:null, club:'æ¼”åŠ‡éƒ¨', vibe:4 } },
          { text:'é…åˆ»ã‚®ãƒªã‚®ãƒªã§é§†ã‘è¾¼ã‚€', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:5 } }
        ]
      },
      {
        q: 'å»Šä¸‹ã§ã™ã‚Œé•ã†å…ˆç”Ÿã«ã¯ï¼Ÿ',
        choices: [
          { text:'ãã¡ã‚“ã¨æŒ¨æ‹¶', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:1 } },
          { text:'ä¼šé‡ˆ', scores:{ course:null, club:'å›³æ›¸', vibe:2 } },
          { text:'ç›®ã‚’ãã‚‰ã™', scores:{ course:null, club:'æ–‡èŠ¸', vibe:3 } },
          { text:'æ°—ã¥ã„ã¦ãªã„ã“ã¨ã«ã™ã‚‹', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:4 } }
        ]
      },
      {
        q: 'æ”¾èª²å¾Œã«å¯„ã‚‹ã¨ã—ãŸã‚‰ï¼Ÿ',
        choices: [
          { text:'ã‚²ãƒ¼ã‚»ãƒ³', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:5 } },
          { text:'æœ¬å±‹', scores:{ course:null, club:'æ–‡èŠ¸', vibe:2 } },
          { text:'ã‚«ãƒ•ã‚§ã‚„ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰', scores:{ course:'è‹±èªã‚³ãƒ¼ã‚¹', club:null, vibe:3 } },
          { text:'ã‚³ãƒ³ãƒ“ãƒ‹ã§ãŠã‚„ã¤è£œçµ¦', scores:{ course:null, club:'ãƒã‚¹ã‚±ãƒƒãƒˆãƒœãƒ¼ãƒ«éƒ¨', vibe:4 } }
        ]
      },
      {
        q: 'æƒé™¤ã®æ™‚é–“ã€ã©ã†ã—ã¦ã‚‹ï¼Ÿ',
        choices: [
          { text:'çœŸé¢ç›®ã«ã‚„ã‚‹', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:1 } },
          { text:'ãŠã—ã‚ƒã¹ã‚Šã‚¿ã‚¤ãƒ ', scores:{ course:null, club:'æ¼”åŠ‡éƒ¨', vibe:4 } },
          { text:'æŒ‡ç¤ºå½¹ã«ãªã‚‹', scores:{ course:null, club:'é™¸ä¸Šéƒ¨', vibe:2 } },
          { text:'æ°—ã¥ã„ãŸã‚‰çµ‚ã‚ã£ã¦ã‚‹', scores:{ course:null, club:'ç¾è¡“', vibe:5 } }
        ]
      },
      {
        q: 'æ”¾èª²å¾Œã€èª°ã¨ã„ã‚‹ï¼Ÿ',
        choices: [
          { text:'ä¸€äººã§ã®ã‚“ã³ã‚Š', scores:{ course:null, club:'å›³æ›¸', vibe:2 } },
          { text:'ä»²è‰¯ã—ã‚°ãƒ«ãƒ¼ãƒ—', scores:{ course:null, club:'æ¼”åŠ‡éƒ¨', vibe:3 } },
          { text:'éƒ¨æ´»ã®ãƒ¡ãƒ³ãƒãƒ¼', scores:{ course:null, club:'å¹å¥æ¥½éƒ¨', vibe:2 } },
          { text:'ãã®æ—¥æ¬¡ç¬¬', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:4 } }
        ]
      },
      {
        q: 'å­¦æ ¡è¡Œäº‹ã§ä¸€ç•ªç‡ƒãˆã‚‹ã®ã¯ï¼Ÿ',
        choices: [
          { text:'ä½“è‚²ç¥­', scores:{ course:null, club:'é™¸ä¸Šéƒ¨', vibe:3 } },
          { text:'æ–‡åŒ–ç¥­', scores:{ course:null, club:'æ¼”åŠ‡éƒ¨', vibe:4 } },
          { text:'åˆå”±ã‚³ãƒ³ã‚¯ãƒ¼ãƒ«', scores:{ course:'éŸ³æ¥½ã‚³ãƒ¼ã‚¹', club:null, vibe:2 } },
          { text:'ä¿®å­¦æ—…è¡Œ', scores:{ course:'è‹±èªã‚³ãƒ¼ã‚¹', club:null, vibe:5 } }
        ]
      },
      {
        q: 'ã‚¯ãƒ©ã‚¹ã§ã®è‡ªåˆ†ã®ç«‹ã¡ä½ç½®ã¯ï¼Ÿ',
        choices: [
          { text:'ã¾ã¨ã‚å½¹', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:1 } },
          { text:'ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼', scores:{ course:null, club:'æ¼”åŠ‡éƒ¨', vibe:4 } },
          { text:'ç©ºæ°—', scores:{ course:null, club:'å›³æ›¸', vibe:2 } },
          { text:'è‡ªç”±äºº', scores:{ course:null, club:'ç¾è¡“', vibe:5 } }
        ]
      },
      {
        q: 'ã‚¯ãƒ©ã‚¹ã®é›°å›²æ°—ã¯ï¼Ÿ',
        choices: [
          { text:'æ˜ã‚‹ãã¦ã«ãã‚„ã‹', scores:{ course:null, club:'ãƒ€ãƒ³ã‚¹éƒ¨', vibe:4 } },
          { text:'ã¾ã¨ã¾ã‚ŠãŒã‚ã£ã¦å¹³å’Œ', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:2 } },
          { text:'é™ã‹ã§å€‹äººä¸»ç¾©çš„', scores:{ course:null, club:'å›³æ›¸', vibe:1 } },
          { text:'ã‚ã¡ã‚ƒã‚ã¡ã‚ƒã—ã¦ã‚«ã‚ªã‚¹', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:5 } }
        ]
      },
      {
        q: 'å‹‰å¼·ã‚¹ã‚¿ã‚¤ãƒ«ã¯ï¼Ÿ',
        choices: [
          { text:'ã¨ã«ã‹ãéŸ³èª­', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:1 } },
          { text:'ãƒãƒ¼ãƒˆã‚’ã²ãŸã™ã‚‰ã¾ã¨ã‚ã‚‹', scores:{ course:null, club:'æ–‡èŠ¸', vibe:2 } },
          { text:'å•é¡Œã‚’è§£ããªãŒã‚‰è¦šãˆã‚‹', scores:{ course:null, club:'é™¸ä¸Šéƒ¨', vibe:3 } },
          { text:'ã‚¢ãƒ—ãƒªã‚„å‹•ç”»ã‚’ä½¿ã†', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:4 } }
        ]
      },
      {
        q: 'ã‚‚ã—è‡ªç”±ã«æˆæ¥­ã‚’å¢—ã‚„ã›ã‚‹ãªã‚‰ï¼Ÿ',
        choices: [
          { text:'è¶£å‘³å…¨é–‹ã®æˆæ¥­', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:5 } },
          { text:'å­¦æ ¡ã®å¤–ã§ç¤¾ä¼šä½“é¨“ã™ã‚‹æˆæ¥­', scores:{ course:'ç¾è¡“ã‚³ãƒ¼ã‚¹', club:null, vibe:3 } },
          { text:'ã‚­ãƒ£ãƒªã‚¢ã‚„äººç”Ÿè¨­è¨ˆã‚’è€ƒãˆã‚‹æˆæ¥­', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:1 } },
          { text:'æœªçŸ¥ã«æŒ‘æˆ¦ã™ã‚‹æˆæ¥­', scores:{ course:null, club:'ãƒ›ãƒ©ãƒ¼å¸ƒæ•™éƒ¨', vibe:4 } }
        ]
      },
      {
        q: 'å‹é”ã¨è©±ã—ã¦ã¦ç››ã‚Šä¸ŠãŒã‚‹ãƒ†ãƒ¼ãƒã¯ï¼Ÿ',
        choices: [
          { text:'æœ€è¿‘ã®ã‚¢ãƒ‹ãƒ¡ã‚„ã‚²ãƒ¼ãƒ ã®è©±é¡Œ', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:4 } },
          { text:'æ‹ãƒãƒŠã‚„æ”¾èª²å¾Œã®äºˆå®š', scores:{ course:null, club:'æ¼”åŠ‡éƒ¨', vibe:5 } },
          { text:'å‹‰å¼·ã‚„é€²è·¯ã®ã“ã¨ã‚’çœŸé¢ç›®ã«è©±ã™', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:1 } },
          { text:'ã¡ã‚‡ã£ã¨ä¸æ€è­°ãªä½“é¨“è«‡ã‚„å™‚è©±', scores:{ course:null, club:'ãƒ›ãƒ©ãƒ¼å¸ƒæ•™éƒ¨', vibe:5 } }
        ]
      },
      {
        q: 'æ”¾èª²å¾Œã®å›³æ›¸å®¤ã€ã‚ãªãŸãŒå‘ã‹ã†æ£šã¯ï¼Ÿ',
        choices: [
          { text:'ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ã‚„ãƒ©ãƒãƒ™ç³»ã®å°èª¬æ£š', scores:{ course:null, club:'æ–‡èŠ¸', vibe:3 } },
          { text:'æ­´å²ã‚„ä¼è¨˜ã®è³‡æ–™æ£š', scores:{ course:'ç‰¹é€²ã‚³ãƒ¼ã‚¹', club:null, vibe:1 } },
          { text:'å¿ƒç†å­¦ãƒ»å“²å­¦ãƒ»ã‚ªã‚«ãƒ«ãƒˆç³»ã®æ£š', scores:{ course:null, club:'ãƒ›ãƒ©ãƒ¼å¸ƒæ•™éƒ¨', vibe:4 } },
          { text:'é›‘èªŒã‚„æ¼«ç”»ãŒç½®ã„ã¦ã‚ã‚‹ä¼‘æ†©ã‚¹ãƒšãƒ¼ã‚¹', scores:{ course:null, club:'è»½éŸ³éƒ¨', vibe:5 } }
        ]
      }
    ];

    // Fisher-Yates ã‚·ãƒ£ãƒƒãƒ•ãƒ«
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // è³ªå•ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦10å•ã‚’é¸æŠ
    shuffle(questionPool);
    const questions = questionPool.slice(0, 10);

    // ã‚¹ã‚³ã‚¢ç´¯ç©ç”¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    let tally = {
      course: { 'ç‰¹é€²ã‚³ãƒ¼ã‚¹': 0, 'è‹±èªã‚³ãƒ¼ã‚¹': 0, 'éŸ³æ¥½ã‚³ãƒ¼ã‚¹': 0, 'ç¾è¡“ã‚³ãƒ¼ã‚¹': 0 },
      club: {},
      vibe: 0
    };

    let currentQuestionIndex = 0;
    
    // å›ç­”å±¥æ­´ã¨çŠ¶æ…‹ç®¡ç†
    let answerHistory = []; // å„è³ªå•ã®å›ç­”å±¥æ­´
    let tallyHistory = []; // å„è³ªå•æ™‚ç‚¹ã§ã®ã‚¹ã‚³ã‚¢å±¥æ­´

    // ãƒ©ãƒ³ãƒ€ãƒ ãƒœãƒ¼ãƒŠã‚¹ä¿‚æ•°
    function getBonus() {
      return 0.8 + Math.random() * 0.4;
    }

    // å›ç­”å‡¦ç†
    function answer(scores) {
      const bonus = getBonus();
      
      if (scores.course) {
        tally.course[scores.course] += bonus;
      }
      if (scores.club) {
        tally.club[scores.club] = (tally.club[scores.club] || 0) + bonus;
      }
      tally.vibe += scores.vibe * bonus;
    }

    // çµæœè¨ˆç®—
    function calcResult() {
      const courseName = Object.entries(tally.course).sort((a, b) => b[1] - a[1])[0][0];
      
      // å­¦ç§‘ã¨ã‚³ãƒ¼ã‚¹ã‚’åˆ†é›¢
      let department, course, displayCourse;
      switch(courseName) {
        case 'ç‰¹é€²ã‚³ãƒ¼ã‚¹':
          department = 'æ™®é€šç§‘';
          course = 'ç‰¹é€²';
          displayCourse = 'æ™®é€šç§‘ï¼ˆç‰¹é€²ã‚³ãƒ¼ã‚¹ï¼‰';
          break;
        case 'è‹±èªã‚³ãƒ¼ã‚¹':
          department = 'æ™®é€šç§‘';
          course = 'è‹±èª';
          displayCourse = 'æ™®é€šç§‘ï¼ˆè‹±èªã‚³ãƒ¼ã‚¹ï¼‰';
          break;
        case 'éŸ³æ¥½ã‚³ãƒ¼ã‚¹':
          department = 'èŠ¸è¡“ç§‘';
          course = 'éŸ³æ¥½';
          displayCourse = 'èŠ¸è¡“ç§‘ï¼ˆéŸ³æ¥½ã‚³ãƒ¼ã‚¹ï¼‰';
          break;
        case 'ç¾è¡“ã‚³ãƒ¼ã‚¹':
          department = 'èŠ¸è¡“ç§‘';
          course = 'ç¾è¡“';
          displayCourse = 'èŠ¸è¡“ç§‘ï¼ˆç¾è¡“ã‚³ãƒ¼ã‚¹ï¼‰';
          break;
        default:
          department = courseName;
          course = courseName;
          displayCourse = courseName;
      }
      
      const club = Object.entries(tally.club).length
        ? Object.entries(tally.club).sort((a, b) => b[1] - a[1])[0][0]
        : 'å¸°å®…';
      
      return { department, course, displayCourse, club };
    }

    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã§è‡ªç„¶ãªè¡¨ç¾ãƒ»12ç¨®ï¼‰
    const previewTemplates = [
      "ğŸ“ çœŸé¢ç›®ãªå–ã‚Šçµ„ã¿ã§ã€${club}ã§ã®æ´»å‹•ãŒå…‰ã£ã¦ã„ã¾ã™ã€‚",
      "ğŸ¤ ${club}ã§ã®æ´»èºãŒè©±é¡Œã«ï¼æ³¨ç›®ã®å­˜åœ¨ã§ã™ã€‚",
      "ğŸ‘Ÿ æ ¡å†…ã§ã¯${club}ã®ã‚¨ãƒ¼ã‚¹ã¨ã—ã¦æœŸå¾…ã‚‚å¤§ãã„ã¨ã‹ã€‚",
      "ğŸ“š å­¦æ¥­ã¨${club}ã§ã®çµŒé¨“ãŒè¦‹äº‹ã«ãƒãƒƒãƒã—ã¦ã„ã¾ã™ã€‚",
      "ğŸ§ ${club}ã§æŠ«éœ²ã—ãŸãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå°è±¡çš„ã§ã—ãŸã€‚",
      "ğŸ¨ ${club}ã®æ´»å‹•ã«æ‰“ã¡è¾¼ã‚€å§¿ã¯ã€ã¿ã‚“ãªã‹ã‚‰ä¸€ç›®ç½®ã‹ã‚Œã¦ã„ã¾ã™ã€‚",
      "ğŸŒŸ ${club}ã®æœŸå¾…ã®ãƒ«ãƒ¼ã‚­ãƒ¼ã¨ã—ã¦è©±é¡Œã«ãªã£ã¦ã„ã¾ã™ã€‚",
      "ğŸ“¸ ${club}ã§ã®ãƒ¯ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€ç´ æ•µãªé›°å›²æ°—ãŒã«ã˜ã¿å‡ºã¦ã„ã¾ã™ã€‚",
      "ğŸ“– å‹‰å­¦ã¸ã®æ„è­˜ã¨${club}ã§ã®è¡Œå‹•åŠ›ãŒçµ¶å¦™ãªãƒãƒ©ãƒ³ã‚¹ï¼",
      "ğŸ­ ${club}ã§ã¯ç‹¬è‡ªã®è¦–ç‚¹ã§è¡¨ç¾åŠ›ã‚’ç™ºæ®ã—ã¦ã„ã¾ã™ã€‚",
      "ğŸ’¬ ${club}ã§ã®æ´»å‹•ã«ã‚‚æœŸå¾…å¤§ï¼äººæ°—è€…ã§ã™ã€‚",
      "ğŸ§© ${club}ã§ã®å€‹æ€§æ´¾ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã²ã‚‰ã‚ããŒé­…åŠ›çš„ã§ã™ã€‚"
    ];

    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆé–¢æ•°
    function makeMsg(result) {
      const template = previewTemplates[Math.floor(Math.random() * previewTemplates.length)];
      // éƒ¨æ´»å‹•åã«ã€Œéƒ¨ã€ã‚’ä»˜ã‘ã‚‹
      const clubWithBu = result.club.endsWith('éƒ¨') ? result.club : result.club + 'éƒ¨';
      return template
        .replace(/\$\{course\}/g, result.course)
        .replace(/\$\{club\}/g, clubWithBu);
    }

    // å€‹æ€§ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆ50ç¨®ï¼‰
    const episodeTemplates = [
      "çµ¦é£Ÿã®ã‚¼ãƒªãƒ¼ã‚’æ¯æ—¥å‹é”ã¨ã‚¸ãƒ£ãƒ³ã‚±ãƒ³ã§å¥ªã„åˆã£ã¦ã„ã‚‹ã€‚",
      "æ•™å®¤ã®éš…ã£ã“ã§ã“ã£ãã‚ŠæŠ˜ã‚Šç´™ã‚’é‡ç”£ã—ã¦ã„ã‚‹ã€‚",
      "æƒé™¤ã®æ™‚é–“ã€ã»ã†ãã§ã‚¨ã‚¢ã‚®ã‚¿ãƒ¼ã‚’å§‹ã‚ãŒã¡ã€‚",
      "ä½“è‚²ã®æº–å‚™é‹å‹•ã«å…¨åŠ›ã™ãã¦æ¯å›ç¬‘ã„ãŒèµ·ãã‚‹ã€‚",
      "å®¿é¡Œã‚’å¿˜ã‚Œã¦ã‚‚ã€Œé¢¨ã®ã›ã„ã€ã¨è¨€ã„è¨³ã—ã¦ä¹—ã‚Šåˆ‡ã‚‹å¤©æ‰ã€‚",
      "æœã®æŒ¨æ‹¶ãŒã§ã‹ã™ãã¦éš£ã®æ•™å®¤ã¾ã§èã“ãˆã‚‹ã€‚",
      "é»’æ¿ã«æ›¸ã„ãŸã‚¤ãƒ©ã‚¹ãƒˆã‚’å‹æ‰‹ã«\"é€£è¼‰åŒ–\"ã—ã¦ã„ã‚‹ã€‚",
      "ãƒãƒ¼ãƒˆã®ç«¯ã«æ¯å›å¤‰ãªã‚­ãƒ£ãƒ©ãŒç™»å ´ã—ã¦ã„ã‚‹ã€‚",
      "å›³æ›¸å®¤ã®éš…ã§ãªãœã‹ç´™èŠå±…ã‚’ã—ã¦ã„ãŸã“ã¨ãŒã‚ã‚‹ã€‚",
      "é‰„æ£’ã‚’è¦‹ã‚‹ã¨ã¤ã„é€†ä¸ŠãŒã‚Šã—ãŸããªã‚‹è¡å‹•ã«é§†ã‚‰ã‚Œã‚‹ã€‚",
      "ç¾è¡“å®¤ã§çµµã®å…·ã®ãƒ•ã‚¿ã‚’é–‹ã‘ã‚‹ä¿‚ã‚’å‹æ‰‹ã«ã—ã¦ã„ã‚‹ã€‚",
      "é…åˆ»ã‚®ãƒªã‚®ãƒªãªã®ã«çŒ«ã¨éŠã‚“ã§ã‹ã‚‰ç™»æ ¡ã—ã¦ãã‚‹ã€‚",
      "æœºã®ä¸­ã«è¬ã®ç´™é£›è¡Œæ©Ÿã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒçœ ã£ã¦ã„ã‚‹ã€‚",
      "æˆæ¥­ä¸­ã«çªç„¶ã€Œä»Šã‚ã£ã¡ã‚ƒé–ƒã„ãŸï¼ã€ã¨è¨€ã„å‡ºã™ã€‚",
      "é€£çµ¡å¸³ã®ãƒ¡ãƒ¢æ¬„ã«åè¨€ã‚’æ—¥æ›¿ã‚ã‚Šã§æ›¸ã„ã¦ã„ã‚‹ã€‚",
      "æ¶ˆã—ã‚´ãƒ ã®ã‚«ã‚¹ã‚’ä½¿ã£ã¦å°ã•ãªèŠ¸è¡“ä½œå“ã‚’ä½œã‚‹ã€‚",
      "é›¨ã®æ—¥ã¯å‚˜ã‚’æŒ¯ã‚Šå›ã—ã¦é­”æ³•ä½¿ã„ã«ãªã‚ŠãŒã¡ã€‚",
      "ç›®ãŒåˆã£ãŸã ã‘ã§ã€Œãƒ†ãƒ¬ãƒ‘ã‚·ãƒ¼é€ã£ãŸã€ã¨è¨€ã£ã¦ãã‚‹ã€‚",
      "æœºã®è§’ã§å®šè¦ã‚’å¼¾ã„ã¦å³èˆˆãƒ©ã‚¤ãƒ–ã‚’å§‹ã‚ã‚‹ã€‚",
      "ä¿å¥å®¤ã«è¡Œãå›æ•°ãŒå¤šã™ãã¦\"æº–ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼\"æ‰±ã„ã€‚",
      "ã„ã¤ã‚‚æ–‡æˆ¿å…·ãŒå¯æ„›ãã¦ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆã«è²¸ã—å‡ºã—ä¸­ã€‚",
      "æ˜¼ä¼‘ã¿ã«æ•™å“ã®å¾Œã‚ã§ã‚¹ãƒˆãƒ¬ãƒƒãƒã—ãŒã¡ã€‚",
      "ã‚«ãƒãƒ³ã«å¸¸ã«ãŠã‚„ã¤ã‚’éš ã—æŒã£ã¦ã„ã¦äººæ°—è€…ã€‚",
      "æœç¤¼ã§ãƒœãƒ¼ãƒƒã¨ã—ã¦ã‚‹ã‚ˆã†ã§æ¡ˆå¤–è©±ã‚’å…¨éƒ¨è¦šãˆã¦ã„ã‚‹ã€‚",
      "ã²ã¨ã“ã¨æ—¥è¨˜ãŒæ¯å›ãƒã‚¨ãƒ é¢¨ã§å…ˆç”Ÿã«ãƒãƒ¬ã¦ã„ã‚‹ã€‚",
      "ä¼‘ã¿æ™‚é–“ã«ãªã‚‹ã¨æ•™å®¤ã®å£ã§\"å£ãƒ‰ãƒ³\"ã‚’å§‹ã‚ã‚‹ã€‚",
      "æˆæ¥­ã®çµ‚ã‚ã‚Šã«å…ˆç”Ÿã®ãƒãƒã‚’ã—ã¦ç¬‘ã‚ã›ã«ãã‚‹ã€‚",
      "ä¸Šå±¥ãã‚’ã™ãè„±ã„ã§\"åºŠã‚¹ãƒ©ã‚¤ãƒ‰\"ã—ã‚ˆã†ã¨ã™ã‚‹ã€‚",
      "æ ¡å†…æ”¾é€ã®ã‚¸ãƒ³ã‚°ãƒ«ã‚’å£ç¬›ã§ã‚³ãƒ”ãƒ¼ã—ãŒã¡ã€‚",
      "ãŸã¾ã«ç­†ç®±ã‹ã‚‰ã‚¹ãƒ©ã‚¤ãƒ ãŒå‡ºã¦ãã‚‹è¬ã®å­˜åœ¨ã€‚",
      "è³¼è²·ã®ãƒ‘ãƒ³ã®ç¨®é¡ã«è©³ã—ã™ãã¦\"ãƒ‘ãƒ³åšå£«\"ã¨å‘¼ã°ã‚Œã‚‹ã€‚",
      "é›»å“ã‚’æŒã¡æ­©ã„ã¦ã‚‹ã®ã«ä½¿ã£ã¦ã‚‹ã¨ã“ã‚ã¯èª°ã‚‚è¦‹ã¦ã„ãªã„ã€‚",
      "æ•™å®¤ã®æ¸©åº¦èª¿æ•´ä¿‚ã‚’è‡ªç§°ã—ã¦ã„ã‚‹ã€‚",
      "ç­†è¨˜ç”¨å…·ã‚’\"æ­¦å™¨\"ã¨ã—ã¦å‘½åã—ã¦ã„ã‚‹ã€‚",
      "ä½“è‚²ç¥­ã®å¿œæ´ã«å…¨åŠ›ã™ãã¦å£°ãŒæ¯ã‚Œã‚‹ã®ãŒæ¯å¹´æ’ä¾‹ã€‚",
      "æ•™å®¤ã®é»’æ¿ã‚’å‹æ‰‹ã«\"ä»Šæ—¥ã®ä¸€è¨€\"ã§åŸ‹ã‚ãŒã¡ã€‚",
      "ãƒ†ã‚¹ãƒˆå‰ã«ãªã‚‹ã¨èª°ã‚ˆã‚Šã‚‚æ—©ãæœºã«ç€å¸­ã—ã¦ãã‚ãã‚ã—ã¦ã‚‹ã€‚",
      "è‡ªä½œã®è¬ãƒ«ãƒ¼ãƒ«ã§æ¯æœ\"ãƒŸãƒ‹æ¤œå®š\"ã‚’é–‹å‚¬ã—ã¦ã„ã‚‹ã€‚",
      "ã‚·ãƒ£ãƒ¼ãƒšãƒ³åˆ†è§£ãŒå¾—æ„ã§ã€Œå·¥å ´é•·ã€ã¨å‘¼ã°ã‚Œã¦ã„ã‚‹ã€‚",
      "ä¸‹æ ¡æ™‚ã€é´ç®±ã§æ¯å›ä½•ã‹æ¢ã—ã¦ã„ã‚‹ãŒä½•ã‹ã¯ä¸æ˜ã€‚",
      "ä¼‘ã¿æ™‚é–“ã«æ¤…å­ã‚’é‡ã­ã¦\"ç§˜å¯†åŸºåœ°\"ã‚’ä½œã‚ŠãŸãŒã‚‹ã€‚",
      "ã‚¢ãƒŠãƒ­ã‚°æ™‚è¨ˆã‚’èª­ã‚€ã®ãŒæ—©ã™ãã¦å…ˆç”Ÿã‚ˆã‚Šå…ˆã«è¨€ã†ã€‚",
      "æˆæ¥­ä¸­ã«ç©ºä¸­ã§æŒ‡ã‚’å‹•ã‹ã—ã¦ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã—ã¦ã‚‹ã€‚",
      "æ•™ç§‘æ›¸ã®éš…ã«æ¯é€±é•ã†\"ãƒã‚¹ã‚³ãƒƒãƒˆ\"ã‚’æã„ã¦ã„ã‚‹ã€‚",
      "é›†åˆå†™çœŸã§ãªãœã‹æ¯å›\"ã©çœŸã‚“ä¸­\"ã«å†™ã£ã¦ã„ã‚‹ã€‚",
      "æ ¡å¤–å­¦ç¿’ã§ã¯èª°ã‚ˆã‚Šã‚‚ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æŠŠæ¡ã—ã¦ã„ã‚‹ã€‚",
      "èª²é¡Œãƒ—ãƒªãƒ³ãƒˆã®è£ã«ã€Œã¤ã¥ãã¯Webã§ã€ã¨æ›¸ãã‚¯ã‚»ã‚ã‚Šã€‚",
      "æŒã¡ç‰©æ¤œæŸ»ã®ã¨ãã ã‘æ€¥ã«\"å®Œç’§ä¸»ç¾©\"ã«ãªã‚‹ã€‚",
      "ãŠæ˜¼ã®æ”¾é€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«\"è¬ã®ã‚»ãƒ¬ã‚¯ãƒˆ\"ã‚’å‡ºã—ã¦ãã‚‹ã€‚",
      "è‡ªåˆ†ã®å¸­ã˜ã‚ƒãªãã¦ã‚‚è‡ªç„¶ã«åº§ã£ã¦æˆæ¥­å—ã‘ã¦ã„ã‚‹ã€‚"
    ];

    // å€‹æ€§ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ç”Ÿæˆé–¢æ•°
    function makeEpisodeMsg() {
      const randomIndex = Math.floor(Math.random() * episodeTemplates.length);
      return episodeTemplates[randomIndex];
    }

    // æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ç¢ºå®Ÿãªé¸æŠè‚¢ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
    window.selectAnswer = function(answerIndex) {
      console.log('ğŸ¯ selectAnswer å‘¼ã³å‡ºã—:', answerIndex);
      
      // äºŒé‡å®Ÿè¡Œé˜²æ­¢
      if (window.answerProcessing) {
        console.log('â¸ï¸ å‡¦ç†ä¸­ã®ãŸã‚ç„¡è¦–');
        return;
      }
      window.answerProcessing = true;
      
      try {
        const question = questions[currentQuestionIndex];
        const choice = question.choices[answerIndex];
        
        console.log('ğŸ“ å›ç­”:', choice.text);
        
        // ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆå…ƒã®æ–¹å¼ã«æˆ»ã™ï¼‰
        const bonus = 0.8 + Math.random() * 0.4;
        if (choice.scores.course) {
          tally.course[choice.scores.course] += bonus;
        }
        if (choice.scores.club) {
          tally.club[choice.scores.club] = (tally.club[choice.scores.club] || 0) + bonus;
        }
        tally.vibe += choice.scores.vibe * bonus;
        
        // æ¬¡ã®è³ªå•ã¸
        currentQuestionIndex++;
        
        setTimeout(function() {
          showQuestion(currentQuestionIndex);
          window.answerProcessing = false;
        }, 300);
        
      } catch (error) {
        console.error('âŒ å›ç­”å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ¬¡ã«é€²ã¿ã¾ã™ã€‚');
        currentQuestionIndex++;
        showQuestion(currentQuestionIndex);
        window.answerProcessing = false;
      }
    };

    // ã‚·ãƒ³ãƒ—ãƒ«ãªè³ªå•è¡¨ç¤º
    function showQuestion(index) {
      if (index >= questions.length) {
        showResult();
        return;
      }

      const question = questions[index];
      const container = document.getElementById('questionContainer');
      
      if (!container) {
        console.error('questionContainer ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
      }
      
      // HTMLã‚’ç”Ÿæˆ
      container.innerHTML = `
        <div class="question-card active fade-in">
          <div class="question-title">è³ªå• ${index + 1} / ${questions.length}</div>
          <div class="question-text">${question.q}</div>
          <div class="answer-options">
            ${question.choices.map((choice, i) => 
              `<div class="answer-option" onclick="selectAnswer(${i})">${choice.text}</div>`
            ).join('')}
          </div>
          <div class="question-controls">
            ${index > 0 ? `
              <button class="back-btn" onclick="goBack()">
                <span>â†</span>
                å‰ã®è³ªå•
              </button>
            ` : '<div></div>'}
            <span class="question-number">${index + 1} / ${questions.length}</span>
          </div>
        </div>
      `;

      // é€²æ—ãƒãƒ¼æ›´æ–°
      const progress = ((index + 1) / questions.length) * 100;
      const progressFill = document.getElementById('progressFill');
      if (progressFill) {
        progressFill.style.width = `${progress}%`;
      }
      
      console.log('ğŸ“„ è³ªå•è¡¨ç¤ºå®Œäº†:', question.q);
    }

    // æˆ»ã‚‹ãƒœã‚¿ãƒ³å‡¦ç†
    window.goBack = function() {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        showQuestion(currentQuestionIndex);
      }
    };

    // çµæœè¡¨ç¤º
    function showResult() {
      document.getElementById('questionContainer').style.display = 'none';
      document.getElementById('resultContainer').style.display = 'block';
      
      const result = calcResult();
      
      // çµæœã‚’ãƒšãƒ¼ã‚¸ã«è¡¨ç¤º
      document.getElementById('resultCourse').textContent = result.displayCourse;
      
      // éƒ¨æ´»å‹•åã«ã€Œéƒ¨ã€ã‚’ä»˜ã‘ã¦è¡¨ç¤º
      const clubDisplayName = result.club.endsWith('éƒ¨') ? result.club : result.club + 'éƒ¨';
      document.getElementById('resultClub').textContent = clubDisplayName;
      
      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      const previewMessage = makeMsg(result);
      document.getElementById('previewMsg').textContent = previewMessage;
      
      // å€‹æ€§ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      const episodeMessage = makeEpisodeMsg();
      document.getElementById('episodeMsg').textContent = episodeMessage;
      
      // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’çµµæ–‡å­—ã«ç½®ãæ›ãˆï¼ˆFont Awesomeå¯¾ç­–ï¼‰
      const toGeneratorBtn = document.getElementById('toGeneratorBtn');
      const restartBtn = document.getElementById('restartBtn');
      
      if (toGeneratorBtn) {
        toGeneratorBtn.innerHTML = '<span style="margin-right: 0.5rem;">ğŸ“‹</span>å­¦ç”Ÿè¨¼ã‚’ä½œæˆã™ã‚‹';
      }
      
      if (restartBtn) {
        restartBtn.innerHTML = '<span style="margin-right: 0.5rem;">ğŸ”„</span>è¨ºæ–­ã‚’ã‚„ã‚Šç›´ã™';
      }
      
      // å­¦ç”Ÿè¨¼ä½œæˆãƒœã‚¿ãƒ³ã®å‡¦ç†
      if (toGeneratorBtn) {
        toGeneratorBtn.onclick = () => {
          // éƒ¨æ´»å‹•ã‚’generator.htmlã®ä»•æ§˜ã«åˆã‚ã›ã¦ãƒãƒƒãƒ”ãƒ³ã‚°
          const clubMapping = {
            'é™¸ä¸Šéƒ¨': 'é™¸ä¸Šéƒ¨',
            'ãƒ†ãƒ‹ã‚¹éƒ¨': 'ãƒ†ãƒ‹ã‚¹éƒ¨', 
            'ãƒã‚¹ã‚±ãƒƒãƒˆãƒœãƒ¼ãƒ«éƒ¨': 'ãƒã‚¹ã‚±ãƒƒãƒˆãƒœãƒ¼ãƒ«éƒ¨',
            'ãƒãƒ¬ãƒ¼ãƒœãƒ¼ãƒ«éƒ¨': 'ãƒãƒ¬ãƒ¼ãƒœãƒ¼ãƒ«éƒ¨',
            'ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³éƒ¨': 'ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³éƒ¨',
            'æ°´æ³³éƒ¨': 'æ°´æ³³éƒ¨',
            'ãƒ€ãƒ³ã‚¹éƒ¨': 'ãƒ€ãƒ³ã‚¹éƒ¨',
            'å£°æ¥½éƒ¨': 'å£°æ¥½éƒ¨',
            'å¹å¥æ¥½éƒ¨': 'å¹å¥æ¥½éƒ¨',
            'çµµç”»éƒ¨': 'çµµç”»éƒ¨',
            'å½«åˆ»éƒ¨': 'å½«åˆ»éƒ¨',
            'æ”¾é€éƒ¨': 'æ”¾é€éƒ¨',
            'è‹±èªç ”ç©¶éƒ¨': 'è‹±èªç ”ç©¶éƒ¨',
            'æ¼”åŠ‡éƒ¨': 'æ¼”åŠ‡éƒ¨',
            'èŒ¶é“éƒ¨': 'èŒ¶é“éƒ¨',
            'è¯é“éƒ¨': 'è¯é“éƒ¨',
            'ãƒ›ãƒ©ãƒ¼å¸ƒæ•™éƒ¨': 'ãƒ›ãƒ©ãƒ¼å¸ƒæ•™éƒ¨',
            'è»½éŸ³éƒ¨': 'è»½éŸ³éƒ¨',
            'å¸°å®…': 'æ–‡èŠ¸',
            'ãªã—': 'æ–‡èŠ¸'
          };
          
          const mappedClub = clubMapping[result.club] || 'æ–‡èŠ¸';
          
          const url = new URL('generator.html', window.location.href);
          url.searchParams.set('department', result.department);
          url.searchParams.set('course', result.course);
          url.searchParams.set('club', mappedClub);
          url.searchParams.set('previewMessage', previewMessage);
          url.searchParams.set('episodeMessage', episodeMessage);
          window.location.href = url.toString();
        };
      }

      // è¨ºæ–­ã‚’ã‚„ã‚Šç›´ã™ãƒœã‚¿ãƒ³ã®å‡¦ç†
      if (restartBtn) {
        restartBtn.onclick = () => {
          window.location.reload();
        };
      }
    }




  </script>
</body>
</html> 