<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- 基本情報 -->
  <title>放課後クロニクル学生証</title>
  <meta name="description" content="放課後クロニクル学生証が完成しました！診断ゲームで自分だけの学校生活を見つけよう。">
  
  <!-- SNSプレビュー用の静的メタタグ（クローラー向け） -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="放課後クロニクル学生証が完成しました！">
  <meta property="og:description" content="あなただけの学生証が完成しました！診断ゲームで自分だけの学校生活を見つけよう。">
  <meta property="og:site_name" content="放課後クロニクル">
  <meta property="og:locale" content="ja_JP">
  <meta property="og:url" content="https://student-id.app/c">
  
  <!-- Twitter Card用の静的メタタグ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="放課後クロニクル学生証が完成しました！">
  <meta name="twitter:description" content="あなただけの学生証が完成しました！診断ゲームで自分だけの学校生活を見つけよう。">
  <meta name="twitter:site" content="@student_id_app">
  
  <!-- プレースホルダー画像（後でJavaScriptで置換） -->
  <meta property="og:image" content="https://via.placeholder.com/1200x630/667eea/ffffff?text=学生証">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:type" content="image/png">
  <meta name="twitter:image" content="https://via.placeholder.com/1200x630/667eea/ffffff?text=学生証">
  
  <!-- 動的OGPタグ設定（即座実行） -->
  <script>
    // URLパラメータを即座に解析してOGPタグを更新
    (function() {
      const params = new URLSearchParams(window.location.search);
      const imageParam = params.get('x') || params.get('i');
      const nameParam = params.get('y') || params.get('n');
      
      // Base64デコード関数
      function safeDecode(str) {
        if (!str) return str;
        try {
          str = str.replace(/-/g, '+').replace(/_/g, '/');
          while (str.length % 4) str += '=';
          return decodeURIComponent(atob(str));
        } catch (e) {
          return str;
        }
      }
      
      const imageUrl = safeDecode(imageParam);
      const name = safeDecode(nameParam);
      
      if (imageUrl) {
        // OGP画像を更新
        const ogImage = document.querySelector('meta[property="og:image"]');
        if (ogImage) ogImage.setAttribute('content', imageUrl);
        
        const twitterImage = document.querySelector('meta[name="twitter:image"]');
        if (twitterImage) twitterImage.setAttribute('content', imageUrl);
      }
      
      if (name) {
        // タイトルと説明を更新
        const title = `${name}の学生証 - 放課後クロニクル`;
        const description = `${name}の学生証が完成しました！あなたも診断ゲームで自分だけの学校生活を見つけよう。`;
        
        document.title = title;
        
        const ogTitle = document.querySelector('meta[property="og:title"]');
        if (ogTitle) ogTitle.setAttribute('content', title);
        
        const ogDesc = document.querySelector('meta[property="og:description"]');
        if (ogDesc) ogDesc.setAttribute('content', description);
        
        const twitterTitle = document.querySelector('meta[name="twitter:title"]');
        if (twitterTitle) twitterTitle.setAttribute('content', title);
        
        const twitterDesc = document.querySelector('meta[name="twitter:description"]');
        if (twitterDesc) twitterDesc.setAttribute('content', description);
      }
    })();
  </script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Hiragino Sans', 'Yu Gothic UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      text-align: center;
      max-width: 500px;
      width: 100%;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 20px;
    }

    h1 {
      color: #333;
      margin-bottom: 30px;
      font-size: 1.8rem;
    }

    .card-preview {
      margin: 30px 0;
      cursor: pointer;
      transition: transform 0.3s ease;
      position: relative;
    }

    .card-preview:hover {
      transform: scale(1.02);
    }

    .card-preview img {
      max-width: 100%;
      height: auto;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .description {
      color: #666;
      margin: 30px 0;
      line-height: 1.6;
    }

    .buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .btn {
      flex: 1;
      padding: 15px 25px;
      border-radius: 10px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-width: 120px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .btn-secondary {
      background: #f8f9fa;
      color: #666;
      border: 2px solid #e9ecef;
    }

    .btn-secondary:hover {
      background: #e9ecef;
      transform: translateY(-2px);
    }

    @media (max-width: 480px) {
      .container {
        padding: 30px 20px;
      }
      
      .buttons {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
    }

    .error {
      padding: 40px;
      background: #f8f9fa;
      color: #666;
      border-radius: 15px;
    }

    .loading {
      color: #667eea;
      font-size: 1.1rem;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="logo">🎓 放課後クロニクル</div>
    
    <h1 id="title">学生証が完成しました！</h1>
    
    <div class="card-preview" id="cardContainer">
      <div id="loadingMessage" class="loading">
        <i class="fas fa-spinner fa-spin"></i>
        読み込み中...
      </div>
      <img id="cardImage" src="" alt="学生証" style="display: none;">
      <div id="errorMessage" class="error" style="display: none;">
        <i class="fas fa-exclamation-triangle"></i>
        <p>画像を読み込めませんでした</p>
      </div>
    </div>
    
    <div class="description">
      あなただけの学生証が完成しました！<br>
      <strong>画像をタップして診断ゲームを体験しよう</strong>
    </div>
    
    <div class="buttons">
      <a href="https://preview.studio.site/live/1Va6D4lMO7/student-id" class="btn btn-primary">
        <i class="fas fa-dice"></i>
        診断ゲーム
      </a>
      <a href="https://preview.studio.site/live/1Va6D4lMO7/student-id/generator.html" class="btn btn-secondary">
        <i class="fas fa-id-card"></i>
        学生証作成
      </a>
    </div>
  </div>

  <script>
    // パラメータ解析と表示（強化版）
    const urlParams = new URLSearchParams(window.location.search);
    const imageParam = urlParams.get('x') || urlParams.get('i');
    const nameParam = urlParams.get('y') || urlParams.get('n');
    
    // Base64デコード関数
    function safeDecode(str) {
      if (!str) return str;
      try {
        str = str.replace(/-/g, '+').replace(/_/g, '/');
        while (str.length % 4) str += '=';
        return decodeURIComponent(atob(str));
      } catch (e) {
        return str;
      }
    }
    
    const imageUrl = safeDecode(imageParam);
    const name = safeDecode(nameParam);
    
    console.log('パラメータ解析結果:', { imageUrl, name });
    
    // 画像表示
    if (imageUrl) {
      const img = document.getElementById('cardImage');
      const loading = document.getElementById('loadingMessage');
      const error = document.getElementById('errorMessage');
      
      img.onload = function() {
        loading.style.display = 'none';
        img.style.display = 'block';
        error.style.display = 'none';
        console.log('✅ 画像読み込み成功');
      };
      
      img.onerror = function() {
        loading.style.display = 'none';
        img.style.display = 'none';
        error.style.display = 'block';
        console.error('❌ 画像読み込み失敗');
      };
      
      img.src = imageUrl;
      
      // 画像クリックでリダイレクト
      document.getElementById('cardContainer').onclick = function() {
        window.open('https://preview.studio.site/live/1Va6D4lMO7/student-id', '_blank');
      };
    } else {
      document.getElementById('loadingMessage').style.display = 'none';
      document.getElementById('errorMessage').style.display = 'block';
      console.warn('⚠️ 画像URLパラメータが見つかりません');
    }
    
    // タイトル更新
    if (name) {
      document.getElementById('title').textContent = `${name}の学生証が完成しました！`;
      console.log('✅ タイトル更新:', name);
    }
  </script>
</body>
</html> 