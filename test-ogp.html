<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OGPãƒ†ã‚¹ãƒˆ - å­¦ç”Ÿè¨¼ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
    .url-input { width: 100%; padding: 10px; margin: 10px 0; }
    .test-btn { background: #007cba; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
    .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>ğŸ”— OGPãƒ†ã‚¹ãƒˆ - å­¦ç”Ÿè¨¼ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
  
  <div class="test-section">
    <h2>1. å…±æœ‰URLç”Ÿæˆãƒ†ã‚¹ãƒˆ</h2>
    <p>Cloudinaryã®public_idã‚’å…¥åŠ›ã—ã¦ã€å…±æœ‰URLã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>
    <input type="text" id="publicIdInput" class="url-input" placeholder="ä¾‹: student_card_AS_chronicle/abc123" value="student_card_AS_chronicle/test">
    <button onclick="generateShareUrl()" class="test-btn">å…±æœ‰URLç”Ÿæˆ</button>
    <div id="shareUrlResult" class="result"></div>
  </div>
  
  <div class="test-section">
    <h2>2. OGPã‚¿ã‚°ç¢ºèª</h2>
    <p>ç”Ÿæˆã•ã‚ŒãŸå…±æœ‰URLã®ãƒšãƒ¼ã‚¸ã‚½ãƒ¼ã‚¹ã§OGPã‚¿ã‚°ã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
    <input type="text" id="shareUrlInput" class="url-input" placeholder="å…±æœ‰URLã‚’å…¥åŠ›">
    <button onclick="checkOGPTags()" class="test-btn">OGPã‚¿ã‚°ç¢ºèª</button>
    <div id="ogpResult" class="result"></div>
  </div>
  
  <div class="test-section">
    <h2>3. X Card Validator ãƒ†ã‚¹ãƒˆ</h2>
    <p>å…±æœ‰URLã‚’X Card Validatorã§ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
    <button onclick="openXCardValidator()" class="test-btn">X Card Validator ã‚’é–‹ã</button>
    <p><small>â€» æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã¾ã™</small></p>
  </div>
  
  <div class="test-section">
    <h2>4. Discord ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚¹ãƒˆ</h2>
    <p>Discordã«å…±æœ‰URLã‚’è²¼ã‚Šä»˜ã‘ã¦ã€ã‚µãƒ ãƒã‚¤ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
    <p><small>â€» Discordã®ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã¾ãŸã¯DMã§ç¢ºèªã—ã¦ãã ã•ã„</small></p>
  </div>

  <script>
    // å…±æœ‰URLç”Ÿæˆï¼ˆgenerator.htmlã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
    function generateShareUrl() {
      const publicId = document.getElementById('publicIdInput').value.trim();
      if (!publicId) {
        alert('public_idã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }
      
      // Base64URLå¤‰æ›
      function toBase64Url(str) {
        return btoa(unescape(encodeURIComponent(str)))
          .replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
      }
      
      // å…±æœ‰URLç”Ÿæˆ
      const SHARE_BASE = 'https://<PAGES_PRODUCTION_DOMAIN>'; // Cloudflare Pagesã®Production domain
      const slug = toBase64Url(publicId) + '-' + Date.now();
      const shareUrl = `${SHARE_BASE}/s/${slug}`;
      
      document.getElementById('shareUrlResult').innerHTML = `
        <strong>ç”Ÿæˆã•ã‚ŒãŸå…±æœ‰URL:</strong><br>
        <a href="${shareUrl}" target="_blank">${shareUrl}</a><br><br>
        <strong>å…ƒã®public_id:</strong> ${publicId}<br>
        <strong>ç”Ÿæˆæ™‚åˆ»:</strong> ${new Date().toLocaleString()}
      `;
      
      // å…±æœ‰URLå…¥åŠ›æ¬„ã«ã‚‚è¨­å®š
      document.getElementById('shareUrlInput').value = shareUrl;
    }
    
    // OGPã‚¿ã‚°ç¢ºèª
    async function checkOGPTags() {
      const shareUrl = document.getElementById('shareUrlInput').value.trim();
      if (!shareUrl) {
        alert('å…±æœ‰URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }
      
      try {
        const response = await fetch(shareUrl);
        const html = await response.text();
        
        // OGPã‚¿ã‚°ã‚’æŠ½å‡º
        const ogImageMatch = html.match(/<meta property="og:image" content="([^"]+)"/);
        const ogTitleMatch = html.match(/<meta property="og:title" content="([^"]+)"/);
        const ogDescMatch = html.match(/<meta property="og:description" content="([^"]+)"/);
        const twitterCardMatch = html.match(/<meta name="twitter:card" content="([^"]+)"/);
        
        let result = '<strong>OGPã‚¿ã‚°ç¢ºèªçµæœ:</strong><br>';
        
        if (ogImageMatch) {
          result += `âœ… og:image: ${ogImageMatch[1]}<br>`;
        } else {
          result += 'âŒ og:image: è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“<br>';
        }
        
        if (ogTitleMatch) {
          result += `âœ… og:title: ${ogTitleMatch[1]}<br>`;
        } else {
          result += 'âŒ og:title: è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“<br>';
        }
        
        if (ogDescMatch) {
          result += `âœ… og:description: ${ogDescMatch[1]}<br>`;
        } else {
          result += 'âŒ og:description: è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“<br>';
        }
        
        if (twitterCardMatch) {
          result += `âœ… twitter:card: ${twitterCardMatch[1]}<br>`;
        } else {
          result += 'âŒ twitter:card: è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“<br>';
        }
        
        document.getElementById('ogpResult').innerHTML = result;
        
      } catch (error) {
        document.getElementById('ogpResult').innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
      }
    }
    
    // X Card Validator ã‚’é–‹ã
    function openXCardValidator() {
      const shareUrl = document.getElementById('shareUrlInput').value.trim();
      if (!shareUrl) {
        alert('å…ˆã«å…±æœ‰URLã‚’ç”Ÿæˆã—ã¦ãã ã•ã„');
        return;
      }
      
      const validatorUrl = `https://cards-dev.twitter.com/validator?url=${encodeURIComponent(shareUrl)}`;
      window.open(validatorUrl, '_blank');
    }
    
    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®public_idã§å…±æœ‰URLã‚’ç”Ÿæˆ
      generateShareUrl();
    });
  </script>
</body>
</html>
